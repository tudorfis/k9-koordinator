var viewsRun=function($timeout){rs.hs=function(h,s){$(h).hide();$(s).show()};rs.sh=function(s,h){$(s).show();$(h).hide()};rs.revealModal=function(modal){$(modal).foundation("reveal","open")};rs.closeModal=function(modal){$(modal).foundation("reveal","close")};rs.closeCurrentModal=function(){$(".reveal-modal").filter(":visible").foundation("reveal","close")};rs.hideContentShowAl=function(){$("#ajaxLoaderHuge").show();$("#mainContent").css({opacity:"0.6"})};rs.hideAlShowContent=function(){$("#ajaxLoaderHuge").hide();$("#mainContent").css({opacity:"1"})};rs.fadeInElement=function(el_selector,speed){speed=speed||"medium";$(el_selector).fadeIn(speed)};rs.fadeOutElement=function(el_selector,speed){speed=speed||"medium";$(el_selector).fadeOut(speed)};rs.showElement=function(el_selector){$(el_selector).show()};rs.hideElement=function(el_selector){$(el_selector).hide()};rs.checkCpClient=function(){if(rs.isEmpty(rs.client)){var el=$('#cpModal a[href="#panel_client_1"]');if(!el.parent("dd").hasClass("active")){el.trigger("click")}}};rs.checkCpPet=function(){if(rs.isEmpty(rs.pet)){var el=$('#cpModal a[href="#panel_pet_1"]');if(!el.parent("dd").hasClass("active")){el.trigger("click")}}};rs.alertMsg=function(msg){if(msg){rs.alert_message=msg;$timeout(function(){$(".alertMsg").show()},100);$timeout(function(){$(".alertMsg").hide()},3e3)}};rs.confirmMsg=function(msg,func){if(msg){rs.confirm_message=msg;rs.confirmFunc=func;$timeout(function(){$(".confirmMsg").show()},100);$timeout(function(){$(".confirmMsg").hide()},3e3)}}};var searchRun=function(){rs.searchAdvancedObj=function(scope_id,target,result,tables){var scope=$(scope_id).scope(),matching={};scope[result]={};a.forEach(tables,function(t){matching[t.id]=[];a.forEach(scope[t.tbl],function(item){a.forEach(t.v,function(m){var str=item[m].toString().toLowerCase(),match=scope[target].toString().toLowerCase();if(str.match(match)){matching[t.id].push(item.id)}})})});scope[result]=matching}};var convertsRun=function($filter){rs.convertTelNumber=function(scope_id,t,n,t_id){var scope=$(scope_id).scope(),val=scope[t][n],p_id=rs.user_interface_settings[t_id];var part1="",part2="",part3="";if(p_id==1){if(val&&val.match(/[0-9]{10}/g)&&val.length==10){part1=val.substring(0,3);part2=val.substring(3,6);part3=val.substring(6,10);scope[t][n]="("+part1+") "+part2+"-"+part3}}else if(p_id==2){if(val&&val.match(/07[0-9]{8}/g)&&val.length==10){part1=val.substring(0,4);part2=val.substring(4,10);scope[t][n]=part1+" "+part2}}};rs.getTelErrorText=function(n){var fid={};if(rs.user_interface_settings){if(rs.user_interface_settings[n]){if(rs.tel_formats){if(rs.tel_formats[rs.user_interface_settings[n]]){return rs.tel_formats[rs.user_interface_settings[n]].error_text||""}}}}return""};rs.convertToUpperCase=function(scope_id,t,n){var scope=$(scope_id).scope(),val=scope[t][n];if(val){scope[t][n]=val.toUpperCase()}};rs.convertToMaxlength=function(scope_id,t,n,maxlength){var scope=$(scope_id).scope(),val=scope[t][n];if(val){scope[t][n]=val.substring(0,maxlength)}};rs.focusOnId=function(id){$("#"+id).focus()};rs.getCurrentDate=function(date){var today={};if(date){today=date}else{today=new Date}var dd=today.getDate(),mm=today.getMonth()+1,yyyy=today.getFullYear();if(dd<10)dd="0"+dd;if(mm<10)mm="0"+mm;today=yyyy+"-"+mm+"-"+dd;return today};rs.getYear=function(){var date=new Date;return date.getFullYear()};rs.getCurrentTime=function(){var today=new Date,hh=today.getHours(),mm=today.getMinutes(),ss=today.getSeconds();if(parseInt(mm)<=9)mm="0"+mm;if(parseInt(ss)<=9)ss="0"+ss;return hh+":"+mm+":"+ss};rs.getCDT=function(){return rs.getCurrentDate()+" "+rs.getCurrentTime()};rs.getTime=function(date){return new Date(date).getTime()};rs.isArray=function(item){return Object.prototype.toString.call(item)=="[object Array]"};rs.isObject=function(item){return Object.prototype.toString.call(item)=="[object Object]"};rs.isEmpty=function(item){for(var prop in item){if(item.hasOwnProperty(prop))return false}return true};rs.isFloat=function(n,is_string){if(is_string){return!isNaN(n)&&n!==null&&n!==""&&n.toString().indexOf(".")!=-1}else{return n===+n&&n!==(n|0)}};rs.isInteger=function(n,is_string){if(is_string){return!isNaN(n)&&n!==null&&n!==""&&n.toString().indexOf(".")==-1}else{return n===+n&&n===(n|0)}};rs.isNumberic=function(n){if(rs.isInteger(n)||rs.isFloat(n)){return true}return false};rs.rnt=function(nr){var array_o={};for($i=1;$i<=nr;$i++){array_o[$i]={id:$i,v:$i}}return array_o};rs.rna=function(nr,from){var array=[];for($i=from||1;$i<=nr;$i++){array.push($i)}return array};rs.orderByKeys=function(obj,type){var return_obj={},keys=Object.keys(obj),i,len=keys.length;if(type=="reverse"){keys.reverse()}else{keys.sort()}for(i=0;i<len;i++){k=keys[i];return_obj[k]=obj[k]}return return_obj};rs.checkArr=function(in_object,id_array,key,check_value){var result=false;a.forEach(id_array,function(id){if(in_object[id][key]!=check_value){result=true;return false}});return result};rs.makeWatchTables=function(obj_in){if(!rs.isEmpty(obj_in)){var watch_collection="[";a.forEach(obj_in,function(item){watch_collection+=item+", "});watch_collection=watch_collection.substring(0,watch_collection.length-2);watch_collection+="]";return watch_collection}else{return""}};rs.refreshPage=function(){location.reload()};rs.ma=function(in_obj){if(rs.isObject(in_obj)){return $filter("array")(in_obj)}else if(in_obj){return in_obj}else{return[]}};rs.lastEl=function(in_obj){if(in_obj){if(rs.isObject(in_obj)){in_obj=$filter("array")(in_obj)}return in_obj[in_obj.length-1]}};rs.openTab=function(hide_tabs,open_tab,open_tab_active){$(hide_tabs).find(".content").hide();$(hide_tabs).find("dd").removeClass("active");$(open_tab).fadeIn("medium");$(open_tab_active).addClass("active")};rs.setOneYear=function(scope,t,n){oneYr=new Date;oneYr.setYear(oneYr.getFullYear()+1);var one_year=rs.getCurrentDate(oneYr);if(scope&&t&&n){scope=$(scope).scope();scope[t][n]=one_year}else{return one_year}};rs.unbind=function(obj){return JSON.parse(JSON.stringify(obj))};rs.guid=function(){return"a"+Math.floor((1+Math.random())*65536).toString(16).substring(1)};rs.guid_long=function(){return"l"+Math.random()+Math.random()+Math.random()+Math.random()};rs.uid=function(){function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()};rs.lowercaseUnderscore=function(value){if(!value){return""}value=value.toString();value=value.toLowerCase();value=value.replace(/  /g," ");value=value.replace(/ /g,"_");return value};rs.getTimeTimestamp=function(value){if(!value){return""}var arr=value.split(":"),h=arr[0],m=arr[1],s=arr[2]||0,r=pF(h)*60*60+pF(m)*60+pF(s);return r}};var reportsRun=function(pdf){rs.clientMembershipReport=function(s){var language_text=rs.l.l_text("en");rs.l.setLanguage("en");var docDefinition={content:[{columns:[{width:"50%",text:[{text:"\n"+rs.client.first_name+", "+rs.client.last_name+"\n\n",style:"topTitle"},s.client_membership_mod.valability?{text:rs.l.l("valability")+": "+s.client_membership_mod.valability+"\n\n",style:"subTitle2"}:{text:rs.l.l("valability")+": - "+rs.l.l("unlimited")+" -"+"\n\n",style:"subTitle2"},{text:(rs.client.email?rs.l.l("email")+": "+rs.client.email:"")+"\n",style:"subTitle"},{text:(rs.client.preffered_phone?rs.l.l("phone")+": "+rs.client.preffered_phone:"")+"\n\n",style:"subTitle"},{text:(s.client_membership_mod.membership?rs.l.l("membership")+""+"\n"+s.client_membership_mod.membership:"")+"\n",style:"subText"}]},{width:"50%",text:[{text:"\n\n\n"+(s.client_membership_mod.add_pet_name?rs.l.l("pet_name")+": "+rs.pet.pet_name:""),style:"subTitle2"}]}]},{text:"\n\n"},{alignment:"justify",columns:[s.client_membership_mod.print_photo_client?{image:pdf.client_image,style:{width:"25%",height:"auto",margin:[10,10,10,10]}}:{text:""},s.client_membership_mod.print_photo_pet?{image:pdf.pet_image,style:{width:"25%",height:"auto"}}:{text:""}]},{text:"\n\n\n\n\n\n"},{image:$("#clients-membership").find("#barcode").attr("src"),style:"barcodeImage"}],styles:a.extend(pdf.styles,{barcodeImage:{width:400,height:70,margin:[0,0,0,30]},cpImage:{width:50,height:50,margin:[0,10,0,10]}})};docDefinition.content.unshift(pdf.contactInfoHeader());var report_name="client_membership_"+rs.client.first_name+"_"+rs.client.last_name+"_"+rs.getCDT()+".pdf";pdf.options(s.client_membership_mod.print_type,docDefinition,report_name)};rs.depositReport=function(d_mod){var language_text=rs.l.l_text(d_mod.language);rs.l.setLanguage(d_mod.language);var docDefinition={content:[{image:pdf.hr_image},{text:"\n\n"},{text:rs.payment_types[d_mod.payment_type_id]?rs.l.l("deposit_report"):rs.l.l("paid_from_deposit_report"),style:"topTitle"},{text:"\n\n"},{columns:[{width:"50%",text:[{text:rs.l.l("client_information")+": \n\n",style:"subTitle2"},{text:rs.client.first_name+", "+rs.client.last_name+"\n",style:"topTitle2"},{text:rs.l.l("email")+": "+(rs.client.email||"-")+"\n",style:"subTitle"},{text:rs.l.l("phone")+": "+(rs.client.preffered_phone||"-")+"\n",style:"subTitle"},rs.access.checkRewards()?{text:"\n"+(rs.clients[rs.client.id].reward_points||0)+" "+rs.l.l("reward_points_to_date")+"\n",style:"subTitle"}:{text:"	"},{text:"\n\n\n"},{text:rs.l.l("total").toUpperCase()+":   "+pF(d_mod.payment_amount).toFixed(2)+" $	\n\n",style:"topTitle2"}]},{width:"50%",text:[{text:rs.l.l("billing_information")+": \n\n",style:"subTitle2"},{text:rs.l.l("language")+":         "+language_text+"\n\n",style:"subTitle"},{text:rs.l.l("payment_type")+":     "+(rs.payment_types[d_mod.payment_type_id]?rs.payment_types[d_mod.payment_type_id].v:"-")+"\n",style:"subTitle"},{text:d_mod.date_created?rs.l.l("date_created")+":     "+d_mod.date_created+"\n":"\n",style:"subTitle"},d_mod.is_a_tip?{text:"\n"+rs.l.l("is_tip")+" ?                 "+(d_mod.is_a_tip==1?"Yes":"No")+"\n",style:"subTitle"}:{text:"\n"},d_mod.is_a_tip?{text:rs.l.l("tipped_user")+":         "+(rs.users[d_mod.tip_user_id]?rs.users[d_mod.tip_user_id].v:"-")+"\n\n",style:"subTitle"}:{text:"\n\n"}]}]},{text:"\n\n"}],styles:pdf.styles};docDefinition.content.unshift(pdf.contactInfoHeader());var report_name="deposit_"+rs.client.first_name+"_"+rs.client.last_name+"_"+rs.getCDT()+".pdf";pdf.options(d_mod.print_type,docDefinition,report_name)};rs.posReport=function(language,print_type,is_walk_in_sale,required,paid,change,unpaid,o,oo){var is_refund=o.payment_status_id==3;var language_text=rs.l.l_text(language);rs.l.setLanguage(language);var i_array=[];i_array.push([{text:rs.l.l("name"),style:"tableHeader"},{text:rs.l.l("qty"),style:"tableHeader"},{text:rs.l.l("price"),style:"tableHeader"},{text:rs.l.l("adaos"),style:"tableHeader"},{text:rs.l.l("disc"),style:"tableHeader"},{text:rs.l.l("coupon"),style:"tableHeader"},{text:rs.l.l("tax"),style:"tableHeader"},{text:rs.l.l("o_tax"),style:"tableHeader"},{text:rs.l.l("total"),style:"tableHeader"}]);a.forEach(oo,function(rio){i_array.push([rio.product_name,pF(rio.add_qty).toFixed(0),rio.price+"$","+"+pF(rio.adaos).toFixed(2)+"$","-"+pF(rio.discount).toFixed(2)+"$","-"+pF(rio.coupon_total).toFixed(2)+"$","+"+pF(rio.tax_total).toFixed(2)+"$","+"+pF(rio.o_tax_total).toFixed(2)+"$",pF(rio.total).toFixed(2)+"$"])});var dd_client_information=null;if(is_walk_in_sale){dd_client_information=[{text:"- "+rs.l.l("walk_in_client")+" - \n\n",style:"subTitle2"}]}else{dd_client_information=[{text:rs.l.l("client_information")+": \n\n",style:"subTitle2"},{text:rs.client.first_name+", "+rs.client.last_name+"\n",style:"topTitle2"},{text:rs.l.l("email")+": "+(rs.client.email||"-")+"\n",style:"subTitle"},{text:rs.l.l("phone")+": "+(rs.client.preffered_phone||"-")+"\n",style:"subTitle"},rs.access.checkRewards()?{text:"\n"+(rs.clients[rs.client.id].reward_points||0)+" "+rs.l.l("reward_points_to_date")+"\n",style:"subTitle"}:{text:"	"}]}var dd_left_text=dd_client_information.concat([{text:"\n\n\n"},{text:rs.l.l("total").toUpperCase()+":   "+pF(required).toFixed(2)+" $	\n\n",style:"topTitle2"},!is_refund?{text:rs.l.l("paid")+":             "+pF(paid).toFixed(2)+" $	\n",style:"topTitle3"}:{text:"\n"},!is_refund?{text:rs.l.l("change")+":       "+pF(change).toFixed(2)+" $	\n",style:"topTitle3"}:{text:"\n"},!is_refund?{text:rs.l.l("unpaid")+":       "+pF(unpaid).toFixed(2)+" $	\n",style:"topTitle3"}:{text:"\n"}]);var docDefinition={content:[{image:pdf.hr_image},{text:"\n\n"},{text:is_refund?rs.l.l("refund_report"):rs.l.l("point_of_sale_report"),style:"topTitle"},{text:"\n\n"},{columns:[{width:"50%",text:dd_left_text},{width:"50%",text:[{text:rs.l.l("billing_information")+": \n\n",style:"subTitle2"},{text:rs.l.l("language")+":         "+language_text+"\n",style:"subTitle"},{text:rs.l.l("payment_type")+":     "+(rs.payment_types[o.payment_type_id]?rs.payment_types[o.payment_type_id].v:"-")+"\n",style:"subTitle"},!is_refund?{text:(o.payment_status_id?rs.l.l("payment_status")+":     "+rs.payment_status[o.payment_status_id].v:"")+"\n\n",style:"subTitle"}:{text:"\n"},{text:o.date_created?rs.l.l("date_created")+":     "+o.date_created+"\n":"\n",style:"subTitle"},{text:o.date_modified?rs.l.l("date_modified")+":     "+o.date_modified+"\n":"\n",style:"subTitle"},o.promotion_id&&!is_refund?{text:rs.l.l("rewards")+" \n\n "+rs.promotions[o.promotion_id].promotion_name+"	\n"+rs.promotions[o.promotion_id].description+"	\n\n"+rs.l.l("points_per_dollar")+":     "+rs.promotions[o.promotion_id].points+"	\n"+rs.l.l("discount")+":               -"+pF(o.promotion_discount).toFixed(2)+" $	\n",style:"subTitle3"}:{text:""}]}]},{text:"\n\n"},{style:"tableExample",table:{headerRows:1,widths:["20%","10%","10%","10%","10%","10%","10%","10%","10%"],body:i_array},layout:"lightHorizontalLines"}],styles:pdf.styles};docDefinition.content.unshift(pdf.contactInfoHeader());var report_name=is_walk_in_sale?"billing_walk_in_sale_"+rs.getCDT()+".pdf":"billing_"+rs.client.first_name+"_"+rs.client.last_name+"_"+rs.getCDT()+".pdf";pdf.options(print_type,docDefinition,report_name)};rs.rsvReport=function(o,rb,id,tbl,without_print){var language_text=rs.l.l_text(o.language);rs.l.setLanguage(o.language);var client=rs.clients[rb.client_id]||{},pet=rs.pets[rb.pet_id]||{};var client_name=(client.first_name?client.first_name:"-")+(client.last_name?client.last_name:"-"),client_email=client.email||"-none-",client_phone=client.contact_phone||"-none",pet_name=pet.pet_name||"-",pet_type=rs.pet_type[pet.pet_type_id].v,pet_breed=rs.pet_breed[pet.pet_breed_id].v;var date_in=rb.date_in,time_in=rb.time_in,date_out=rb.date_checkout||rb.date_out,time_out=rb.time_checkout||rb.time_out,date_in_t=new Date(date_in).getTime()/1e3,date_out_t=new Date(date_out).getTime()/1e3,time_in_t=rs.getTimeTimestamp(time_in),time_out_t=rs.getTimeTimestamp(time_out),nr_days=null,is_halfday=null,charge_obj={},charge_v="",charge_full_day=null,charge_half_day=null,subtotal=0,total=0;if(date_out=="0000-00-00"){date_out=rb.date_out;date_out_t=new Date(date_out).getTime()/1e3}if(time_out=="00:00:00"){time_out=rb.time_out;time_out_t=rs.getTimeTimestamp(time_out)}if(date_out_t-date_in_t==0){nr_days=1}else{nr_days=(date_out_t-date_in_t)/86400+1}var charge_type={},c_type="",c_v="",c_fullday=0,c_halfday=0;var type_of_report="";if(tbl=="r_boarding"){type_of_report=rs.l.l("boarding_report");var stay_reason=rs.stay_reasons[rb.stay_reason_id]?rs.stay_reasons[rb.stay_reason_id].v:"-",luggage=rb.luggage||"-",is_handle_carefully=rb.is_handle_carefully?"Yes":"No",is_extra_pet=rb.is_extra_pet?"Yes":"No";if(rb.charge_type=="charge_by_petsize"){charge_type=rs.boarding_petsizes[rb.charge_type_id];c_type=rs.l.l("charge_by_petsize")}else if(rb.charge_type=="charge_by_runtype"){charge_type=rs.boarding_runtypes[rb.charge_type_id];c_type=rs.l.l("charge_by_runtype")}c_v=charge_type.v;c_fullday=charge_type.full_day;c_halfday=charge_type.half_day;var half_day_from_t=rs.getTimeTimestamp(rs.boarding_settings.half_day_from),half_day_to_t=rs.getTimeTimestamp(rs.boarding_settings.half_day_to),full_day_from_t=rs.getTimeTimestamp(rs.boarding_settings.full_day_from),full_day_to_t=rs.getTimeTimestamp(rs.boarding_settings.full_day_to);if(rb.is_halfday==2){if(half_day_from_t<=time_in_t&&time_in_t<=half_day_to_t&&(half_day_from_t<=time_out_t&&time_in_t<=half_day_to_t)){is_halfday=1;total=c_halfday*nr_days}else{is_halfday=0;total=c_fullday*nr_days}}else if(rb.is_halfday==1){is_halfday=1;total=c_halfday*nr_days}else if(rb.is_halfday==0){is_halfday=0;total=c_fullday*nr_days}}else if(tbl=="r_daycare"){type_of_report=rs.l.l("daycare_report");charge_type=rs.daycare_groups[rb.daycare_group_id]||{};c_v=charge_type.v;c_fullday=charge_type.full_day;c_halfday=charge_type.half_day;if(rb.is_halfday==1){is_halfday=1;total=c_halfday*nr_days}else if(rb.is_halfday==0){is_halfday=0;total=c_fullday*nr_days}}else if(tbl=="r_grooms"){type_of_report=rs.l.l("grooms_report");var groomer_v=rs.groomers[rb.groomer_id].v,grooming_rate_v=rs.grooming_rates[rb.grooming_rate_id].v,grooming_rate_multiplier=rs.grooming_rates[rb.grooming_rate_id].multiplier,is_hcp_v=rb.is_hcp?"Yes":"No",base_type_v="",pet_size_id=rs.pets[rb.pet_id].pet_size_id,pet_size_v=rs.pet_size[rs.pets[rb.pet_id].pet_size_id].v;a.forEach(rs.base_type_filter,function(item){if(item.v==rb.base_type_id){base_type_v=item.n}});var r_gs_table=[];r_gs_table.push([{text:rs.l.l("service"),style:"tableHeader"},{text:rs.l.l("price"),style:"tableHeader"},{text:rs.l.l("is_handle_carefully"),style:"tableHeader"},{text:rs.l.l("multiplier"),style:"tableHeader"},{text:rs.l.l("nr_days"),style:"tableHeader"},{text:rs.l.l("total"),style:"tableHeader"}]);a.forEach(rb.gs_array,function(gs_id){var g_s=rs.grooming_services[gs_id],g_service=g_s.v,g_price=g_s["v_"+pet_size_id],g_hcp=g_s.hcp,g_multiplier=grooming_rate_multiplier,g_total=0;g_total=(pF(g_price)*pF(g_multiplier)+(rb.is_hcp?pF(g_hcp):0))*pF(nr_days);total+=g_total;r_gs_table.push([g_service,"$"+pF(g_price).toFixed(2),rb.is_hcp?"+ $"+pF(g_hcp).toFixed(2):"-",rb.multiplier?"x"+pF(g_multiplier).toFixed(2):"-","x "+nr_days.toString(),pF(g_total).toFixed(2)+"$"])})}else if(tbl=="r_training"){type_of_report=rs.l.l("training_report");var trainer_v=rs.trainers[rb.t_id].v,tg_obj=rs.training_groups[rb.tg_id],tg_v=tg_obj.v,tg_limit=tg_obj.limit,tg_price=tg_obj.price,tg_rank=tg_obj.rank,tg_instructions=tg_obj.instructions,ts_obj=rs.training_schedule[rb.ts_id],ts_duration=ts_obj.time_duration;total=pF(tg_price)*nr_days;var r_t_table=[];r_t_table.push([{text:rs.l.l("name"),style:"tableHeader"},{text:rs.l.l("description"),style:"tableHeader"},{text:rs.l.l("price"),style:"tableHeader"},{text:rs.l.l("nr_days"),style:"tableHeader"},{text:rs.l.l("total"),style:"tableHeader"}]);a.forEach(rs.training_options,function(to){if(to.tg_id==rb.tg_id){var t_name=to.v,t_description=to.description,t_price=to.price,t_total=0;t_total=pF(t_price)*pF(nr_days);total+=t_total;r_t_table.push([t_name,t_description,"$"+pF(t_price).toFixed(2),"x "+pF(nr_days).toFixed(0),"$"+pF(t_total).toFixed(2)])}})}subtotal=total;if(tbl=="r_boarding"||tbl=="r_daycare"){var is_r_ss=0,r_ss_table=[],r_ss_total=0;if(rs.ma(rb.r_ss).length>0){is_r_ss=1;r_ss_table.push([{text:rs.l.l("date"),style:"tableHeader"},{text:rs.l.l("qty"),style:"tableHeader"},{text:rs.l.l("service"),style:"tableHeader"},{text:rs.l.l("instructions"),style:"tableHeader"},{text:rs.l.l("price"),style:"tableHeader"},{text:rs.l.l("exclude_on_checkin"),style:"tableHeader"},{text:rs.l.l("exclude_on_checkout"),style:"tableHeader"},{text:rs.l.l("total"),style:"tableHeader"}]);a.forEach(rb.r_ss,function(r_ss){var r_ss_item_total=0;if(r_ss.ss_exclude_checkin&&r_ss.ss_exclude_checkout&&nr_days>2){if(r_ss.ss_everyday){r_ss_item_total+=(nr_days-2)*r_ss.ss_times*r_ss.ss_price}else{r_ss_item_total+=r_ss.ss_times*r_ss.ss_price}}else if((r_ss.ss_exclude_checkin||r_ss.ss_exclude_checkout)&&nr_days!=1){if(r_ss.ss_everyday){r_ss_item_total+=(nr_days-1)*r_ss.ss_times*r_ss.ss_price}else{r_ss_item_total+=r_ss.ss_times*r_ss.ss_price}}else{if(r_ss.ss_everyday){r_ss_item_total+=nr_days*r_ss.ss_times*r_ss.ss_price}else{r_ss_item_total+=r_ss.ss_times*r_ss.ss_price}}r_ss_total+=r_ss_item_total;r_ss_table.push([r_ss.ss_everyday==1?"everyday":r_ss.ss_date,r_ss.ss_times.toFixed(0),rs.schedule_services[r_ss.ss_id].v,r_ss.ss_instructions||"-","$ "+r_ss.ss_price,r_ss.ss_exclude_checkin?"yes":"no",r_ss.ss_exclude_checkout?"yes":"no","$ "+r_ss_item_total.toFixed(2)])});total+=r_ss_total}var is_r_meds=0,r_meds_table=[],r_meds_total=0;if(rs.ma(rb.r_meds).length>0){is_r_meds=1;r_meds_table.push([{text:rs.l.l("name"),style:"tableHeader"},{text:rs.l.l("price"),style:"tableHeader"},{text:rs.l.l("as_needed"),style:"tableHeader"},{text:rs.l.l("instructions"),style:"tableHeader"},{text:rs.l.l("med_type"),style:"tableHeader"},{text:rs.l.l("dose_type"),style:"tableHeader"},{text:rs.l.l("date"),style:"tableHeader"},{text:rs.l.l("total"),style:"tableHeader"}]);a.forEach(rb.r_meds,function(r_med){var r_med_item_total=0;if(r_med.med_everyday){r_med_item_total+=nr_days*rs.meds[r_med.med_id].price}else{r_med_item_total+=rs.meds[r_med.med_id].price}r_meds_total+=r_med_item_total;r_meds_table.push([rs.meds[r_med.med_id].v,"$ "+rs.meds[r_med.med_id].price.toFixed(2),r_med.med_as_needed?"as needed":"-",r_med.med_instructions||"-",rs.meds_type[r_med.med_type_id].v,(r_med.med_dosage_id?rs.md_dosage[r_med.med_dosage_id].v:rs.md_dose_type[r_med.med_dose_type_id].v).toFixed(2),r_med.med_everyday?"daily":r_med.med_date,"$ "+r_med_item_total])});total+=r_meds_total}var is_r_diets=0,r_diets_table=[],r_diets_total=0;if(rs.ma(rb.r_diets).length>0){is_r_diets=1;r_diets_table.push([{text:rs.l.l("name"),style:"tableHeader"},{text:rs.l.l("price"),style:"tableHeader"},{text:rs.l.l("as_needed"),style:"tableHeader"},{text:rs.l.l("instructions"),style:"tableHeader"},{text:rs.l.l("diet_type"),style:"tableHeader"},{text:rs.l.l("dose_type"),style:"tableHeader"},{text:rs.l.l("date"),style:"tableHeader"},{text:rs.l.l("total"),style:"tableHeader"}]);a.forEach(rb.r_diets,function(r_diet){var r_diet_item_total=0;if(r_diet.diet_everyday){r_diet_item_total+=nr_days*rs.diets[r_diet.diet_id].price}else{r_diet_item_total+=rs.diets[r_diet.diet_id].price}r_diets_total+=r_diet_item_total;r_diets_table.push([rs.diets[r_diet.diet_id].v,"$ "+rs.diets[r_diet.diet_id].price.toFixed(2),r_diet.diet_as_needed?"as needed":"-",r_diet.diet_instructions||"-",rs.diets_type[r_diet.diet_type_id].v,(r_diet.diet_dosage_id?rs.md_dosage[r_diet.diet_dosage_id].v:rs.md_dose_type[r_diet.diet_dose_type_id].v).toFixed(2),r_diet.diet_everyday?"daily":r_diet.diet_date,"$ "+r_diet_item_total])});total+=r_diets_total}}var docDefinition={content:[{image:pdf.hr_image},{text:type_of_report+"\n",style:"topTitle"},{columns:[{width:"50%",text:[{text:rs.l.l("customer_name")+": "+client_name+"\n",style:"subTitle"},{text:rs.l.l("email")+": "+client_email+"\n",style:"subTitle"},{text:rs.l.l("contact_phone")+": "+client_phone+"\n\n",style:"subTitle"},{text:rs.l.l("pet_name")+": "+pet_name+"\n",style:"subTitle"},{text:rs.l.l("pet_type")+": "+pet_type+"\n",style:"subTitle"},{text:rs.l.l("pet_breed")+": "+pet_breed+"\n\n\n",style:"subTitle"},tbl=="r_boarding"?{text:rs.l.l("stay_reason")+": "+stay_reason+"\n"+rs.l.l("luggage")+": "+luggage+"\n"+rs.l.l("is_handle_carefully")+": "+is_handle_carefully+"\n"+rs.l.l("is_extra_pet")+": "+is_extra_pet+"\n",style:"subTitle3"}:{text:""},tbl=="r_grooms"?{text:rs.l.l("pet_size")+": "+pet_size_v+"\n"+rs.l.l("groomer")+": "+groomer_v+"\n"+rs.l.l("grooming_rate")+": "+grooming_rate_v+"\n"+rs.l.l("grooming_rate_multiplier")+": "+grooming_rate_multiplier+"\n"+rs.l.l("is_handle_carefully")+": "+is_hcp_v+"\n"+rs.l.l("base_type_service")+": "+base_type_v+"\n",style:"subTitle3"}:{text:""},tbl=="r_training"?{text:rs.l.l("trainer")+": "+trainer_v+"\n"+rs.l.l("training_group")+": "+tg_v+"\n"+rs.l.l("limit")+": "+tg_limit+"\n"+rs.l.l("price")+": $ "+pF(tg_price).toFixed(2)+"\n"+rs.l.l("rank")+": "+tg_rank+"\n"+rs.l.l("instructions")+": "+tg_instructions+"\n"+rs.l.l("duration")+": "+ts_duration+"\n",style:"subTitle3"}:{text:""}]},{width:"50%",text:[{text:rs.l.l("date_in")+": "+date_in+"\n",style:"subTitle2"},{text:rs.l.l("time_in")+": "+time_in+"\n\n",style:"subTitle2"},{text:rs.l.l("date_out")+": "+date_out+"\n",style:"subTitle2"},{text:rs.l.l("time_out")+": "+time_out+"\n\n",style:"subTitle2"},tbl=="r_boarding"?{text:rs.l.l("type")+": "+c_type+" [ "+c_v+" ]\n",style:"subTitle2"}:{text:""},tbl=="r_daycare"?{text:rs.l.l("type")+": "+c_v+" \n",style:"subTitle2"}:{text:""},tbl=="r_boarding"||tbl=="r_daycare"?!is_halfday?{text:rs.l.l("price_fullday")+": $ "+c_fullday+"\n",style:"subTitle2"}:{text:rs.l.l("price_halfday")+": $ "+c_halfday+"\n",style:"subTitle2"}:{text:""},{text:rs.l.l("nr_days")+": "+nr_days+"\n\n",style:"subTitle2"},is_r_ss?{text:rs.l.l("schedule_services")+" - $ "+pF(r_ss_total).toFixed(2)+"\n",style:"subTitle2"}:{text:""},is_r_meds?{text:rs.l.l("meds")+" - $ "+pF(r_meds_total).toFixed(2)+"\n",style:"subTitle2"}:{text:""},is_r_diets?{text:rs.l.l("diets")+" - $ "+pF(r_diets_total).toFixed(2)+"\n",style:"subTitle2"}:{text:""},{text:"\n"+rs.l.l("subtotal")+" - $ "+pF(subtotal).toFixed(2)+"\n",style:"subTitle2"},{text:rs.l.l("total").toUpperCase()+" - $ "+pF(total).toFixed(2)+"\n\n",style:"topTitle2"}]}]},is_r_ss?{text:rs.l.l("schedule_services")+" - $ "+r_ss_total+"\n",style:"topTitle2"}:{text:""},is_r_ss?{style:"tableExample",table:{headerRows:1,widths:["10%","10%","20%","20%","10%","10%","10%","10%"],body:r_ss_table},layout:"lightHorizontalLines"}:{text:""},is_r_ss?{text:"\n\n"}:{text:" "},is_r_meds?{text:rs.l.l("meds")+" - $ "+r_meds_total+"\n",style:"topTitle2"}:{text:""},is_r_meds?{style:"tableExample",table:{headerRows:1,widths:["auto","auto","auto","auto","auto","auto","auto","auto"],body:r_meds_table},layout:"lightHorizontalLines"}:{text:""},is_r_meds?{text:"\n\n"}:{text:" "},is_r_diets?{text:rs.l.l("diets")+" - $ "+r_diets_total+"\n",style:"topTitle2"}:{text:""},is_r_diets?{style:"tableExample",table:{headerRows:1,widths:["auto","auto","auto","auto","auto","auto","auto","auto"],body:r_diets_table},layout:"lightHorizontalLines"}:{text:""},is_r_diets?{text:"\n\n"}:{text:" "},tbl=="r_grooms"?{text:rs.l.l("grooming_services")+"\n",style:"topTitle2"}:{text:""},tbl=="r_grooms"?{style:"tableExample",table:{headerRows:1,widths:["auto","auto","auto","auto","auto","auto"],body:r_gs_table},layout:"lightHorizontalLines"}:{text:""},tbl=="r_grooms"?{text:"\n\n"}:{text:" "},tbl=="r_training"?{text:rs.l.l("training_services")+"\n",style:"topTitle2"}:{text:""},tbl=="r_training"?{style:"tableExample",table:{headerRows:1,widths:["auto","auto","auto","auto","auto"],body:r_t_table},layout:"lightHorizontalLines"}:{text:""},tbl=="r_training"?{text:"\n\n"}:{text:" "}],styles:pdf.styles};if(!without_print){docDefinition.content.unshift(pdf.contactInfoHeader());var report_name=tbl+"_"+rs.client.first_name+"_"+rs.client.last_name+"_"+rs.getCDT()+".pdf";pdf.options(o.print_type,docDefinition,report_name)}return{total:total}}};var scrollUpRun=function(){$(document).ready(function(){var mainContent=document.getElementById("mainContent"),body=$("body");mainContent.style.height=body.innerHeight()+"px";$("#pet-info").css("height",body.innerHeight()-80+"px");$(".pet-rsv").css("height",body.innerHeight()-150+"px");$("#leftMenu").css("height",body.innerHeight()-80+"px");mainContent.addEventListener("scroll",function(){if($(this).scrollTop()>100){$(".scrollup").fadeIn()}else{$(".scrollup").fadeOut()}},false);$(".scrollup").click(function(){mainContent.scrollTop=0;return false})})};var loadingMaskRun=function(){var loadingMaskModels=document.getElementById("loading-mask-models");rs.is_models=false;rs.$on("loading:progress",function(){if(rs.is_models){loadingMaskModels.style.display="block";rs.is_models=false}});rs.$on("loading:finished",function(){loadingMaskModels.style.display="none";rs.is_models=false});window.onload=function(){document.getElementById("loading-mask-resources").style.display="none"}};var foundationRun=function(){$(document).foundation({abide:{patterns:{number:/[0-9]/,time_pattern:/[0-9]{2}\:[0-9]{2}(\:[0-9]{2})?/}}})};var validatorsRun=function(){rs.checkDatesExists=function(s,table,mod,d_in,d_out,post){if(!post.break_submit){a.forEach(rs.pet[table],function(item){if(item.in_out=="in"){var date_in=new Date(item[d_in]).getTime(),date_out=new Date(item[d_out]).getTime(),date_in_input=new Date(s[mod][d_in]).getTime(),date_out_input=new Date(s[mod][d_out]).getTime();if(date_in_input>=date_in&&date_in_input<=date_out||date_out_input>=date_in&&date_out_input<=date_out){rs.alertMsg("Pet already has reservation in this period, please check and modify if necesary");post.break_submit=1;return false}}})}};rs.checkDatesBigger=function(s,mod,d_in,d_out,post){var date_in=new Date(s[mod][d_in]).getTime(),date_out=new Date(s[mod][d_out]).getTime();if(date_out<date_in){rs.alertMsg("Please select date out to be bigger or equal than date in");post.break_submit=1;return false}};rs.checkDatesToday=function(s,mod,d_in,post){if(!post.break_submit){var date_in=new Date(s[mod][d_in]).getTime(),date_now=new Date(rs.getCurrentDate()).getTime();if(date_in<date_now){rs.alertMsg("Cannot add past dates for reservations!");post.break_submit=1;return false}}};rs.checkDatesExtra=function(s,mod,d_in,d_out,checked_date,post,message){if(!post.break_submit){var date_in=new Date(s[mod][d_in]).getTime(),date_out=new Date(s[mod][d_out]).getTime(),checked_date_input=new Date(checked_date).getTime();if(checked_date_input<date_in||checked_date_input>date_out){rs.alertMsg(message);post.break_submit=1;return false}}};rs.checkCheckInOutTime=function(s,mod,t_in,t_out,post){if(!post.break_submit){var time_in_t=rs.getTimeTimestamp(s[mod][t_in]),time_out_t=rs.getTimeTimestamp(s[mod][t_out]),default_time_in_t=rs.getTimeTimestamp(rs.boarding_settings.check_in_time),default_time_out_t=rs.getTimeTimestamp(rs.boarding_settings.check_out_time);if(s[mod][t_in]&&s[mod][t_out]&&time_in_t>time_out_t){rs.alertMsg("Check out time cannot be earlier thant check in time !");post.break_submit=1}else if(s[mod][t_in]&&time_in_t<default_time_in_t){rs.alertMsg('The time of check in is much earlier than the specified check in time in "Boarding settings & charges"');post.break_submit=1}else if(s[mod][t_in]&&time_in_t>default_time_out_t){rs.alertMsg('The time in is later than the specified check out closing time in "Boarding settings & charges"');post.break_submit=1}else if(s[mod][t_out]&&time_out_t<default_time_in_t){rs.alertMsg('The time of check out is much earlier than the specified check in time in "Boarding settings & charges"');post.break_submit=1}else if(s[mod][t_out]&&time_out_t>default_time_out_t){rs.alertMsg('The time of check out is later than the specified check out closing time in "Boarding settings & charges"');post.break_submit=1}}};rs.checkDatesWeekendHolidaysSeason=function(s,mod,d_in,d_out,post){if(!post.break_submit){var date_in=new Date(s[mod][d_in]),date_out=new Date(s[mod][d_out]),date_in_t=date_in.getTime(),date_out_t=date_out.getTime(),nr_days=0;if(date_out_t-date_in_t==0){nr_days=1}else{nr_days=(date_out_t-date_in_t)/86400}for(var i=0;i<=nr_days;i++){var date_c=date_in;date_c.setDate(date_in.getDate()+i);var date_c_name=date_c.toString().substring(0,3).toLowerCase();if(date_c_name=="sat"&&!rs.boarding_settings.available_for_saturdays){rs.alertMsg("Reservations are not available on saturdays !");post.break_submit=1;return false}else if(date_c_name=="sun"&&!rs.boarding_settings.available_for_sundays){rs.alertMsg("Reservations are not available on sundays !");post.break_submit=1;return false}}}}};var mainCtrl=function($scope){var s=$scope;rs.parseStyle=function(f,from,to){if(s[f]){var eval_html=s.$eval("'"+$(from).html()+"'");$(to).html(eval_html)}}};var taxSettingsCtrl=function($scope){var s=$scope};var boardingSettings=function($scope,crud){var s=$scope;s.boardingPetSizes={array:[{t:"Pet size",c:"v",is_p:1},{t:"Limit",c:"limits",is_p:1},{t:"Full day",c:"full_day",p:"$",f:" | number:2",is_p:1},{t:"Half day",c:"half_day",p:"$",f:" | number:2",is_p:1},{t:"From weight",c:"from_weight",is_p:1},{t:"To weight",c:"to_weight",is_p:1},{t:"In use",c:"status_id",is_p:0,is_c:1},{t:"Override",c:"override",is_c:1,is_p:0}],tbl:"boarding_petsizes",t:"boarding_petsizes",predicate:"predicate_ps",reverse:"reverse_ps",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.boarding_petsizes};
s.boardingRunTypes={array:[{t:"Runtype",c:"v",is_p:1},{t:"Limit",c:"limits",is_p:1},{t:"Full day",c:"full_day",p:"$",f:" | number:2",is_p:1},{t:"Half day",c:"half_day",p:"$",f:" | number:2",is_p:1},{t:"In use",c:"status_id",is_c:1,is_p:0},{t:"Override",c:"override",is_c:1,is_p:0}],tbl:"boarding_runtypes",t:"boarding_runtypes",predicate:"predicate_rt",reverse:"reverse_rt",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.boarding_runtypes}};var daycareGroupsCtrl=function($scope,crud){var s=$scope;s.daycareGroups={array:[{t:"ID",c:"id",is_p:1},{t:"Name",c:"v",is_p:1},{t:"Limits",c:"limits",is_p:1},{t:"Fullday rate",c:"full_day",p:"$",f:" | number:2",is_p:1},{t:"Halfday rate",c:"half_day",p:"$",f:" | number:2",is_p:1},{t:"In use",c:"status_id",is_p:0,is_c:1},{t:"Override",c:"override",is_c:1,is_p:0}],tbl:"daycare_groups",t:"daycare_groups",predicate:"predicate_dg",reverse:"reverse_dg",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.daycare_grous}};var groomingGeneralCtrl=function($scope,api,crud){var s=$scope;s.saveGo=function(){rs.hs(".btn_save_go",".al_save_go");var go_query="";a.forEach(rs.grooming_options,function(item){go_query+='update `grooming_options` set `v` = "'+item.v+'" where `id` = "'+item.id+'"; '});api.query("grooming_options",go_query,"multi_query").then(function(){rs.sh(".btn_save_go",".al_save_go")})};s.saveGp=function(){rs.hs(".btn_save_gp",".al_save_gp");var data={groomer_id:s.groomer_id,pet_breed_id:s.pet_breed_id,priority:s.priority};api.post("grooming_priority","",data).then(function(r){data.id=r.data.id;if(data.id){crud.setTableAfterSubmit(crud.tbl_arr.grooming_priority,data)}rs.sh(".btn_save_gp",".al_save_gp")})};s.deleteGp=function(gp){crud.deleteItem(crud.tbl_arr.grooming_priority,"grooming_priority",gp.id)};s.saveBt=function(nr,id){rs.hs(".btn_save_bt"+nr,".al_save_bt"+nr);var data={v:rs.grooming_options[id].v};api.post("grooming_options",id,data).then(function(r){rs.sh(".btn_save_bt"+nr,".al_save_bt"+nr)})}};var groomingRatesCtrl=function($scope,api,crud){var s=$scope;s.groomingRates={array:[{t:"Grooming type",c:"v",is_p:1},{t:"Multiplier",c:"multiplier",is_p:1},{t:"Change price",c:"change_price",is_c:1,is_p:1}],tbl:"grooming_rates",t:"grooming_rates",predicate:"predicate_gr",reverse:"reverse_gr",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.grooming_rates};s.saveHr=function(){rs.hs(".btn_save_hr",".al_save_hr");var hr_query="";a.forEach([9,10,11],function(id){var item=rs.grooming_options[id];hr_query+='update `grooming_options` set `v` = "'+item.v+'" where `id` = "'+item.id+'"; '});api.query("grooming_options",hr_query,"multi_query").then(function(){rs.sh(".btn_save_hr",".al_save_hr")})}};var groomingServicesCtrl=function($scope,api,crud){var s=$scope;rs.base_type_filter.unshift({n:"- all types -",v:""});s.groomingServices={array:[{t:"Grooming service",c:"v",is_p:1},{t:"Type",c:"base_type_id",is_s:1,w_e:1,v:"n",o:"$root.base_type_array",is_p:1},{t:"Miniature",c:"miniature",p:"$",f:" | number:2",is_p:1},{t:"Small",c:"v_1",p:"$",f:" | number:2",is_p:1},{t:"Medium",c:"v_2",p:"$",f:" | number:2",is_p:1},{t:"Large",c:"v_3",p:"$",f:" | number:2",is_p:1},{t:"Miniature",c:"v_4",p:"$",f:" | number:2",is_p:1},{t:"Med Lg",c:"v_5",p:"$",f:" | number:2",is_p:1},{t:"Giant",c:"v_6",p:"$",f:" | number:2",is_p:1},{t:"Cat",c:"v_7",p:"$",f:" | number:2",is_p:1},{t:"Other",c:"v_8",p:"$",f:" | number:2",is_p:1},{t:"HCP",c:"hcp",p:"$",f:" | number:2",is_p:1,tt:"Handle carefully price"},{t:"In use",c:"in_use",is_c:1,is_p:1}],tbl:"grooming_services",t:"grooming_services",predicate:"predicate_gs",reverse:"reverse_gs",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.grooming_services,with_default_filter:{n:"base_type_id",v:"1",m:"gs_type"}}};var trainingGroupsCtrl=function($scope,api){var s=$scope;s.trainingGroups={array:[{t:"Rank",c:"rank",is_p:1},{t:"Name",c:"v",is_p:1},{t:"Price",c:"price",p:"$",f:" | number:2",is_p:1},{t:"Limit",c:"limit",is_p:1},{t:"Instructions",c:"instructions",is_p:0}],tbl:"training_groups",t:"training_groups",predicate:"predicate_tg",reverse:"reverse_tg",all_have_predicate:0,show:{},tables_arr:[{tbl:"training_groups",t:"rs",with_id:1},{tbl:"training_groups",t:"ws",with_id:1}]};s.trainingOptions={array:[{t:"Name",c:"v",is_p:0},{t:"Description",c:"description",is_p:0},{t:"Price",c:"price",p:"$",f:" | number:2",is_p:0}],tbl:"training_options",t:"training_options",predicate:"predicate_to",reverse:"reverse_to",all_have_predicate:0,show:{},tables_arr:[{tbl:"training_options",t:"rs",with_id:1},{tbl:"training_options",t:"ws",with_id:1}]};s.tg_id=null;s.selectTgId=function(el){s.tg_id=el.id;s.training_options={};a.forEach(rs.training_options,function(item){if(item.tg_id==s.tg_id){s.training_options[item.id]=item}})}};var trainingScheduleCtrl=function($scope,crud){var s=$scope;rs.post.ts={afterSubmit:function(){crud.setTableAfterSubmit(crud.tbl_arr.training_schedule,s.ts);s.ts={}}};s.trainingSchedule={array:[{t:"Class name",c:"tg_id",is_s:1,v:"v",o:"$root.training_groups",is_p:1},{t:"Date start",c:"date_in",is_p:1,is_date:1},{t:"Time in",c:"time_in",is_p:1,is_time:1},{t:"Date end",c:"date_out",is_p:1,is_date:1},{t:"Time out",c:"time_out",is_p:1,is_time:1},{t:"Duration/Time",c:"time_duration",is_p:1,is_time:1},{t:"Limit",c:"tg_id",is_t:1,v:"limit",o:"$root.training_groups",is_p:1},{t:"Rate",c:"tg_id",is_t:1,v:"price",o:"$root.training_groups",is_p:1,p:"$",f:" | number:2"},{t:"Trainer",c:"t_id",is_s:1,v:"v",o:"$root.trainers",is_p:1}],tbl:"training_schedule",t:"training_schedule",predicate:"predicate_ts",reverse:"reverse_ts",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.training_schedule}};var basicInformationCtrl=function($scope,pdf){var s=$scope;rs.post.basic_information={afterSubmit:function(){pdf.makeImage(rs,"settings","report_image_id","report_image","path_thumb")}}};var generalSettingsCtrl=function($scope,settings){var s=$scope;rs.post.general_settings={afterSubmit:function(){rs.parseStyle("settings","#fromStyle","#toStyle");settings.buildSiteLogo()}}};var commissionsCtrl=function($scope,api,crud,settings){var s=$scope;s.cg_mod={};s.ct_mod={};s.updateC=function(target,table){$(".cBtn").hide();$(".cAl").show();var data={commissions_new_customers_board:rs.boarding_settings.commissions_new_customers_board};api.post("boarding_settings","",data).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.boarding_settings,data);$(".cBtn").fadeIn("medium");$(".cAl").hide()})};s.changeGT=function(id,target,table){s[target]=rs[table][id]};s.updateGT=function(id,target,table){var error=false;switch(target){case"cg_mod":if(!id){rs.alertMsg("Select a groomer please");error=true}break;case"ct_mod":if(!id){rs.alertMsg("Select a trainer please");error=true}break}if(!error){switch(target){case"cg_mod":$(".cgBtn").hide();$(".cgAl").show();break;case"ct_mod":$(".ctBtn").hide();$(".ctAl").show();break}api.post(table,id,s[target]).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr[table],s[target]);settings.buildUsersRoles();switch(target){case"cg_mod":$(".cgBtn").fadeIn("medium");$(".cgAl").hide();break;case"ct_mod":$(".ctBtn").fadeIn("medium");$(".ctAl").hide();break}})}};s.updateSR=function(id,data,table,target){$("."+target+"Btn"+id).hide();$("."+target+"Al"+id).show();api.post(table,id,data).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr[table],data);$("."+target+"Btn"+id).fadeIn("medium");$("."+target+"Al"+id).hide()})};s.setAll=function(percentage,table){a.forEach(rs[table],function(item,id){rs[table][id].commission_percentage=percentage});var go_query="update "+table+" set commission_percentage='"+percentage+"'";api.query(table,go_query,"multi_query")};s.changeGrooming=function(){a.forEach(rs.grooming_commissions,function(item){if(item.groomer_id==s.cg_mod.groomer_id){s.cg_mod=item;s.$broadcast("cg_mod");return false}})};s.saveGrooming=function(){if(!s.cg_mod.groomer_id){rs.alertMsg("Please select a groomer first")}else{rs.hs(".btn_cg",".al_cg");var id=s.cg_mod.id||"";api.post("grooming_commissions",id,s.cg_mod).then(function(r){s.cg_mod.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.grooming_commissions,s.cg_mod);s.$broadcast("cg_mod");rs.sh(".btn_cg",".al_cg")})}}};var holidayAndSeasonCtrl=function($scope,api,crud){var s=$scope;asd=s;s.holidaySetup={array:[{t:"Holiday name",c:"v",is_p:1},{t:"Date",c:"date",is_p:1,is_date:1},{t:"Open",c:"open",is_p:1,is_c:1}],tbl:"holiday",t:"holiday",predicate:"predicate_h",reverse:"reverse_h",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.holiday};s.setSm=function(season_mod){s.season_mod=season_mod};s.sdaDates=function(){a.forEach(rs.days,function(d){s.season_mod["is_"+d]=!s.season_mod["is_"+d]})};s.saveSs=function(){if(s.season_mod.id){rs.sh(".al_ss",".btn_ss");api.post("season",s.season_mod.id,s.season_mod).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.season,s.season_mod);rs.hs(".al_ss",".btn_ss")})}else{rs.alertMsg("Please select a season")}};s.saveSsr=function(){rs.sh(".al_ssr",".btn_ssr");a.forEach(rs.season,function(item){api.post("season",item.id,item).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.season,item);rs.hs(".al_ssr",".btn_ssr")})})}};var myAccountCtrl=function($scope,crud,api){var s=$scope;rs.identity.password="";rs.post.identity={afterSubmit:function(){crud.setTableAfterSubmit(crud.tbl_arr.users,rs.identity)}}};var rewardsProgramCtrl=function($scope,crud){var s=$scope;rs.post.promotions_mod={afterSubmit:function(){crud.setTableAfterSubmit(crud.tbl_arr.promotions,s.promotions_mod);s.promotions_mod={}}};s.editPromotion=function(p){s.promotions_mod=p};s.deletePromotion=function(id){rs.confirmMsg("Are you sure you want to delete this promotion",function(){crud.deleteItem(crud.tbl_arr.promotions,"promotions",id)})}};var userInterfaceCtrl=function($scope,settings){var s=$scope;s.doTelFormats=function(){settings.buildFoundationPatterns()}};var layoutSettingsCtrl=function($scope,api,crud){var s=$scope;s.layoutBoardingPetSizes={array:[{t:"Pet size",c:"v",is_p:1},{t:"Limit",c:"limits",is_p:1},{t:"Full day",c:"full_day",p:"$",f:" | number:2",is_p:1},{t:"Half day",c:"half_day",p:"$",f:" | number:2",is_p:1},{t:"From weight",c:"from_weight",is_p:1},{t:"To weight",c:"to_weight",is_p:1},{t:"In use",c:"status_id",is_p:0,is_c:1},{t:"Override",c:"override",is_c:1,is_p:0}],tbl:"boarding_petsizes",t:"boarding_petsizes",predicate:"predicate_ps",reverse:"reverse_ps",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.boarding_petsizes};s.layoutBoardingRunTypes={array:[{t:"Runtype",c:"v",is_p:1},{t:"Limit",c:"limits",is_p:1},{t:"Full day",c:"full_day",p:"$",f:" | number:2",is_p:1},{t:"Half day",c:"half_day",p:"$",f:" | number:2",is_p:1},{t:"In use",c:"status_id",is_c:1,is_p:0},{t:"Override",c:"override",is_c:1,is_p:0}],tbl:"boarding_runtypes",t:"boarding_runtypes",predicate:"predicate_rt",reverse:"reverse_rt",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.boarding_runtypes};s.saveLs=function(){rs.hs(".btn_save_ls",".al_save_ls");var go_query="";a.forEach(rs.layout_sections,function(item){go_query+='update `layout_sections` set `in_use` = "'+(item.in_use?1:0)+'", `v` = "'+item.v+'" where `id` = "'+item.id+'"; '});console.log(go_query);api.query("layout_sections",go_query,"multi_query").then(function(){rs.sh(".btn_save_ls",".al_save_ls")})};s.setLr=function(lr){s.layout_runs_mod=lr};s.deleteLr=function(lr){rs.confirmMsg("Are you sure you want to delete this ?",function(){crud.deleteItem(crud.tbl_arr.layout_runs,"layout_runs",lr.id)})}};var discountsBoardingCtrl=function($scope,api,crud){var s=$scope;s.saveLtd=function(){rs.sh(".al_sltd",".btn_sltd");a.forEach(rs.discounts_boarding_long_term,function(item){api.post("discounts_boarding_long_term",item.id,item).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.discounts_boarding_long_term,item);rs.hs(".al_sltd",".btn_sltd")})})};s.saveNc=function(){rs.sh(".al_snc",".btn_snc");a.forEach(rs.discounts_boarding_new_client,function(item){api.post("discounts_boarding_new_client",item.id,item).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.discounts_boarding_new_client,item);rs.hs(".al_snc",".btn_snc")})})};s.savePc=function(){rs.sh(".al_spc",".btn_spc");a.forEach(rs.discounts_boarding_priority_club,function(item){api.post("discounts_boarding_priority_club",item.id,item).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.discounts_boarding_priority_club,item);rs.hs(".al_spc",".btn_spc")})})};s.discountsBoardingMultiplePet={array:[{t:"ID",c:"id",is_p:1},{t:"Type",c:"boarding_runtype_id",is_s:1,v:"v",o:"$root.boarding_runtypes",is_p:1},{t:"In %",c:"is_percentage",is_p:1,is_c:1},{t:"1 Pet discount",c:"1_pet_discount",is_p:1},{t:"2 Pet discount",c:"2_pet_discount",is_p:1},{t:"3 Pet discount",c:"3_pet_discount",is_p:1}],tbl:"discounts_boarding_multiple_pet",t:"discounts_boarding_multiple_pet",predicate:"predicate_dbmp",reverse:"reverse_dbmp",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.discounts_boarding_multiple_pet}};var passwordManagementCtrl=function(){};var securityCenterCtrl=function($scope,api,crud){var s=$scope;s.saveCenter=function(){if(!s.user_id||!s.role_id){rs.alertMsg("Please select employee and level of access")}else{rs.hs(".btn_save_center",".al_save_center");var user_data=rs.users[s.user_id];user_data.role_id=s.role_id;api.post("users",user_data.id,user_data).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.users,user_data);rs.sh(".btn_save_center",".al_save_center")})}}};var securityLevelsCtrl=function($scope,api,crud,$timeout,settings){var s=$scope;s.loading=false;s.role_v="";s.r_sl_cp=[];s.addRole=function(){if(!s.role_v){rs.alertMsg("Please enter a name for the desired level")}else{s.loading=true;var role_mod={n:rs.lowercaseUnderscore(s.role_v),v:s.role_v};api.post("role","",role_mod).then(function(r){role_mod.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.role,role_mod);s.role_v="";var sl_cp_query="",v=false;a.forEach(rs.security_levels,function(item,sl_id){sl_cp_query+="insert into `sl_cp` set `role_id` = '"+role_mod.id+"', `sl_id` = '"+sl_id+"', `v` = '"+v+"'; "});api.query("sl_cp",sl_cp_query,"multi_query").then(function(){$timeout(function(){api.get("sl_cp","","",{filter:{role_id:role_mod.id}}).then(function(r){a.forEach(r.data,function(item){crud.setTableAfterSubmit(crud.tbl_arr.sl_cp,item)});settings.buildSecurityLevels();s.setRoleId(role_mod.id);s.loading=false})},3e3)})})}};s.deleteRole=function(r){rs.confirmMsg("Be carefull, deleting roles causes serious problems on users and "+" their management, are you sure you want to continue ?",function(){s.loading=true;crud.deleteItem(crud.tbl_arr.role,"role",r.id,false,"permanent");var sl_cp_query="delete from `sl_cp` where `role_id` = '"+r.id+"';";api.query("sl_cp",sl_cp_query,"multi_query").then(function(){$timeout(function(){a.forEach(rs.sl_cp,function(item){if(item.role_id==r.id){crud.deleteItem(crud.tbl_arr.sl_cp,"sl_cp",item.id,true)}});settings.buildSecurityLevels();s.setRoleId(1);s.loading=false},3e3)})})};s.saveLevels=function(){rs.hs(".btn_save_levels",".al_save_levels");var sl_cp_query="";a.forEach(rs.sl_cp,function(item,id){if(s.role_id==item.role_id){var data={id:id,role_id:item.role_id,sl_id:item.sl_id,v:item.v};crud.setTableAfterSubmit([{tbl:"sl_cp",t:"ws",with_id:1}],data);sl_cp_query+="update `sl_cp` set `v` = '"+item.v+"' where `id` = '"+id+"'; "}});api.query("sl_cp",sl_cp_query,"multi_query").then(function(r){rs.sh(".btn_save_levels",".al_save_levels")})};s.cuAll=function(start,end,value){for(i=start;i<end;i++){var sl_cp_id=s.r_sl_cp[i].id;rs.sl_cp[sl_cp_id].v=value}};s.setRoleId=function(role_id){s.role_id=role_id;s.r_sl_cp=[];a.forEach(rs.sl_cp,function(item,sl_cp_id){if(item.role_id==s.role_id){if(item.sl_id&&item){s.r_sl_cp.push({id:sl_cp_id,title:rs.security_levels[item.sl_id].title})}}})};s.setRoleId(1)};var asterixRgFilter=function($compile){return function(id){var str="";if(["17","34","38"].indexOf(id)!==-1){str='<span style="color: #ff0000">*</span>'}else if(["22","32","33","37","38"].indexOf(id)!==-1){str='<span style="color: #00aa00">*</span>'}$("#cb"+id).replaceWith(str)}};var cuFieldsetDirective=function($compile){return{restrict:"E",link:function(scope,el,atts){template='<fieldset style="margin-bottom: 30px;">'+'<div style="margin-top: -50px;>'+'<div class="left"><h4>'+atts.title+"</h4></div>"+'<div class="right">'+'<a class="" '+' ng-click="cuAll('+atts.start+","+atts.end+', true)">'+'<sub><i class="fa fa-check"></i> Check</sub></a> '+" - "+'<a class="" '+' ng-click="cuAll('+atts.start+","+atts.end+', false)"><sub>Uncheck</sub></a>'+"</div>"+"</div>"+'<div ng-repeat="rsl in r_sl_cp | array | slice:'+atts.start+":"+atts.end+'">'+"<input-checkbox "+' title="{{rsl.title}}" '+" ng-model=\"sl_cp['{{rsl.id}}'].v\"> "+"</input-checkbox> "+'<div class="left" style="margin-right: 10px; font-size: 20px;"> '+' <div id="cb{{$root.sl_cp[rsl.id].sl_id}}">&nbsp;</div> '+"</div>"+" {{$root.sl_cp[rsl.id].sl_id | asterixRg}} "+"</div>"+"</fieldset>";el.replaceWith($compile(template)(scope))}}};var generalFeaturesCtrl=function($scope,api,crud,settings,cp){var s=$scope;s.saveGf=function(){rs.hs(".btn_save_gf",".al_save_gf");var gf_query="";a.forEach(rs.general_features,function(item){gf_query+='update `general_features` set `v` = "'+item.v+'" where `id` = "'+item.id+'"; '});api.query("general_features",gf_query,"multi_query").then(function(){rs.sh(".btn_save_gf",".al_save_gf")})};s.rebuildDso=function(){settings.buildDso()};s.setClientSearchBy=function(){cp.setClientSearchBy()}};var retailCtrl=function($scope,api,crud){var s=$scope;s.retailClasses={array:[{t:"ID",c:"id"},{t:"Class name",c:"class_name",is_p:1},{t:"Margin",c:"margin",f:" | number",is_p:1,tt:"INFO: set only 'margin' or 'markup', not both",p:"%"},{t:"Markup",c:"markup",f:" | number",is_p:1,tt:"INFO: set only 'margin' or 'markup', not both",pp:"$"},{t:"Sale",c:"sale",f:" | number",is_p:1,tt:"INFO: sale product - level discount percentage",p:"%"},{t:"Damage",c:"damage",f:" | number",is_p:1,tt:"INFO: damage product - level discount percentage",p:"%"},{t:"Whole",c:"whole",f:" | number",is_p:1,tt:"INFO: Wholesale - level discount percentage",p:"%"},{t:"Comp",c:"comp",f:" | number",is_p:1,tt:"INFO: complementary - level discount percentage",p:"%"},{t:"Employee",c:"employee",f:" | number",is_p:1,p:"%"},{t:"In use",c:"status_id",is_c:1,is_p:0}],tbl:"retail_classes",t:"retail_classes",predicate:"predicate_rc",reverse:"reverse_rc",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.retail_classes};s.retailInventory={array:[{t:"ID",c:"id"},{t:"Product code",c:"product_code",is_p:1,tt:"INFO: for barcodes to print 'product codes' they need to be all numbers"},{t:"Product name",c:"product_name",is_p:1},{t:"Price",c:"price",p:"$",f:" | number:2",is_p:1},{t:"Qty",c:"quantity",is_p:1,tt:"Quantity"},{t:"At",c:"at",is_p:1,tt:"Reorder"},{t:"To",c:"to",is_p:1,tt:"Reorder"},{t:"Tax",c:"tax",is_s:1,w_e:1,d:"1",v:"n",o:"taxable_array",is_p:1,tt:"Is this item taxable ?"},{t:"Class",c:"class_id",is_s:1,v:"class_name",o:"retail_classes",is_p:1}],tbl:"retail_inventory",t:"retail_inventory",predicate:"predicate_ri",reverse:"reverse_ri",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.retail_inventory,with_default_filter:{n:"class_id",v:"",m:"class_id"}};s.retailVi={array:[{t:"Vendor name",c:"retail_vendor_id",is_s:1,v:"name",o:"retail_vendors",is_p:1},{t:"Product",c:"retail_inventory_id",is_s:1,v:"product_name",o:"retail_inventory",is_p:1},{t:"Our cost",c:"our_cost",p:"$",f:" | number:2",is_p:1},{t:"Reorder number",c:"reorder_number",is_p:1}],tbl:"retail_vi",t:"retail_vi",predicate:"predicate_rvi",reverse:"reverse_rvi",all_have_predicate:0,show:{},tables_arr:crud.tbl_arr.retail_vi};s.rvi={our_cost:0};s.retail_vendor_mod={status_id:1};s.getRv=function(rv){s.retail_vendor_mod=rv};s.setRv=function(rv){s.rvi.rv=rv;s.rvi.retail_vendor_id=rv.id};s.setRi=function(ri){s.rvi.ri=ri;s.rvi.retail_inventory_id=ri.id};var retailViForm=$("#retailViForm");retailViForm.on("submit",function(){return false});retailViForm.on("valid",function(){if(!s.rvi.rv||!s.rvi.ri){rs.alertMsg("Please select vendor and product")}else{api.post("retail_vi","",s.rvi).then(function(r){s.rvi.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.retail_vi,s.rvi);s.rvi={our_cost:0};s.search_rv="";s.search_ri=""})}})};var importRetailDirective=function($compile,api,crud,$timeout){return{restrict:"E",compile:function(el,atts){return function(scope,el,atts){scope.addFile=function(t,e){var files=files||[],reader=new FileReader;files[t]=e.target.files;if(files[t][0].name.indexOf(".csv")!=-1){reader.onload=function(theFile){return function(e){scope[t]=e.target.result}}(files[t][0]);reader.readAsDataURL(files[t][0])}};$timeout(function(){$("#"+atts.table+"_file").on("change",function(e){scope.addFile(atts.table+"_file",e)})},500);scope.uploadFile=function(tbl){var target=tbl+"_file";if(scope[target]){rs.hs("#"+tbl+"_btn","#"+tbl+"_al");api.get(tbl,"","",{file:scope[target]},"/import-csv").then(function(r){if(r.data){a.forEach(r.data,function(item){crud.setTableAfterSubmit(crud.tbl_arr[tbl],item)})}else{rs.alertMsg("There is something wrong with your .CSV file, please check for right formatting")}scope[target]="";$("#"+target).val("");rs.sh("#"+tbl+"_btn","#"+tbl+"_al")})}else{rs.alertMsg("Please select .CSV file")}};var template='<fieldset class="small-12">'+'<legend><i class="'+atts.icon+'"></i> '+atts.title+"</legend>"+'<div class="small-10 column"> '+'<input type="file" id="'+atts.table+'_file" ng-model="'+atts.table+'_file" /> '+"</div>"+'<div class="small-2 column"> '+'<a class="button tiny radius" '+' id="'+atts.table+'_btn" '+" onclick=\"a.element(this).scope().uploadFile('"+atts.table+"')\"> "+'<i class="fi-check">&nbsp;</i> '+"</a> "+'<img id="'+atts.table+'_al" '+' style="display: none;" '+" ng-src=\"{{'img/ajax.gif' | baseUrl}}\" /> "+"</div> "+"<hr /> "+'<p style="font-size: 12px;"> '+atts.pValues+"</p> "+"</fieldset>";el.replaceWith($compile(template)(scope))}}}};var languagesCtrl=function($scope,api,$timeout,crud,settings){var s=$scope;s.start=true;s.filter={};s.delete_language="";s.add_language={lang:"",text:""};s.new_lang_keys=[];s.isExcludedByFilter=function(lang){return s.filter[lang]?!s.filter[lang]:true};s.updateLang=function(id){if(s.start){s.start=false;$timeout(function(){$(".al_main").show();var data=rs.languages[id];api.post("languages",id,data).then(function(r){s.start=true;$(".al_main").fadeOut("medium");settings.buildLanguages(1)})},1500)}};s.addLanguage=function(){if(!s.add_language.lang||!s.add_language.text){rs.alertMsg("Please fill the language code and title")}else{rs.hs(".btn_add",".al_add");s.new_lang_keys=[];rs.lang_keys.push(s.add_language);a.forEach(rs.lang_keys,function(item){s.new_lang_keys.push({lang:item.lang,text:item.text})});rs.lang_keys=s.new_lang_keys;rs.settings.languages=JSON.stringify(rs.lang_keys);var query="ALTER TABLE `languages` ADD `"+s.add_language.lang+"` TEXT NOT NULL;",data={languages:rs.settings.languages};api.post("settings","",data,"add_new").then(function(){api.query("languages",query,"multi_query").then(function(){a.forEach(rs.languages,function(item){item[s.add_language.lang]=""});s.add_language={lang:"",text:""};settings.buildLanguages(1);rs.sh(".btn_add",".al_add")})})}};s.deleteLanguage=function(){if(!s.delete_language){rs.alertMsg("Please select language for deletion")}else{rs.confirmMsg("Are you sure you want to delete this language ? The process is ireversible",function(){rs.hs(".btn_add",".al_add");s.new_lang_keys=[];a.forEach(rs.lang_keys,function(item){if(item.lang!=s.delete_language){s.new_lang_keys.push({lang:item.lang,text:item.text})}});rs.lang_keys=s.new_lang_keys;rs.settings.languages=JSON.stringify(rs.lang_keys);var query="ALTER TABLE `languages` drop `"+s.delete_language+"`;",data={languages:rs.settings.languages};api.post("settings","",data,"add_new").then(function(){api.query("languages",query,"multi_query").then(function(){a.forEach(rs.languages,function(item){delete item[s.delete_language]});settings.buildLanguages(1);rs.sh(".btn_add",".al_add")})})})}}};var usersExtraCrudDirective=function(api){return{restrict:"A",compile:function(el,atts){return function(s,el,atts){s.setTime=function(time_in,time_out){a.forEach(rs.days,function(week_day){s.crud_mod[week_day+"_in"]=time_in;s.crud_mod[week_day+"_out"]=time_out})};s.allDays=function(value){a.forEach(rs.days,function(week_day){s.crud_mod[week_day]=value})}}}}};var timeClockCtrl=function($scope,api,crud,pdf,$filter,$timeout){var s=$scope;s.tokensArray=null;s.d_dates={target_date:"date"};s.timeClock={array:[{t:"Employee",c:"user_id",is_s:1,v:"v",o:"$root.users",is_p:1,we:1},{t:"Date",c:"date",is_p:1,is_date:1},{t:"Start time",c:"start_time",is_p:1,is_time:1},{t:"End time",c:"end_time",is_p:1,is_time:1},{t:"Total time",c:"total_time",is_p:1,is_time:1}],tbl:"tokens",t:"tokens",predicate:"predicate_tc",reverse:"reverse_tc",all_have_predicate:0,show:{}};s.makePdf=function(type){var tokens_array=[],tokens_tbl={};if(!rs.isEmpty(s.tokensArray)){var header_style="tableHeader";tokens_array.push([{text:"Employee",style:header_style},{text:"Date",style:header_style},{text:"Start time",style:header_style},{text:"End time",style:header_style},{text:"Total time",style:header_style}]);a.forEach(s.tokensArray,function(item){tokens_array.push([rs.users[item.user_id]?rs.users[item.user_id].v:"-",item.date||"-",item.start_time||"-",item.end_time||"-",item.total_time||"-"])});tokens_tbl={style:"tableExample",table:{headerRows:1,widths:["*","*","*","*","*"],body:tokens_array},layout:"lightHorizontalLines"}}else{tokens_tbl={text:"	\n\n - no time schedule for this employee on this date -",style:"subTitle2"}}var docDefinition={content:[{text:"Time clock schedule",style:"topTitle"},{stack:[{text:["On dates: ",{text:s.f_d||"- all dates -",color:"gray",bold:false}],bold:true},{text:["Employee: ",{text:s.f_u?rs.users[s.f_u].v:"- all employees -",color:"gray",bold:false}],bold:true}]},{text:"-\n"},tokens_tbl],styles:pdf.styles};docDefinition.content.unshift(pdf.contactInfoHeader());var report_name="report_time_clock_"+rs.getCDT()+".pdf";pdf.options(type,docDefinition,report_name)}};var petOwnershipCtrl=function(api,$scope,$timeout){var s=$scope;s.po={pet_id:null,client_id:null,is_error:null,message:null};s.verifyPet=function(without_alert){s.po.is_error=true;if(!s.po.pet_id){if(!without_alert)s.po.message="Please enter pet ID"}else{if(rs.cp_cp[s.po.pet_id]){s.po.is_error=false;if(!without_alert)s.po.message="The pet ID is valid"}else{if(!without_alert)s.po.message="Not a valid pet ID"}}return s.po.is_error};s.verifyClient=function(without_alert){s.po.is_error=true;if(!s.po.client_id){if(!without_alert)s.po.message="Please enter client ID"}else{if(rs.cp[s.po.client_id]){if(!without_alert)s.po.message="The client ID is valid";s.po.is_error=false}else{if(!without_alert)s.po.message="Not a valid client ID"}}return s.po.is_error};s.savePo=function(){var client_id=parseInt(s.po.client_id),pet_id=parseInt(s.po.pet_id),cp_data={client_id:client_id,pet_id:pet_id};if(s.verifyPet(1)||s.verifyClient(1)){s.po.message="Please enter valid client and pet IDs";s.po.is_error=true}else{rs.hs(".btn_po",".al_po");var d_client_id=null;a.forEach(rs.cp,function(item,k){if(item.indexOf(pet_id)!=-1){d_client_id=k}});var d_cp_data={filter:{client_id:d_client_id,pet_id:pet_id}};api.delete("cp","",d_cp_data,"permanent").then(function(r){api.post("cp","",cp_data,"taxonomy").then(function(r){s.po={};s.po.is_error=false;s.po.message="Pet ownership successfully transfered ! The browser "+" will refresh in aprox. 3 seconds for the new changes to take effect";rs.sh(".btn_po",".al_po");$timeout(function(){location.reload()},3e3)})})}}};var helpCtrl=function($scope){var s=$scope;s.help_options=[{id:"introduction",value:"1. Introductions"},{id:"login",value:"2. Kennel and Login"},{id:"general-settings",value:"3. General settings *"},{id:"basic-information",value:"4. Basic information"},{id:"staff-setup",value:"5. Employees, staff setup"},{id:"groomers-trainers-setup",value:"6. Groomers / trainers setup"},{id:"security-setup",value:"7. Security setup"},{id:"general-features",value:"8. General features"},{id:"grooming-setup",value:"9. Grooming setup"},{id:"diets-meds-setup",value:"10. Diets and medications setup"},{id:"pets-setup",value:"11. Pets setup"},{id:"rewards-program-setup",value:"12. Rewards program setup"},{id:"retail-setup",value:"13. Retail setup"},{id:"vet-setup",value:"14. Vet setup"},{id:"additional-general-setup",value:"15. Additional general setup"},{id:"user-interface-setup",value:"16. User interface setup"},{id:"layout-setup",value:"17. Layout setup"},{id:"runs-and-charges-setup",value:"18. Runs and charges setup"},{id:"holiday-and-season-setup",value:"19. Holiday and season setup"},{id:"daycare-setup",value:"20. Daycare setup"},{id:"training-setup",value:"21. Training setup"},{id:"services-setup",value:"22. Services setup"},{id:"how-to-use",value:"23. HOW TO USE"},{id:"working-with-employees",value:"24. Working with employees"},{id:"working-with-clients",value:"25. Working with clients"},{id:"working-with-pets",value:"26. Working with pets"},{id:"working-with-medication-diets",value:"27. Working with pet medications and diets"},{id:"working-with-pos",value:"28. Working with POS"}]};var cpCtrl=function($scope,api,$timeout,cFunc,cp,$filter,crud,pdf,models,rsv){var s=$scope;var cpForm=$("#cpForm");cpForm.on("submit",function(){return false});cpForm.on("valid",function(){rs.sh(".al_form",cpForm);api.post("clients",rs.client.id,rs.client).then(function(r){rs.client.id=r.data.id;rs.client.date_created=rs.client.date_created||rs.getCurrentDate();api.post("pets",rs.pet.id,rs.pet).then(function(r){rs.pet.id=r.data.id;rs.pet.date_created=rs.pet.date_created||rs.getCurrentDate();rs.client.pet=rs.pet;crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet);crud.setTableAfterSubmit(crud.tbl_arr.clients,rs.client);var cp_data={client_id:rs.client.id,pet_id:rs.pet.id};api.post("cp","",cp_data,"taxonomy").then(function(r){var client_id=rs.client.id,pet_id=rs.pet.id;if(!rs.cp[client_id]){rs.cp[client_id]=[pet_id]}else if(rs.cp[client_id].indexOf(pet_id)==-1){rs.cp[client_id].push(pet_id)}if(!rs.cp_cp[pet_id]){rs.cp_cp[pet_id]=[client_id]}rs.client=cp.setClientPrefferedPhone(rs.client);rs.clients[rs.client.id]=rs.client;rs.hs(".al_form",cpForm)})})});return false});s.deleteCp=function(table,client_id,pet_id){rs.confirmMsg("Are you sure you want to delete ?",function(){rs.pet={};if(table=="clients"){crud.deleteItem(crud.tbl_arr.clients,"clients",client_id);if(rs.cp[client_id]){a.forEach(rs.cp[client_id],function(pet_id){crud.deleteItem(crud.tbl_arr.pets,"pets",pet_id,true);if(rs.cp_cp[pet_id]){delete rs.cp_cp[pet_id]}});delete rs.cp[client_id];rs.client={};s.c={}}rs.fadeOutElement("#clients-sticky");rs.closeModal("#cpModal")}else if(table=="pets"){crud.deleteItem(crud.tbl_arr.pets,"pets",pet_id);var index=rs.cp[client_id].indexOf(pet_id);rs.cp[client_id].splice(index,1);if(rs.cp_cp[pet_id]){delete rs.cp_cp[pet_id]}var new_pet_id=rs.cp[client_id][rs.cp[client_id].length-1];rs.pet=rs.pets[new_pet_id];rs.clients[client_id].pet=rs.pet}rs.fadeOutElement("#pets-sticky")})};s.getClientSurvey=function(){if(rs.client.client_survey){s.client_survey_mod=rs.client.client_survey}else{s.client_survey_mod={};s.client_survey_mod.client_id=rs.client.id}};rs.post.client_survey_mod={afterSubmit:function(){crud.setTableAfterSubmit(crud.tbl_arr.clients_survey,s.client_survey_mod);rs.client.client_survey=s.client_survey_mod}};s.getClientMembership=function(){if(rs.client.client_membership){s.client_membership_mod=rs.client.client_membership}else{s.client_membership_mod={};s.client_membership_mod.client_id=rs.client.id}s.client_membership_mod.print_type="screen";s.clientGenerateBarcode()};s.clientGenerateBarcode=function(regenerate){if(!s.client_membership_mod.barcode||regenerate){s.client_membership_mod.barcode=cFunc.generateNumber(10)}$("#clients-membership").find("#barcode").JsBarcode(s.client_membership_mod.barcode.toString())
};s.printMembershipCard=function(){rs.hs(".submit",".al");if(s.client_membership_mod.print_photo_client){pdf.makeImage(rs,"client","image_id","client_image","path_thumb")}if(s.client_membership_mod.print_photo_pet){pdf.makeImage(rs,"pet","image_id","pet_image","path_thumb")}if(s.client_membership_mod.print_photo_client||s.client_membership_mod.print_photo_pet){$timeout(function(){rs.clientMembershipReport(s)},2e3)}else{rs.clientMembershipReport(s)}rs.sh(".submit",".al")};rs.post.client_membership_mod={afterSubmit:function(){crud.setTableAfterSubmit(crud.tbl_arr.clients_membership,s.client_membership_mod);rs.client.client_membership=s.client_membership_mod;s.printMembershipCard()}};s.saveClientPrivate=function(){rs.hs(".btn_sp",".al_sp");rs.client.client_private=rs.client.client_private||{};rs.client.client_private.client_id=rs.client.id;var id=rs.client.client_private.id||"";api.post("clients_private",id,rs.client.client_private).then(function(r){rs.client.client_private.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.clients_private,rs.client.client_private);rs.sh(".btn_sp",".al_sp")})};s.selectPet=function(type,pet_id){if(!pet_id){var current_pet_id=rs.pet.id;a.forEach(rs.cp[rs.client.id],function(test_pet_id,k){if(test_pet_id==current_pet_id){if(type=="previous"){pet_id=rs.cp[rs.client.id][k-1]}else if(type=="next"){pet_id=rs.cp[rs.client.id][k+1]}return false}})}if(pet_id){rs.pet=rs.pets[pet_id];rs.client.pet=rs.pet;rs.clients[rs.client.id].pet=rs.pet}};s.addPet=function(){rs.pet={}};s.restorePet=function(){if(!rs.client.pet){var pet_id=rs.cp[rs.client.id][0];rs.client.pet=rs.pets[pet_id]}rs.pet=rs.client.pet};s.nm={};s.editNotepad=function(n){s.nm=n;s.$broadcast("nm")};s.saveNotepad=function(){rs.sh(".al_sn",".btn_sn");s.nm.date_created=s.nm.date_created||rs.getCDT();s.nm.date_modified=rs.getCDT();s.nm.id=s.nm.id||"";api.post("notepads",s.nm.id,s.nm).then(function(r){s.nm.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.notepads,s.nm);rs.hs(".al_sn",".btn_sn")})};s.deleteNotepad=function(id){rs.confirmMsg("Are you sure you want to delete this notepad ?",function(){crud.deleteItem(crud.tbl_arr.notepads,"notepads",id).then(function(){s.editNotepad({})})})};rs.getGeoAddress=function(scope_id,s,f,t,c){if(rs.autoselect_zip){f=f||3;t=rs.user_interface_settings.zip_postcode_length||7;c=rs.user_interface_settings.country||c;api.geoLocation(s,f,t,c).then(function(r){if(scope_id=="#CpCtrl"){rs.client=a.extend(rs.client,{address_street:r.street,address_city:r.city,address_state:r.state})}else if(scope_id=="#CrudCtrl"){var scope_el=$(scope_id).scope();scope_el.crud_mod=a.extend(scope_el.crud_mod,{street:r.street,city:r.city,state:r.state})}else if(scope_id=="#MyAccountCtrl"){rs.identity=a.extend(rs.identity,{street:r.street,city:r.city,state:r.state})}})}};rs.checkClientPrefferedPhone=function(){if(rs.client.preffered_phone_id){switch(rs.client.preffered_phone_id){case 1:if(!rs.client.contact_phone){rs.alertMsg("Please enter contact phone");$('input[ng-model="client.contact_phone"]').focus()}break;case 2:if(!rs.client.contact_cell){rs.alertMsg("Please enter contact cell");$('input[ng-model="client.contact_cell"]').focus()}break;case 3:if(!rs.client.contact_work_phone){rs.alertMsg("Please enter work phone");$('input[ng-model="client.contact_work_phone"]').focus()}break;case 4:if(!rs.client.emergency_phone){rs.alertMsg("Please enter emergency phone");$('input[ng-model="client.emergency_phone"]').focus()}break}}};$(function(){$("#pets-sticky").draggable();$("#clients-sticky").draggable()});rs.saveSticky=function(type){var t=rs[type].sticky;t=t||{};t.id=t.id||"";t[type+"_id"]=rs[type].id;t.user_id=t.user_id||rs.identity.id;t.date=rs.getCDT();api.post("sticky",t.id,t).then(function(r){t.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr[type+"s"],rs[type]);crud.setTableAfterSubmit(crud.tbl_arr.sticky,t)})};rs.deleteSticky=function(type){if(rs[type].sticky.id){rs.confirmMsg("Are you sure you want to delete this sticky note ?",function(){crud.deleteItem(crud.tbl_arr.sticky,"sticky",rs[type].sticky.id);rs[type].sticky={};crud.setTableAfterSubmit(crud.tbl_arr[type+"s"],rs[type])})}};rs.resetSearch=function(){rs.hideContentShowAl();rs.clients=cp.clients_b;rs.client={};rs.pet={};rs.hideAlShowContent()};rs.setSearchBy=function(type){rs.client_search_by=type;rs.keywords="";rs.pet_type_id=null;rs.pet_breed_id=null;rs.resetSearch();$(".keywords").focus()};rs.makePetsIds=function(pet_ids){var clients={};a.forEach(pet_ids,function(pet_id){if(rs.cp_cp[pet_id]){var client_id=rs.cp_cp[pet_id];if(cp.clients_b[client_id]){var client=cp.clients_b[client_id];client.pet=rs.pets[pet_id];if(!clients[client_id]){clients[client_id]=client}}}});return clients};rs.$watch("keywords",function(){if(!rs.keywords&&!rs.pet_type_id&&!rs.pet_breed_id){rs.resetSearch()}});rs.search=function(check){if(!rs.keywords&&!rs.pet_type_id&&!rs.pet_breed_id){rs.resetSearch()}else{rs.hideContentShowAl();var pet_ids=[],clients={};switch(rs.client_search_by){case"name":a.forEach(rs.clients,function(client){var str1=client.first_name?client.first_name.toLowerCase():"",str2=client.last_name?client.last_name.toLowerCase():"",match=rs.keywords.toLowerCase();if(str1.match(match)||str2.match(match)){clients[client.id]=client}});break;case"pet":a.forEach(rs.pets,function(pet,pet_id){var str=pet.pet_name?pet.pet_name.toLowerCase():"",match=rs.keywords.toLowerCase();if(str.match(match)){pet_ids.push(pet_id)}});clients=rs.makePetsIds(pet_ids);break;case"phone":a.forEach(rs.clients,function(client){a.forEach(["contact_phone","contact_work_phone","contact_cell","emergency_phone"],function(phone){var str=client[phone],match=rs.keywords;if(str&&str.match(match)){clients[client.id]=client}})});break;case"breed":if(rs.pet_type_id!==null){pet_ids=[];a.forEach(rs.pets,function(pet,pet_id){if(pet.pet_type_id==rs.pet_type_id){if(check=="pet_breed_id"&&rs.pet_breed_id){if(pet.pet_breed_id==rs.pet_breed_id){pet_ids.push(pet_id)}}else{pet_ids.push(pet_id)}}});clients=rs.makePetsIds(pet_ids)}else{rs.resetSearch()}break;case"pet_id":a.forEach(rs.pets,function(pet,pet_id){var str=pet.id.toString(),match=rs.keywords.toLowerCase();if(str.match(match)){pet_ids.push(pet_id)}});clients=rs.makePetsIds(pet_ids);break;case"membership":a.forEach(rs.clients,function(client){if(client.client_membership){var str1=client.client_membership.barcode.toString();match=rs.keywords.toLowerCase();if(str1.match(match)){clients[client.id]=client}}});break}rs.clients=clients;if($filter("array")(clients).length==1){var client=$filter("array")(clients)[0];rs.client=client;rs.pet=client.pet}rs.hideAlShowContent()}};s.updatePet=function(){$(".petBtn").hide();$(".petAl").show();api.post("pets",rs.pet.id,rs.pet).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet);$(".petBtn").fadeIn("medium");$(".petAl").hide()})};rs.updatePetVet=function(){$(".pvBtn").hide();$(".pvAl").show();rs.pet.pet_vet=rs.pet.pet_vet||{};rs.pet.pet_vet.pet_id=rs.pet.id;var pet_vet_id=rs.pet_vet&&rs.pet.pet_vet.id?rs.pet.pet_vet.id:"";api.post("pet_vet",pet_vet_id,rs.pet.pet_vet).then(function(r){rs.pet.pet_vet.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.pet_vet,rs.pet.pet_vet);crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet);$(".pvBtn").fadeIn("medium");$(".pvAl").hide()})};s.checkInBoarding=function(){$timeout(function(){var isCheckedin=false,today=rs.getCurrentDate();a.forEach(rs.r_boarding,function(item,id){if((item.date_in==today||item.date_out==today)&&item.pet_id==rs.pet.id&&item.client_id==rs.client.id){isCheckedin=true;return false}});rs.prd_selected="r_boarding";if(isCheckedin){rs.alertMsg("Already checked in the pet for today, you can modify if necesary")}else{var charge_type_id=null,stay_reason_id=null,is_handle_carefully=null,is_extra_pet=null,is_set=0;if(rs.isEmpty(rs.pet.records_boarding)){if(!rs.boarding_settings.charge_type_id&&!rs.boarding_settings.stay_reason_id){rs.alertMsg('First set boarding records for pet or set default settings in "Reservations" - "Boarding settings"!');$("#recordsBoardingModal").foundation("reveal","open")}else{charge_type_id=rs.boarding_settings.charge_type_id;stay_reason_id=rs.boarding_settings.stay_reason_id;is_handle_carefully=rs.boarding_settings.is_handle_carefully;is_extra_pet=rs.boarding_settings.is_extra_pet;is_set=1}}else{charge_type_id=rs.pet.records_boarding.charge_type_id;stay_reason_id=rs.pet.records_boarding.stay_reason_id;is_handle_carefully=rs.pet.records_boarding.is_handle_carefully;is_extra_pet=rs.pet.records_boarding.is_extra_pet;is_set=1}if(is_set){s.r_boarding_mod={client_id:rs.client.id,pet_id:rs.pet.id,stay_reason_id:stay_reason_id,charge_type:rs.boarding_settings.charge_type,charge_type_id:charge_type_id,is_handle_carefully:is_handle_carefully,is_extra_pet:is_extra_pet,in_out:"in",date_in:rs.getCurrentDate(),time_in:rs.getCurrentTime(),date_out:rs.getCurrentDate(),time_out:rs.getCurrentTime()};api.post("r_boarding","",s.r_boarding_mod).then(function(r){s.r_boarding_mod=r.data;rsv.afterSubmit(s,"r_boarding","r_boarding_mod");crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet);crud.setTableAfterSubmit(crud.tbl_arr.r_boarding,s.r_boarding_mod)})}}},200)};s.checkInDaycare=function(){$timeout(function(){var isCheckedin=false,today=rs.getCurrentDate();a.forEach(rs.r_daycare,function(item,id){if((item.date_in==today||item.date_out==today)&&item.pet_id==rs.pet.id&&item.client_id==rs.client.id){isCheckedin=true;return false}});rs.prd_selected="r_daycare";if(isCheckedin){rs.alertMsg("Already checked in the pet for today, you can modify if necesary")}else{var is_set=0,daycare_group_id=null;if(rs.isEmpty(rs.pet.records_daycare)){if(!rs.daycare_settings.se_prefered_group){rs.alertMsg('First set daycare records for pet or set default settings in "Reservations" - "daycare settings"!');$("#recordsDaycareModal").foundation("reveal","open")}else{daycare_group_id=rs.daycare_settings.se_prefered_group;is_set=1}}else{daycare_group_id=rs.pet.records_daycare.daycare_group_id;is_set=1}if(is_set){s.r_daycare_mod={client_id:rs.client.id,pet_id:rs.pet.id,daycare_group_id:daycare_group_id,in_out:"in",is_halfday:1,date_in:rs.getCurrentDate(),time_in:rs.getCurrentTime(),date_out:rs.getCurrentDate(),time_out:rs.getCurrentTime()};api.post("r_daycare","",s.r_daycare_mod).then(function(r){s.r_daycare_mod=r.data;rsv.afterSubmit(s,"r_daycare","r_daycare_mod");crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet);crud.setTableAfterSubmit(crud.tbl_arr.r_daycare,s.r_daycare_mod)})}}},200)};s.checkInGrooms=function(){$timeout(function(){var isCheckedin=false,today=rs.getCurrentDate();a.forEach(rs.r_grooms,function(item,id){if((item.date_in==today||item.date_out==today)&&item.pet_id==rs.pet.id&&item.client_id==rs.client.id){isCheckedin=true;return false}});rs.prd_selected="r_grooms";if(isCheckedin){rs.alertMsg("Already checked in the pet for today, you can modify if necesary")}else{var is_set=0;if(rs.isEmpty(rs.pet.records_grooming)){rs.alertMsg("First set grooms records for pet");$("#recordsGroomingModal").foundation("reveal","open")}else{is_set=1;var groomer_id=rs.pet.records_grooming.g_id,base_type_id=rs.pet.records_grooming.base_type_id,grooming_rate_id=rs.pet.records_grooming.gr_id,multiplier=rs.grooming_rates[rs.pet.records_grooming.gr_id].multiplier,gs_array=rs.pet.records_grooming.gs_ids&&rs.pet.records_grooming.gs_ids.length>0?JSON.stringify(rs.pet.records_grooming.gs_ids):"",is_hcp=rs.pet.records_grooming.is_hcp}if(is_set){s.r_grooms_mod={client_id:rs.client.id,pet_id:rs.pet.id,groomer_id:groomer_id,base_type_id:base_type_id,grooming_rate_id:grooming_rate_id,multiplier:multiplier,gs_array:gs_array,is_hcp:is_hcp,in_out:"in",date_in:rs.getCurrentDate(),time_in:rs.getCurrentTime(),date_out:rs.getCurrentDate(),time_out:rs.getCurrentTime()};api.post("r_grooms","",s.r_grooms_mod).then(function(r){s.r_grooms_mod=r.data;s.r_grooms_mod.gs_array=JSON.parse(s.r_grooms_mod.gs_array);rsv.afterSubmit(s,"r_grooms","r_grooms_mod");crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet);crud.setTableAfterSubmit(crud.tbl_arr.r_grooms,s.r_grooms_mod)})}}},200)};s.checkInTraining=function(){$timeout(function(){var isCheckedin=false,today=rs.getCurrentDate();a.forEach(rs.r_training,function(item,id){if((item.date_in==today||item.date_out==today)&&item.pet_id==rs.pet.id&&item.client_id==rs.client.id){isCheckedin=true;return false}});rs.prd_selected="r_training";if(isCheckedin){rs.alertMsg("Already checked in the pet for today, you can modify if necesary")}else{var is_set=0;if(rs.isEmpty(rs.pet.records_training)){rs.alertMsg("First set training records for pet");$("#recordsTrainingModal").foundation("reveal","open")}else{is_set=1;var t_id=rs.pet.records_training.trainer_id,instructions=rs.pet.records_training.trainer_notepad}if(is_set){s.r_training_mod={client_id:rs.client.id,pet_id:rs.pet.id,t_id:t_id,instructions:instructions,in_out:"in",date_in:rs.getCurrentDate(),time_in:rs.getCurrentTime(),date_out:rs.getCurrentDate(),time_out:rs.getCurrentTime()};api.post("r_training","",s.r_training_mod).then(function(r){s.r_training_mod=r.data;rsv.afterSubmit(s,"r_training","r_training_mod");crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet);crud.setTableAfterSubmit(crud.tbl_arr.r_training,s.r_training_mod)})}}},200)}};var rBoardingCtrl=function($scope,api,cFunc,crud,$timeout,cp,rsv){var s=$scope;s.o={};rs.partial_show=0;s.r_boarding_mod={};s.d_dates={target_date:["date_in","date_out","date_checkout"]};rs.setRo=function(s,tbl,id){if(rs[tbl][id]&&!rs.isEmpty(rs[tbl][id].o)){s.o=rs[tbl][id].o}else{s.o={}}s.o=a.extend(s.o,{print_type:s.o.print_type||"screen",language:rs.user_interface_settings.language,payment_type_id:rs.user_interface_settings.payment_type_id,amount:0})};s.getMod=function(r_boarding,type){rs.section="check_in_out";rs.partial_show=r_boarding.in_out=="out"?1:0;s.r_boarding_mod=a.extend(r_boarding,{in_out:r_boarding.in_out||"in",pet_id:rs.pet.id,client_id:rs.client.id,charge_type:r_boarding.charge_type||rs.boarding_settings.charge_type});s.r_boarding_mod.deposit=s.r_boarding_mod.deposit||0;if(type=="new"){s.r_boarding_mod=a.extend(s.r_boarding_mod,{date_in:rs.getCurrentDate(),time_in:rs.getCurrentTime(),date_out:rs.getCurrentDate(),is_halfday:2});if(rs.pet.records_boarding){var pr=rs.pet.records_boarding;s.r_boarding_mod=a.extend(s.r_boarding_mod,{records_boarding:pr,charge_type_id:pr.charge_type_id,stay_reason_id:pr.stay_reason_id,is_extra_pet:pr.is_extra_pet,is_handle_carefully:pr.is_handle_carefully})}else{var ps=rs.boarding_settings;s.r_boarding_mod=a.extend(s.r_boarding_mod,{charge_type_id:ps.charge_type_id,stay_reason_id:ps.stay_reason_id,is_extra_pet:ps.is_extra_pet,is_handle_carefully:ps.is_handle_carefully})}rs.setRo(s,"r_boarding",null)}else{rs.setRo(s,"r_boarding",r_boarding.id)}};rs.post.r_boarding_mod={beforeSubmit:function(){rs.post.r_boarding_mod.break_submit=0;if(!s.r_boarding_mod.id){rs.checkDatesExists(s,"r_boarding","r_boarding_mod","date_in","date_out",rs.post.r_boarding_mod);rs.checkDatesBigger(s,"r_boarding_mod","date_in","date_out",rs.post.r_boarding_mod);rs.checkDatesToday(s,"r_boarding_mod","date_in",rs.post.r_boarding_mod);rs.checkDatesWeekendHolidaysSeason(s,"r_boarding_mod","date_in","date_out",rs.post.r_boarding_mod);rs.checkCheckInOutTime(s,"r_boarding_mod","time_in","time_out",rs.post.r_boarding_mod);rs.setRo(s,"r_boarding",null)}else{rs.setRo(s,"r_boarding",s.r_boarding_mod.id)}},afterSubmit:function(){rsv.afterSubmit(s,"r_boarding","r_boarding_mod");var rb=s.r_boarding_mod;if(!rs.pet.records_boarding){var records_data={client_id:rb.client_id,pet_id:rb.pet_id,charge_type:rb.charge_type,charge_type_id:rb.charge_type_id,stay_reason_id:rb.stay_reason_id,is_extra_pet:rb.is_extra_pet,is_handle_carefully:rb.is_handle_carefully};api.post("records_boarding","",records_data).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.records_boarding,r.data);rs.pet.records_boarding=r.data})}if(s.r_boarding_mod.deposit&&!s.r_boarding_mod.did_deposit&&pF(s.r_boarding_mod.deposit)>0){s.r_boarding_mod.did_deposit=1;var deposits_data={client_id:rb.client_id,plus_minus:"plus",payment_type_id:1,payment_amount:rb.deposit,is_a_tip:0,tip_user_id:0,language:"en",print_type:"screen",date_created:rs.getCDT(),created_user_id:rs.identity.id};api.post("deposits","",deposits_data).then(function(r){api.post("r_boarding",s.r_boarding_mod.id,s.r_boarding_mod);crud.setTableAfterSubmit(crud.tbl_arr.deposits,r.data);cp.buildClientsBoardingBills();cp.buildClientsDeposits()})}}};s.delete=function(id){rs.confirmMsg("Are you sure you want to delete this boarding reservation ?",function(){rsv.afterDelete(id,"r_boarding","r_boarding_mod")})};rs.checkoutPet=function(scope_id,r_mod,tbl){var s=$(scope_id).scope();if(!s[r_mod].o||rs.isEmpty(s[r_mod].o)){rs.alertMsg("You have to pay first before checking out a pet !")}else{if(s[r_mod].in_out=="in"){var data={in_out:"out",date_checkout:rs.getCurrentDate(),time_checkout:rs.getCurrentTime()};api.post(tbl,s[r_mod].id,data).then(function(r){s[r_mod]=a.extend(s[r_mod],data);crud.setTableAfterSubmit(crud.tbl_arr[tbl],s[r_mod]);rs.partial_show=1})}}};rs.printRsvBill=function(scope_id,r_mod,tbl){var s=$(scope_id).scope();if(!s.o.language||!s.o.print_type){rs.alertMsg("Please select language and print type")}else{if(rs[tbl][s[r_mod].id]){rs.hs(".btn_print",".al_print");var report=rs.rsvReport(s.o,rs[tbl][s[r_mod].id],s[r_mod].id,tbl);s.o.required=report.total;rs.sh(".btn_print",".al_print")}}};rs.post.boarding_payments={beforeSubmit:function(){var report=rs.rsvReport(s.o,rs.r_boarding[s.r_boarding_mod.id],s.r_boarding_mod.id,"r_boarding",1),required=report.total,paid=s.o.paid,change=0,unpaid=0;if(required-paid>0){unpaid=required-paid}else{change=paid-required}s.o=a.extend(s.o,{client_id:rs.client.id,pet_id:rs.pet.id,r_boarding_id:s.r_boarding_mod.id,payment_status_id:required-paid>0?2:1,required:required,paid:paid,change:change,unpaid:unpaid,information:JSON.stringify(s.r_boarding_mod),date_created:s.o.date_created||rs.getCDT(),date_modified:rs.getCDT(),created_user_id:s.o.created_user_id||rs.identity.id,modified_user_id:rs.identity.id})},afterSubmit:function(){rs.r_boarding[s.o.r_boarding_id].o=s.o;crud.setTableAfterSubmit(crud.tbl_arr.boarding_payments,s.o);crud.setTableAfterSubmit(crud.tbl_arr.r_boarding,rs.r_boarding[s.o.r_boarding_id]);cp.buildClientsBoardingBills()}}};var rTrainingCtrl=function($scope,api,cFunc,crud,$timeout,cp,rsv){var s=$scope;s.o={};rs.partial_show=0;s.r_training_mod={};s.d_dates={target_date:["date_in","date_out","date_checkout"]};s.getMod=function(r_training,type){rs.section="check_in_out";rs.partial_show=r_training.in_out=="out"?1:0;s.r_training_mod=a.extend(r_training,{in_out:r_training.in_out||"in",pet_id:rs.pet.id,client_id:rs.client.id});if(type=="new"){s.r_training_mod=a.extend(s.r_training_mod,{date_in:rs.getCurrentDate(),time_in:rs.getCurrentTime(),date_out:rs.getCurrentDate()});if(rs.pet.records_training){var pt=rs.pet.records_training;s.r_training_mod=a.extend(s.r_training_mod,{t_id:pt.trainer_id,instructions:pt.trainer_notepad})}rs.setRo(s,"r_training",null)}else{rs.setRo(s,"r_training",r_training.id)}};rs.post.r_training_mod={beforeSubmit:function(){rs.post.r_training_mod.break_submit=0;if(!s.r_training_mod.id){rs.checkDatesExists(s,"r_training","r_training_mod","date_in","date_out",rs.post.r_training_mod);rs.checkDatesBigger(s,"r_training_mod","date_in","date_out",rs.post.r_training_mod);rs.checkDatesToday(s,"r_training_mod","date_in",rs.post.r_training_mod);rs.setRo(s,"r_training",null)}else{rs.setRo(s,"r_training",s.r_training_mod.id)}if(!rs.post.r_training_mod.break_submit){if(!s.r_training_mod.ts_id||!s.r_training_mod.tg_id||!s.r_training_mod.t_id){rs.alertMsg("Please select a training schedule !");rs.post.r_training_mod.break_submit=1}}},afterSubmit:function(){rsv.afterSubmit(s,"r_training","r_training_mod");var rb=s.r_training_mod;if(!rs.pet.records_training){var records_data={client_id:rb.client_id,pet_id:rb.pet_id,trainer_id:rb.t_id,trainer_notepad:rb.instructions};api.post("records_training","",records_data).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.records_training,r.data);rs.pet.records_training=r.data})}}};s.delete=function(id){rs.confirmMsg("Are you sure you want to delete this training ?",function(){rsv.afterDelete(id,"r_training","r_training_mod")})};rs.post.training_payments={beforeSubmit:function(){var training_report=rs.rsvReport(s.o,rs.r_training[s.r_training_mod.id],s.r_training_mod.id,"r_training",1),required=training_report.total,paid=s.o.paid,change=0,unpaid=0;if(required-paid>0){unpaid=required-paid}else{change=paid-required}s.o=a.extend(s.o,{client_id:rs.client.id,pet_id:rs.pet.id,r_training_id:s.r_training_mod.id,payment_status_id:required-paid>0?2:1,required:required,paid:paid,change:change,unpaid:unpaid,information:JSON.stringify(s.r_training_mod),date_created:s.o.date_created||rs.getCDT(),date_modified:rs.getCDT(),created_user_id:s.o.created_user_id||rs.identity.id,modified_user_id:rs.identity.id})},afterSubmit:function(){rs.r_training[s.o.r_training_id].o=s.o;crud.setTableAfterSubmit(crud.tbl_arr.training_payments,s.o);crud.setTableAfterSubmit(crud.tbl_arr.r_training,rs.r_training[s.o.r_training_id]);cp.buildClientsTrainingBills()}};s.r_training_mod={ts_id:0,tg_id:0,t_id:0};s.training_filter={date:rs.getCurrentDate(),date_filter:"from_date"};s.selectTs=function(ts){s.r_training_mod=a.extend(s.r_training_mod,{ts_id:ts.id,tg_id:ts.tg_id,t_id:ts.t_id,time_in:ts.time_in,time_out:ts.time_out})}};var filterTraining=function(){return function(trainingSchedule,trainingFilter){var filteredTs=[],date_timestamp=new Date(trainingFilter.date).getTime()/1e3;if(!trainingFilter.show_all){a.forEach(trainingSchedule,function(ts){if(ts.date_in){var date_in_timestamp=new Date(ts.date_in).getTime()/1e3,date_out_timestamp=new Date(ts.date_out).getTime()/1e3;if(date_in_timestamp<=date_timestamp&&date_timestamp<=date_out_timestamp){filteredTs.push(ts)}}});return filteredTs}else{return trainingSchedule}}};var rDaycareCtrl=function($scope,api,crud,$timeout,cp,rsv){var s=$scope;s.o={};rs.partial_show=0;s.r_daycare_mod={};s.d_dates={target_date:["date_in","date_out","date_checkout"]};s.getMod=function(r_daycare,type){rs.section="check_in_out";rs.partial_show=r_daycare.in_out=="out"?1:0;s.r_daycare_mod=a.extend(r_daycare,{in_out:r_daycare.in_out||"in",pet_id:rs.pet.id,client_id:rs.client.id});if(type=="new"){s.r_daycare_mod=a.extend(s.r_daycare_mod,{date_in:rs.getCurrentDate(),time_in:rs.getCurrentTime(),date_out:rs.getCurrentDate(),is_halfday:0});if(rs.pet.records_daycare){var pr=rs.pet.records_daycare;s.r_daycare_mod=a.extend(s.r_daycare_mod,{records_daycare:pr,daycare_group_id:pr.daycare_group_id})}else{var ps=rs.daycare_settings;s.r_daycare_mod=a.extend(s.r_daycare_mod,{daycare_group_id:ps.se_prefered_group})}rs.setRo(s,"r_daycare",null)}else{rs.setRo(s,"r_daycare",r_daycare.id)}};rs.post.r_daycare_mod={beforeSubmit:function(){rs.post.r_daycare_mod.break_submit=0;if(!s.r_daycare_mod.id){rs.checkDatesExists(s,"r_daycare","r_daycare_mod","date_in","date_out",rs.post.r_daycare_mod);rs.checkDatesBigger(s,"r_daycare_mod","date_in","date_out",rs.post.r_daycare_mod);rs.checkDatesToday(s,"r_daycare_mod","date_in",rs.post.r_daycare_mod);rs.setRo(s,"r_daycare",null)}else{rs.setRo(s,"r_daycare",s.r_daycare_mod.id)}},afterSubmit:function(){rsv.afterSubmit(s,"r_daycare","r_daycare_mod");var rb=s.r_daycare_mod;if(!rs.pet.records_daycare){var records_data={client_id:rb.client_id,pet_id:rb.pet_id,daycare_group_id:rb.daycare_group_id};api.post("records_daycare","",records_data).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.records_daycare,r.data);rs.pet.records_daycare=r.data})}}};s.delete=function(id){rs.confirmMsg("Are you sure you want to delete this daycare reservation ?",function(){rsv.afterDelete(id,"r_daycare","r_daycare_mod")})};rs.post.daycare_payments={beforeSubmit:function(){var daycare_report=rs.rsvReport(s.o,rs.r_daycare[s.r_daycare_mod.id],s.r_daycare_mod.id,"r_daycare",1),required=daycare_report.total,paid=s.o.paid,change=0,unpaid=0;if(required-paid>0){unpaid=required-paid}else{change=paid-required}s.o=a.extend(s.o,{client_id:rs.client.id,pet_id:rs.pet.id,r_daycare_id:s.r_daycare_mod.id,payment_status_id:required-paid>0?2:1,required:required,paid:paid,change:change,unpaid:unpaid,information:JSON.stringify(s.r_daycare_mod),date_created:s.o.date_created||rs.getCDT(),date_modified:rs.getCDT(),created_user_id:s.o.created_user_id||rs.identity.id,modified_user_id:rs.identity.id})},afterSubmit:function(){rs.r_daycare[s.o.r_daycare_id].o=s.o;crud.setTableAfterSubmit(crud.tbl_arr.daycare_payments,s.o);crud.setTableAfterSubmit(crud.tbl_arr.r_daycare,rs.r_daycare[s.o.r_daycare_id]);cp.buildClientsDaycareBills()}};s.sort_o="date_in";s.sort_o_r="true";s.dg_id="";s.sd=""};var filterDaycare=function(){return function(rDaycare){var s=$("#rDaycareCtrl").scope()||{},filteredDaycare={};if(rDaycare&&rs.r_daycare&&s.sd){a.forEach(rDaycare,function(item){var date_in_t=new Date(item.date_in).getTime(),date_out_t=new Date(item.date_out).getTime(),time_t=new Date(s.sd).getTime();if(time_t>=date_in_t&&time_t<=date_out_t){filteredDaycare[item.id]=item}});return filteredDaycare}else{return rDaycare}}};var filterDaycareColor=function(){return function(time,obj){var s=$("#rDaycareCtrl").scope();if(time&&rs.r_daycare&&rs.daycare_groups&&s.dg_id){var limit=pF(rs.daycare_groups[s.dg_id].limit),nr=0;a.forEach(rs.r_daycare,function(item){var date_in_t=new Date(item.date_in).getTime(),date_out_t=new Date(item.date_out).getTime(),time_t=new Date(time).getTime();if(time_t>=date_in_t&&time_t<=date_out_t){nr+=1}});if(time==s.sd){return"bg-purple"}else if(nr>limit){return"bg-red"}else if(nr==limit){return"bg-orange"}else if(1==0){return"bg-gray"}else{return"bg-white"}}}};var filterDaycareNr=function(){return function(time){var s=$("#rDaycareCtrl").scope();if(time&&rs.r_daycare&&rs.daycare_groups&&s.dg_id){var limit=rs.daycare_groups[s.dg_id].limit,nr=0;a.forEach(rs.r_daycare,function(item){var date_in_t=new Date(item.date_in).getTime(),date_out_t=new Date(item.date_out).getTime(),time_t=new Date(time).getTime();if(time_t>=date_in_t&&time_t<=date_out_t){nr+=1}});return nr}}};var weekdaysDaycare=function($compile){return{restrict:"A",compile:function(el,atts){return function(s,el,atts){var template='<table ng-show="dg_id" '+' class="small-12 table-bordered table-bold">'+"<tr>"+"<td>"+'<span style="cursor: pointer;" '+" ng-click=\"sd = ''\">- show all -</span>"+"</td>";for(var i=-1;i<=8;i++){var date=new Date;date.setDate(date.getDate()+i);var date_str=rs.getCurrentDate(date),date_day=date.toString().substring(0,3);template+='<td style="cursor: pointer;" '+" class=\"{{'"+date_str+"' | filterDaycareColor}}\" "+" ng-click=\"sd = '"+date_str+"'\">"+date_day+"<br />"+date_str+"<hr />"+"{{'"+date_str+"' | filterDaycareNr}}"+"</td>"}template+="</tr></table>";el.replaceWith($compile(template)(s))}}}};var rGroomsCtrl=function($scope,api,cFunc,crud,$timeout,cp,rsv){var s=$scope;s.o={};rs.partial_show=0;s.r_grooms_mod={};s.d_dates={target_date:["date_in","date_out","date_checkout"]};s.getMod=function(r_grooms,type){rs.section="check_in_out";rs.partial_show=r_grooms.in_out=="out"?1:0;s.r_grooms_mod=a.extend(r_grooms,{in_out:r_grooms.in_out||"in",pet_id:rs.pet.id,client_id:rs.client.id});if(type=="new"){s.r_grooms_mod=a.extend(s.r_grooms_mod,{date_in:rs.getCurrentDate(),time_in:rs.getCurrentTime(),date_out:rs.getCurrentDate()});if(rs.pet.records_grooming){var pr=rs.pet.records_grooming;s.r_grooms_mod=a.extend(s.r_grooms_mod,{records_grooms:pr,groomer_id:pr.g_id,base_type_id:pr.base_type_id,grooming_rate_id:pr.gr_id,multiplier:rs.grooming_rates[pr.gr_id].multiplier});a.forEach(rs.pet.records_grooming.gs_ids,function(gs_id){s.r_grooms_mod["gs_"+gs_id]=true})}rs.setRo(s,"r_grooms",null)}else{if(r_grooms.gs_array&&rs.ma(r_grooms.gs_array).length>0){a.forEach(r_grooms.gs_array,function(gs_id){s.r_grooms_mod["gs_"+gs_id]=true})}rs.setRo(s,"r_grooms",r_grooms.id)}};rs.post.r_grooms_mod={beforeSubmit:function(){rs.post.r_grooms_mod.break_submit=0;if(!s.r_grooms_mod.id){rs.checkDatesExists(s,"r_grooms","r_grooms_mod","date_in","date_out",rs.post.r_grooms_mod);rs.checkDatesBigger(s,"r_grooms_mod","date_in","date_out",rs.post.r_grooms_mod);rs.checkDatesToday(s,"r_grooms_mod","date_in",rs.post.r_grooms_mod);rs.setRo(s,"r_grooms",null)}else{rs.setRo(s,"r_grooms",s.r_grooms_mod.id)}rs.post.r_grooms_mod.break_submit=1;a.forEach(rs.grooming_services,function(gs,gs_id){if(s.r_grooms_mod["gs_"+gs_id]){rs.post.r_grooms_mod.break_submit=0;return false}});if(rs.post.r_grooms_mod.break_submit){rs.alertMsg("Please add gromming services")}else{rs.post.r_grooms_mod.break_submit=0;s.r_grooms_mod.gs_array=[];a.forEach(rs.grooming_services,function(gs,gs_id){if(s.r_grooms_mod["gs_"+gs_id]){s.r_grooms_mod.gs_array.push(gs_id)}});s.r_grooms_mod.gs_array=JSON.stringify(s.r_grooms_mod.gs_array)}},afterSubmit:function(){rsv.afterSubmit(s,"r_grooms","r_grooms_mod");var rg=s.r_grooms_mod;if(!rs.pet.records_grooming){var records_data={client_id:rg.client_id,pet_id:rg.pet_id,g_id:rg.groomer_id,base_type_id:rg.base_type_id,gr_id:rg.grooming_rate_id,gs_ids:rg.gs_array};api.post("records_grooming","",records_data).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.records_grooming,r.data);r.data.gs_ids=JSON.parse(r.data.gs_ids);rs.pet.records_grooming=r.data})}s.r_grooms_mod.gs_array=JSON.parse(s.r_grooms_mod.gs_array)}};s.delete=function(id){rs.confirmMsg("Are you sure you want to delete this groom reservation ?",function(){rsv.afterDelete(id,"r_grooms","r_grooms_mod")})};rs.post.grooms_payments={beforeSubmit:function(){var grooms_report=rs.rsvReport(s.o,rs.r_grooms[s.r_grooms_mod.id],s.r_grooms_mod.id,"r_grooms",1),required=grooms_report.total,paid=s.o.paid,change=0,unpaid=0;if(required-paid>0){unpaid=required-paid}else{change=paid-required}s.o=a.extend(s.o,{client_id:rs.client.id,pet_id:rs.pet.id,r_grooms_id:s.r_grooms_mod.id,payment_status_id:required-paid>0?2:1,required:required,paid:paid,change:change,unpaid:unpaid,information:JSON.stringify(s.r_grooms_mod),date_created:s.o.date_created||rs.getCDT(),date_modified:rs.getCDT(),created_user_id:s.o.created_user_id||rs.identity.id,modified_user_id:rs.identity.id})},afterSubmit:function(){rs.r_grooms[s.o.r_grooms_id].o=s.o;crud.setTableAfterSubmit(crud.tbl_arr.grooms_payments,s.o);crud.setTableAfterSubmit(crud.tbl_arr.r_grooms,rs.r_grooms[s.o.r_grooms_id]);cp.buildClientsGroomsBills()}};s.clearInputs=function(){a.forEach(rs.grooming_services,function(gs,gs_id){s.r_grooms_mod["gs_"+gs_id]=false})}};var rServicesCtrl=function($scope,api,crud,$compile){var s=$scope;rs.r_ss_mod={};rs.getSSPrice=function(){a.forEach(rs.schedule_services,function(item){if(rs.r_ss_mod.ss_id==item.id){rs.r_ss_mod.ss_price=item.price;return false}})};rs.submitSS=function(r_type,r_id){rs.sh(".al",".submit");rs.r_ss_mod=a.extend(rs.r_ss_mod,{client_id:rs.client.id,pet_id:rs.pet.id,r_type:r_type,r_id:r_id});api.post("r_ss","",rs.r_ss_mod).then(function(r){rs.pet[r_type][r_id].r_ss=rs.pet[r_type][r_id].r_ss||{};rs.pet[r_type][r_id].r_ss[r.data.id]=r.data;rs.r_ss=rs.r_ss||{};crud.setTableAfterSubmit(crud.tbl_arr.r_ss,r.data);rs.hs(".al",".submit")})};rs.post.r_ss_mod={beforeSubmit:function(){var s={},r_type=rs.prd_selected,r_type_mod=r_type+"_mod";if(r_type=="r_boarding")s=$("#rBoardingCtrl").scope();else if(r_type=="r_daycare")s=$("#rDaycareCtrl").scope();else if(r_type=="r_training")s=$("#rTrainingCtrl").scope();else if(r_type=="r_grooms")s=$("#rGroomsCtrl").scope();rs.post.r_ss_mod.break_submit=0;a.forEach(rs.pet[r_type][s[r_type_mod].id].r_ss,function(item){if(item.ss_id==rs.r_ss_mod.ss_id){rs.alertMsg("This service is already added, please delete it to modify");rs.post.r_ss_mod.break_submit=1;return false}});if(!rs.r_ss_mod.ss_everyday){rs.checkDatesExtra(s,r_type_mod,"date_in","date_out",rs.r_ss_mod.ss_date,rs.post.r_ss_mod,"Select date according to pets stay, don't schedule services on invalid dates")
}if(!rs.post.r_ss_mod.break_submit){rs.submitSS(r_type,s[r_type_mod].id);rs.post.r_ss_mod.break_submit=1}}};rs.addRecordsServices=function(scope_id,r_type,r_type_mod){var s=$(scope_id).scope();var addRss=function(s,r_type,r_type_mod,r_ss){rs.added_records_services=1;var data={client_id:rs.client.id,pet_id:rs.pet.id,r_type:r_type,r_id:s[r_type_mod].id,ss_id:r_ss.ss_id,ss_price:rs.schedule_services[r_ss.ss_id].price,ss_times:r_ss.no_charges,ss_instructions:"",ss_exclude_checkin:!r_ss.is_checkin_date,ss_exclude_checkout:!r_ss.is_checkout_date,ss_date:"",ss_everyday:1};api.post("r_ss","",data).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.r_ss,r.data);rs.pet[r_type][s[r_type_mod].id].r_ss[r.data.id]=r.data;rs.sh(".submit",".al")})};if(!rs.pet.records_services||rs.ma(rs.pet.records_services).length==0){rs.alertMsg("You do not have any records services registered")}else{rs.hs(".submit",".al");a.forEach(rs.pet.records_services,function(r_ss){rs.pet[r_type][s[r_type_mod].id].r_ss=rs.pet[r_type][s[r_type_mod].id].r_ss||{};if(r_ss.schedule=="schedule_always"||r_type=="r_boarding"&&r_ss.schedule=="only_boarding"||r_type=="r_daycare"&&r_ss.schedule=="only_daycare"){if(rs.pet[r_type][s[r_type_mod].id].r_ss&&rs.ma(rs.pet[r_type][s[r_type_mod].id].r_ss).length>0){var confirm_add=0,item_add={};a.forEach(rs.pet[r_type][s[r_type_mod].id].r_ss,function(item){if(item.ss_id==r_ss.ss_id){confirm_add=1;item_add=item}});if(confirm_add){var message="Do you want to replace '"+rs.schedule_services[item_add.ss_id].v+"' with the one from records: '"+rs.schedule_services[r_ss.ss_id].v+"' ?";rs.confirmMsg(message,function(){crud.deleteItem(crud.tbl_arr.r_ss,"r_ss",item_add.id).then(function(r){delete s[r_type][s[r_type_mod].id].r_ss[item_add.id];addRss(s,r_type,r_type_mod,r_ss)})})}else{addRss(s,r_type,r_type_mod,r_ss)}}else{addRss(s,r_type,r_type_mod,r_ss)}}});rs.sh(".submit",".al")}};rs.deleteRecordsServices=function(scope_id,r_type,r_type_mod){var s=$(scope_id).scope();rs.confirmMsg("Are you sure you want to delete all the services scheduled for this reservation ?",function(){if(rs.pet[r_type][s[r_type_mod].id].r_ss&&rs.ma(rs.pet[r_type][s[r_type_mod].id].r_ss).length>0){rs.hs(".submit",".al");a.forEach(rs.pet[r_type][s[r_type_mod].id].r_ss,function(item){crud.deleteItem(crud.tbl_arr.r_ss,"r_ss",item.id)});rs.pet[r_type][s[r_type_mod].id].r_ss={};rs.sh(".submit",".al")}else{rs.alertMsg("No services to delete")}rs.added_records_services=0})};rs.deleteSS=function(scope_id,r_type,r_type_mod,id){var s=$(scope_id).scope();rs.confirmMsg("Are you sure you want to delete this service ?",function(){crud.deleteItem(crud.tbl_arr.r_ss,"r_ss",id).then(function(r){delete s[r_type][s[r_type_mod].id].r_ss[id];if(rs.pet[r_type][s[r_type_mod].id].r_ss&&rs.ma(rs.pet[r_type][s[r_type_mod].id].r_ss).length==0){rs.added_records_services=0}})})}};var servicesTableDirective=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var temp='<table class="small-12">'+"<thead>"+"<tr>"+"<th>Date</th>"+"<th>Qty</th>"+"<th>Service</th>"+"<th>Instructions</th>"+"<th>Price</th>"+"<th>Exclude on checkin</th>"+"<th>Exclude on checkout</th>"+"<th></th>"+"</tr>"+"</thead>"+"<tbody>"+'<tr ng-repeat="r_ss in '+atts.rTypeIn+'">'+'<td>{{(r_ss.ss_everyday == 1 ? "everyday" : r_ss.ss_date)}}</td>'+"<td>{{r_ss.ss_times}}</td>"+"<td>{{$root.schedule_services[r_ss.ss_id].v}}</td>"+"<td>{{r_ss.ss_instructions || '-'}}</td>"+"<td>$ {{r_ss.ss_price}}</td>"+"<td>{{(r_ss.ss_exclude_checkin ? 'yes' : 'no')}}</td>"+"<td>{{(r_ss.ss_exclude_checkout ? 'yes' : 'no')}}</td>"+"<td>"+'<a class="button tiny radius" '+' ng-hide="$root.partial_show" '+" ng-click=\"deleteSS('"+atts.scopeId+"', '"+atts.rType+"', '"+atts.rTypeMod+"', r_ss.id)\">"+'<i class="fi-trash"></i>'+"</a>"+"</td>"+"</tr>"+"</tbody>"+"</table>";el.replaceWith($compile(temp)(s))}}}};var addRecordsServicesBtnDirective=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var temp='<div class="small-6 column">'+'<a class="button tiny radius submit" '+' ng-hide="$root.added_records_services" '+" ng-click=\"addRecordsServices('"+atts.scopeId+"', '"+atts.rType+"', '"+atts.rTypeMod+"')\">"+'<i class="fa fa-plus-square-o"></i> Add services from records'+"</a>"+'<i class="fa fa-spin fa-spinner fa-2x al" style="display: none;"></i>'+"</div>"+'<div class="small-6 column">'+'<a class="button tiny radius submit" '+' ng-hide="ma($root.pet.'+atts.rType+"["+atts.rTypeMod+'.id].r_ss).length == 0" '+" ng-click=\"deleteRecordsServices('"+atts.scopeId+"', '"+atts.rType+"', '"+atts.rTypeMod+"')\">"+'<i class="fa fa-trash"></i> Delete all services'+"</a>"+'<i class="fa fa-spin fa-spinner fa-2x al" style="display: none;"></i>'+"</div>";el.replaceWith($compile(temp)(s))}}}};var rMedsCtrl=function($scope,api,crud,$timeout){var s=$scope;rs.r_meds_mod={};rs.doCheckboxesMd=function(scope_id,t,n,type1,type2){var s=scope_id=="root"?rs:$(scope_id).scope(),m=$("."+type1+"_morning"),a=$("."+type1+"_afternoon"),e=$("."+type1+"_evening"),check=null;s[t][type2+"_morning"]=0;s[t][type2+"_afternoon"]=0;s[t][type2+"_evening"]=0;if(scope_id=="root"){check=!rs[t][n]}else{check=s[t][n]}if(check){m.prop("disabled",1);a.prop("disabled",1);e.prop("disabled",1)}else{m.prop("disabled",0);a.prop("disabled",0);e.prop("disabled",0)}};rs.submitMeds=function(r_type,r_id){rs.sh(".al",".submit");rs.r_meds_mod=a.extend(rs.r_meds_mod,{client_id:rs.client.id,pet_id:rs.pet.id,r_type:r_type,r_id:r_id});api.post("r_meds","",rs.r_meds_mod).then(function(r){rs.pet[r_type][r_id].r_meds=rs.pet[r_type][r_id].r_meds||{};rs.pet[r_type][r_id].r_meds[r.data.id]=r.data;rs.r_meds=rs.r_meds||{};crud.setTableAfterSubmit(crud.tbl_arr.r_meds,r.data);rs.hs(".al",".submit")})};rs.post.r_meds_mod={beforeSubmit:function(){var s={},r_type=rs.prd_selected,r_type_mod=r_type+"_mod";if(r_type=="r_boarding")s=$("#rBoardingCtrl").scope();else if(r_type=="r_daycare")s=$("#rDaycareCtrl").scope();else if(r_type=="r_training")s=$("#rTrainingCtrl").scope();else if(r_type=="r_grooms")s=$("#rGroomsCtrl").scope();rs.post.r_meds_mod.break_submit=0;a.forEach(rs.pet[r_type][s[r_type_mod].id].r_meds,function(item){if(item.med_id==rs.r_meds_mod.med_id){rs.alertMsg("This medication is already added, please delete it to modify");rs.post.r_meds_mod.break_submit=1;return false}});if(!rs.r_meds_mod.med_everyday){rs.checkDatesExtra(s,r_type_mod,"date_in","date_out",rs.r_meds_mod.med_date,rs.post.r_meds_mod,"Select date according to pets stay, don't add medication on  invalid dates")}if(!rs.post.r_meds_mod.break_submit){rs.submitMeds(r_type,s[r_type_mod].id);rs.post.r_meds_mod.break_submit=1}}};rs.addRecordsMeds=function(scope_id,r_type,r_type_mod){var s=$(scope_id).scope();var addMeds=function(s,r_type,r_type_mod,r_med){rs.added_records_meds=1;$timeout(function(){var data={client_id:rs.client.id,pet_id:rs.pet.id,r_type:r_type,r_id:s[r_type_mod].id,med_id:r_med.md_id,med_instructions:r_med.md_instructions,med_type_id:r_med.md_type_id,med_dosage_id:r_med.md_dosage_id,med_dose_type_id:r_med.md_dose_type_id,med_morning:r_med.md_morning,med_afternoon:r_med.md_afternoon,med_evening:r_med.md_evening,med_as_needed:r_med.md_as_needed,med_date:r_med.md_date,med_everyday:r_med.md_everyday};api.post("r_meds","",data).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.r_meds,r.data);rs.pet[r_type][s[r_type_mod].id].r_meds[r.data.id]=r.data;rs.sh(".submit",".al")})},100)};if(!rs.pet.records_meds||rs.ma(rs.pet.records_meds).length==0){rs.alertMsg("You do not have any records meds registered")}else{rs.hs(".submit",".al");a.forEach(rs.pet.records_meds,function(r_med){rs.pet[r_type][s[r_type_mod].id].r_meds=rs.pet[r_type][s[r_type_mod].id].r_meds||{};if(r_type=="r_boarding"&&r_med.md_only_daycare!=1||r_type=="r_daycare"&&r_med.md_only_daycare==0){if(rs.pet[r_type][s[r_type_mod].id].r_meds&&rs.ma(rs.pet[r_type][s[r_type_mod].id].r_meds).length>0){var confirm_add=0,item_add={};a.forEach(rs.pet[r_type][s[r_type_mod].id].r_meds,function(item){if(item.med_id==r_med.md_id){confirm_add=1;item_add=item}});if(confirm_add){var message="Do you want to replace '"+rs.meds[item_add.med_id].v+"' with the one from records: '"+rs.meds[r_med.md_id].v+"' ?";rs.confirmMsg(message,function(){crud.deleteItem(crud.tbl_arr.r_meds,"r_meds",item_add.id).then(function(r){delete s[r_type][s[r_type_mod].id].r_meds[item_add.id];addMeds(s,r_type,r_type_mod,r_med)})})}else{addMeds(s,r_type,r_type_mod,r_med)}}else{addMeds(s,r_type,r_type_mod,r_med)}}});rs.sh(".submit",".al")}};rs.deleteRecordsMeds=function(scope_id,r_type,r_type_mod){var s=$(scope_id).scope();rs.confirmMsg("Are you sure you want to delete all the meds scheduled for this reservation ?",function(){if(rs.pet[r_type][s[r_type_mod].id].r_meds&&rs.ma(rs.pet[r_type][s[r_type_mod].id].r_meds).length>0){rs.hs(".submit",".al");a.forEach(rs.pet[r_type][s[r_type_mod].id].r_meds,function(item){crud.deleteItem(crud.tbl_arr.r_meds,"r_meds",item.id)});rs.pet[r_type][s[r_type_mod].id].r_meds={};rs.sh(".submit",".al")}else{rs.alertMsg("No meds to delete")}rs.added_records_meds=0})};rs.deleteMeds=function(scope_id,r_type,r_type_mod,id){var s=$(scope_id).scope();rs.confirmMsg("Are you sure you want to delete this medication ?",function(){crud.deleteItem("r_meds",id).then(function(r){delete rs.pet[r_type][s[r_type_mod].id].r_meds[id];if(rs.pet[r_type][s[r_type_mod].id].r_meds&&rs.ma(rs.pet[r_type][s[r_type_mod].id].r_meds).length==0){rs.added_records_meds=0}})})}};var medsTableDirective=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var temp='<table class="small-12">'+"<thead>"+"<tr>"+"<th>Name</th>"+"<th>Morning</th>"+"<th>Afternoon</th>"+"<th>Evening</th>"+"<th>As needed</th>"+"<th>Instructions</th>"+"<th>Med type</th>"+"<th>Dose type</th>"+"<th>Date</th>"+"<th></th>"+"</tr>"+"</thead>"+"<tbody>"+'<tr ng-repeat="r_med in '+atts.rTypeIn+'">'+"<td>{{$root.meds[r_med.med_id].v}}</td>"+"<td>{{(r_med.med_morning ? 'yes' : 'no')}}</td>"+"<td>{{(r_med.med_afternoon ? 'yes' : 'no')}}</td>"+"<td>{{(r_med.med_evening ? 'yes' : 'no')}}</td>"+"<td>{{(r_med.med_as_needed ? 'as needed' : '-')}}</td>"+"<td>{{r_med.med_instructions || '-'}}</td>"+"<td>{{$root.meds_type[r_med.med_type_id].v}}</td>"+"<td>"+'<div ng-show="r_med.med_dosage_id">'+"{{$root.md_dosage[r_med.med_dosage_id].v}}"+"</div>"+'<div ng-show="r_med.med_dose_type_id">'+"{{$root.md_dose_type[r_med.med_dose_type_id].v}}"+"</div>"+"</td>"+"<td>"+"{{(r_med.med_everyday ? 'daily' : r_med.med_date)}}</td>"+"<td>"+'<a class="button tiny radius" '+' ng-hide="$root.partial_show" '+" ng-click=\"deleteMeds('"+atts.scopeId+"', '"+atts.rType+"', '"+atts.rTypeMod+"', r_med.id)\">"+'<i class="fi-trash"></i>'+"</a>"+"</td>"+"</tr>"+"</tbody>"+"</table>";el.replaceWith($compile(temp)(s))}}}};var addRecordsMedsBtnDirective=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var temp='<div class="small-6 column">'+'<a class="button tiny radius submit" '+' ng-hide="$root.added_records_meds" '+" ng-click=\"addRecordsMeds('"+atts.scopeId+"', '"+atts.rType+"', '"+atts.rTypeMod+"')\">"+'<i class="fa fa-plus-square-o"></i> Add meds from records'+"</a>"+'<i class="fa fa-spin fa-spinner fa-2x al" style="display: none;"></i>'+"</div>"+'<div class="small-6 column">'+'<a class="button tiny radius submit" '+' ng-hide="ma($root.pet.'+atts.rType+"["+atts.rTypeMod+'.id].r_meds).length == 0" '+" ng-click=\"deleteRecordsMeds('"+atts.scopeId+"', '"+atts.rType+"', '"+atts.rTypeMod+"')\">"+'<i class="fa fa-trash"></i> Delete all meds'+"</a>"+'<i class="fa fa-spin fa-spinner fa-2x al" style="display: none;"></i>'+"</div>";el.replaceWith($compile(temp)(s))}}}};var rDietsCtrl=function($scope,api,crud,$timeout){var s=$scope;rs.r_diets_mod={};rs.submitDiets=function(r_type,r_id){rs.sh(".al",".submit");rs.r_diets_mod=a.extend(rs.r_diets_mod,{client_id:rs.client.id,pet_id:rs.pet.id,r_type:r_type,r_id:r_id});api.post("r_diets","",rs.r_diets_mod).then(function(r){rs.pet[r_type][r_id].r_diets=rs.pet[r_type][r_id].r_diets||{};rs.pet[r_type][r_id].r_diets[r.data.id]=r.data;rs.r_diets=rs.r_diets||{};crud.setTableAfterSubmit(crud.tbl_arr.r_diets,r.data);rs.hs(".al",".submit")})};rs.post.r_diets_mod={beforeSubmit:function(){var s={},r_type=rs.prd_selected,r_type_mod=r_type+"_mod";if(r_type=="r_boarding")s=$("#rBoardingCtrl").scope();else if(r_type=="r_daycare")s=$("#rDaycareCtrl").scope();else if(r_type=="r_training")s=$("#rTrainingCtrl").scope();else if(r_type=="r_grooms")s=$("#rGroomsCtrl").scope();rs.post.r_diets_mod.break_submit=0;a.forEach(rs.pet[r_type][s[r_type_mod].id].r_diets,function(item){if(item.diet_id==rs.r_diets_mod.diet_id){rs.alertMsg("This diet is already added, please delete it to modify");rs.post.r_diets_mod.break_submit=1;return false}});if(!rs.r_diets_mod.med_everyday){rs.checkDatesExtra(s,r_type_mod,"date_in","date_out",rs.r_diets_mod.diet_date,rs.post.r_diets_mod,"Select date according to pets stay, don't add diets on  invalid dates")}if(!rs.post.r_diets_mod.break_submit){rs.submitDiets(r_type,s[r_type_mod].id);rs.post.r_diets_mod.break_submit=1}}};rs.addRecordsDiets=function(scope_id,r_type,r_type_mod){var s=$(scope_id).scope();var addDiets=function(s,r_type,r_type_mod,r_diet){rs.added_records_diets=1;$timeout(function(){var data={client_id:rs.client.id,pet_id:rs.pet.id,r_type:r_type,r_id:s[r_type_mod].id,diet_id:r_diet.md_id,diet_instructions:r_diet.md_instructions,diet_type_id:r_diet.md_type_id,diet_dosage_id:r_diet.md_dosage_id,diet_dose_type_id:r_diet.md_dose_type_id,diet_morning:r_diet.md_morning,diet_afternoon:r_diet.md_afternoon,diet_evening:r_diet.md_evening,diet_as_needed:r_diet.md_as_needed,diet_date:r_diet.md_date,diet_everyday:r_diet.md_everyday};api.post("r_diets","",data).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.r_diets,r.data);rs.pet[r_type][s[r_type_mod].id].r_diets[r.data.id]=r.data;rs.sh(".submit",".al")})},100)};if(!rs.pet.records_diets||rs.ma(rs.pet.records_diets).length==0){rs.alertMsg("You do not have any diet records registered")}else{rs.hs(".submit",".al");a.forEach(rs.pet.records_diets,function(r_diet){rs.pet[r_type][s[r_type_mod].id].r_diets=rs.pet[r_type][s[r_type_mod].id].r_diets||{};if(r_type=="r_boarding"&&r_diet.md_only_daycare!=1||r_type=="r_daycare"&&r_diet.md_only_daycare==0){if(rs.pet[r_type][s[r_type_mod].id].r_diets&&rs.ma(rs.pet[r_type][s[r_type_mod].id].r_diets).length>0){var confirm_add=0,item_add={};a.forEach(rs.pet[r_type][s[r_type_mod].id].r_diets,function(item){if(item.diet_id==r_diet.md_id){confirm_add=1;item_add=item}});if(confirm_add){var message="Do you want to replace '"+rs.diets[item_add.diet_id].v+"' with the one from records: '"+rs.diets[r_diet.md_id].v+"' ?";rs.confirmMsg(message,function(){crud.deleteItem(crud.tbl_arr.r_diets,"r_diets",item_add.id).then(function(r){delete s[r_type][s[r_type_mod].id].r_diets[item_add.id];addDiets(s,r_type,r_type_mod,r_diet)})})}else{addDiets(s,r_type,r_type_mod,r_diet)}}else{addDiets(s,r_type,r_type_mod,r_diet)}}});rs.sh(".submit",".al")}};rs.deleteRecordsDiets=function(scope_id,r_type,r_type_mod){var s=$(scope_id).scope();rs.confirmMsg("Are you sure you want to delete all the diets scheduled for this reservation ?",function(){if(rs.pet[r_type][s[r_type_mod].id].r_diets&&rs.ma(rs.pet[r_type][s[r_type_mod].id].r_diets).length>0){rs.hs(".submit",".al");a.forEach(rs.pet[r_type][s[r_type_mod].id].r_diets,function(item){crud.deleteItem(crud.tbl_arr.r_diets,"r_diets",item.id)});rs.pet[r_type][s[r_type_mod].id].r_diets={};rs.sh(".submit",".al")}else{rs.alertMsg("No diets to delete")}rs.added_records_diets=0})};rs.deleteDiets=function(scope_id,r_type,r_type_mod,id){var s=$(scope_id).scope();rs.confirmMsg("Are you sure you want to delete this diet ?",function(){crud.deleteItem(crud.tbl_arr.r_diets,"r_diets",id).then(function(r){delete rs.pet[r_type][s[r_type_mod].id].r_diets[id];if(rs.pet[r_type][s[r_type_mod].id].r_diets&&rs.ma(rs.pet[r_type][s[r_type_mod].id].r_diets).length==0){rs.added_records_diets=0}})})}};var dietsTableDirective=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var temp='<table class="small-12">'+"<thead>"+"<tr>"+"<th>Name</th>"+"<th>Morning</th>"+"<th>Afternoon</th>"+"<th>Everyday</th>"+"<th>As needed</th>"+"<th>Instructions</th>"+"<th>Diet type</th>"+"<th>Dose type</th>"+"<th>Date</th>"+"<th></th>"+"</tr>"+"</thead>"+"<tbody>"+'<tr ng-repeat="r_diet in '+atts.rTypeIn+'">'+"<td>{{$root.diets[r_diet.diet_id].v}}</td>"+"<td>{{(r_diet.diet_morning ? 'yes' : 'no')}}</td>"+"<td>{{(r_diet.diet_afternoon ? 'yes' : 'no')}}</td>"+"<td>{{(r_diet.diet_evening ? 'yes' : 'no')}}</td>"+"<td>{{(r_diet.diet_as_needed ? 'as needed' : '-')}}</td>"+"<td>{{r_diet.diet_instructions || '-'}}</td>"+"<td>{{$root.diets_type[r_diet.diet_type_id].v}}</td>"+"<td>"+'<div ng-show="r_diet.diet_dosage_id">'+"{{$root.md_dosage[r_diet.diet_dosage_id].v}}"+"</div>"+'<div ng-show="r_diet.diet_dose_type_id">'+"{{$root.md_dose_type[r_diet.diet_dose_type_id].v}}"+"</div>"+"</td>"+"<td>{{(r_diet.diet_everyday ? 'daily' : r_diet.diet_date)}}</td>"+"<td>"+'<a class="button tiny radius" '+' ng-hide="$root.partial_show" '+" ng-click=\"deleteDiets('"+atts.scopeId+"', '"+atts.rType+"', '"+atts.rTypeMod+"', r_diet.id)\">"+'<i class="fi-trash"></i>'+"</a>"+"</td>"+"</tr>"+"</tbody>"+"</table>";el.replaceWith($compile(temp)(s))}}}};var addRecordsDietsBtnDirective=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var temp='<div class="small-6 column">'+'<a class="button tiny radius submit" '+' ng-hide="$root.added_records_diets" '+" ng-click=\"addRecordsDiets('"+atts.scopeId+"', '"+atts.rType+"', '"+atts.rTypeMod+"')\">"+'<i class="fa fa-plus-square-o"></i> Add diets from records'+"</a>"+'<i class="fa fa-spin fa-spinner fa-2x al" style="display: none;"></i>'+"</div>"+'<div class="small-6 column">'+'<a class="button tiny radius submit" '+' ng-hide="ma($root.pet.'+atts.rType+"["+atts.rTypeMod+'.id].r_diets).length == 0" '+" ng-click=\"deleteRecordsDiets('"+atts.scopeId+"', '"+atts.rType+"', '"+atts.rTypeMod+"')\">"+'<i class="fa fa-trash"></i> Delete all diets'+"</a>"+'<i class="fa fa-spin fa-spinner fa-2x al" style="display: none;"></i>'+"</div>";el.replaceWith($compile(temp)(s))}}}};var rRecordsCtrl=function($scope,api,crud,$timeout){var s=$scope;rs.getRecords=function(table,target,modal){rs[target]=rs.pet[table]||{};$(modal).foundation("reveal","open")};rs.post.records_boarding_mod={beforeSubmit:function(){console.log(rs.records_boarding_mod);rs.records_boarding_mod=a.extend(rs.records_boarding_mod,{client_id:rs.client.id,pet_id:rs.pet.id,charge_type:rs.boarding_settings.charge_type})},afterSubmit:function(){rs.pet.records_boarding=rs.records_boarding_mod;crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet)}};rs.post.records_daycare_mod={beforeSubmit:function(){rs.records_boarding_mod=a.extend(rs.records_boarding_mod,{client_id:rs.client.id,pet_id:rs.pet.id})},afterSubmit:function(){rs.pet.records_daycare=rs.records_daycare_mod;crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet)}};rs.getRecordsGrooming=function(){rs.current_rg=rs.pet.records_grooming||{};$("#recordsGroomingModal").foundation("reveal","open")};rs.post.current_rg={beforeSubmit:function(){rs.post.current_rg.break_submit=0;rs.current_rg=a.extend(rs.current_rg,{client_id:rs.client.id,pet_id:rs.pet.id,gs_ids:JSON.stringify(rs.current_rg.gs_ids)})},afterSubmit:function(){rs.current_rg.gs_ids=rs.current_rg.gs_ids?JSON.parse(rs.current_rg.gs_ids):[];rs.pet.records_grooming=rs.current_rg;crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet)}};rs.addGs=function(){if(!rs.gs_id){rs.alertMsg("Please select a reccurring service")}else{rs.current_rg.gs_ids=rs.current_rg.gs_ids||[];if(rs.current_rg.gs_ids.indexOf(rs.gs_id.toString())!=-1){rs.alertMsg("This service is already added !")}else{rs.current_rg.gs_ids.push(rs.gs_id)}}};rs.deleteGs=function(id){rs.confirmMsg("Are you sure you want to delete this service ?",function(){rs.current_rg.gs_ids.splice(rs.current_rg.gs_ids.indexOf(id),1)})};rs.getRecordsMedsDiets=function(type){rs.r_m_mod={md_id:null,type:type};rs.r_d_mod={md_id:null,type:type};$("#recordsMedsDietsModal").foundation("reveal","open")};rs.deleteMd=function(table,id){rs.confirmMsg("Are you sure you want to delete ?",function(){crud.deleteItem(crud.tbl_arr[table],table,id)})};rs.deleteMdRecords=function(table,id){rs.confirmMsg("Are you sure you want to delete this record ?",function(){crud.deleteItem(crud.tbl_arr.records_meds_diets,"records_meds_diets",id).then(function(r){delete rs.pet["records_"+table][id]})})};rs.refreshMd=function(type){rs.search_md="";rs.r_m_mod={md_id:null,type:type};rs.r_d_mod={md_id:null,type:type}};rs.not_add=1;rs.md_med_mod={};rs.md_diet_mod={};rs.post.md_med_mod={afterSubmit:function(){$timeout(function(){rs.md_med_mod={}},100)}};rs.post.md_diet_mod={afterSubmit:function(){$timeout(function(){rs.md_diet_mod={}},100)}};rs.post.r_m_mod={beforeSubmit:function(){rs.post.r_m_mod.break_submit=1;if(!rs.r_m_mod.md_id){rs.alertMsg("Please select medication")}else{rs.addMd("meds")}}};rs.post.r_d_mod={beforeSubmit:function(){rs.post.r_d_mod.break_submit=1;if(!rs.r_d_mod.md_id){rs.alertMsg("Please select diet")}else{rs.addMd("diets")}}};rs.addMd=function(table){rs.hs(".submit",".al");var t=table=="meds"?"r_m_mod":"r_d_mod";var data=a.extend(rs[t],{client_id:rs.client.id,pet_id:rs.pet.id});api.post("records_meds_diets","",data).then(function(r){crud.setTableAfterSubmit(crud.tbl_arr.records_meds_diets,r.data);rs[t].id=r.data.id;var type=rs[t].type,md_id=rs[t].md_id;if(rs[t].type==1){rs.pet.records_meds=rs.pet.records_meds||{};rs.pet.records_meds[rs[t].id]=rs[t]}else if(rs[t].type==2){rs.pet.records_diets=rs.pet.records_diets||{};rs.pet.records_diets[rs[t].id]=rs[t]}crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet);$timeout(function(){rs[t]={type:type,md_id:null}},100);rs.sh(".submit",".al")})};rs.setRs=function(record_service){rs.current_rs=record_service};rs.getRecordsServices=function(){rs.current_rs=rs.pet.records_services||{};$("#recordsServicesModal").foundation("reveal","open")};rs.addRs=function(){if(!rs.ss_id){rs.alertMsg("Please select a service then click add")}else{var valid=1;a.forEach(rs.pet.records_services,function(item){if(item.ss_id==rs.ss_id){rs.alertMsg("Please select different service, or delete existent");valid=0;return false}});if(valid){rs.hs(".btn_rs",".al_rs");var data=a.extend(rs.current_rs,{client_id:rs.client.id,pet_id:rs.pet.id,ss_id:rs.ss_id,no_charges:1,schedule:"schedule_always"});api.post("records_services",data.id,data).then(function(r){rs.current_rs=r.data;crud.setTableAfterSubmit(crud.tbl_arr.records_services,r.data);rs.pet.records_services=rs.pet.records_services||{};rs.pet.records_services[r.data.id]=r.data;crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet);rs.sh(".btn_rs",".al_rs")})}}};rs.deleteRs=function(id){rs.confirmMsg("Are you sure you want to delete this service ?",function(){crud.deleteItem(crud.tbl_arr.records_services,"records_services",id).then(function(r){delete rs.pet.records_services[id];rs.setRs({})})})};rs.getRecordsTraining=function(){rs.current_rt=rs.pet.records_training||{};$("#recordsTrainingModal").foundation("reveal","open")};rs.post.current_rt={beforeSubmit:function(){rs.current_rt.client_id=rs.client.id;rs.current_rt.pet_id=rs.pet.id}}};var posCtrl=function(api,$scope,$timeout,cp,pdf,crud){var s=$scope;s.o={print_type:"screen",promotion_id:"",promotion_discount:0};s.add_qty=null;s.use_coupon_promotion=false;s.is_walk_in_sale=false;s.oo=[];s.ri_selected={};s.rio_selected={};s.required=0;s.paid=0;s.change=0;s.unpaid=0;s.filter_inventory_relationship={table:"retail_vi",cn_id:"retail_vendor_id",ev_id:"vendor_id",an_id:"retail_inventory_id",at:"retail_inventory"};rs.initPos=function(){s.o.print_type=s.o.print_type||"screen";s.o.language=rs.user_interface_settings.language;s.o.payment_type_id=rs.user_interface_settings.payment_type_id};s.setRi=function(ri){if(s.ri_selected.id&&s.ri_selected.id!=ri.id){s.add_qty=null}if(pF(s.add_qty)>pF(ri.quantity)&&!s.is_refund){rs.alertMsg("Please enter an valid quantity according to stock inventory");s.add_qty=null;return}a.forEach(rs.retail_vi,function(rvi){if(rvi.retail_inventory_id==ri.id){ri.vendor_id=rvi.retail_vendor_id;ri.vendor_cost=pF(rvi.our_cost).toFixed(2);return false}});ri.total=pF(ri.price)*pF(s.add_qty);var temp_total=ri.total;ri.margin_p=0;ri.margin_t=0;ri.markup_t=0;a.forEach(rs.classes_discounts,function(cs){ri[cs+"_p"]=0;ri[cs+"_t"]=0});var retail_class=rs.retail_classes[ri.class_id];if(retail_class){if((ri.margin_p=pF(retail_class.margin))>0){ri.margin_t=pF(temp_total*ri.margin_p/100).toFixed(2);ri.total-=pF(ri.margin_t)}else{ri.markup_t=pF(retail_class.markup);ri.total-=ri.markup_t}a.forEach(rs.classes_discounts,function(cs){if((ri[cs+"_p"]=pF(retail_class[cs]))>0){ri[cs+"_t"]=pF(temp_total*ri[cs+"_p"]/100).toFixed(2);ri.total-=pF(ri[cs+"_t"])}})}ri.tax_name="";ri.tax_percentage=0;ri.tax_total=0;ri.o_tax_name="";ri.o_tax_percentage=0;ri.o_tax_total=0;if(ri.tax){ri.tax_name="State tax";ri.tax_percentage=pF(rs.tax_settings.state_tax);ri.tax_total=pF(temp_total*ri.tax_percentage/100).toFixed(2);ri.total+=pF(ri.tax_total);if(rs.tax_settings.o_tax_in_use){ri.o_tax_name=rs.tax_settings.o_tax_name;ri.o_tax_percentage=pF(rs.tax_settings.o_tax_amount);ri.o_tax_total=pF(temp_total*ri.o_tax_percentage/100).toFixed(2);ri.total+=pF(ri.o_tax_total)}}if(ri.vendor_cost){ri.total+=pF(ri.vendor_cost)}ri.add_qty=s.add_qty;ri.adaos=pF(ri.margin_t)+pF(ri.markup_t);ri.discount=0;a.forEach(rs.classes_discounts,function(cs){ri.discount+=pF(ri[cs+"_t"])});ri.total=pF(ri.total).toFixed(2);s.ri_selected=ri};s.setRio=function(rio,index){rio.index=index;s.rio_selected=rio};s.addItem=function(){if(!s.is_refund&&(rs.isEmpty(s.ri_selected)||!s.add_qty)){rs.alertMsg("Please select an inventory item and a quantity")}else{if(!s.is_refund){rs.retail_inventory[s.ri_selected.id].quantity-=s.add_qty}var ri_selected=rs.unbind(s.ri_selected);s.oo.push(ri_selected);s.ri_selected={};s.add_qty=null;s.calculateTotal()}};s.clearAll=function(){if(!s.o.id&&!s.is_refund){a.forEach(s.oo,function(rio,k){rs.retail_inventory[rio.id].quantity+=rio.add_qty})}s.oo=[];s.calculateTotal();s.o.id="";s.change=0;s.did_client_promotions=0};s.clearSale=function(item){a.forEach(s.oo,function(rio,k){if(item.index==rio.index){s.oo.splice(k,1);if(!s.o.id&&!s.is_refund){rs.retail_inventory[rio.id].quantity+=rio.add_qty}s.calculateTotal()}})};s.calculateTotal=function(){s.required=0;s.unpaid=0;a.forEach(s.oo,function(rio){s.required+=pF(rio.total)});if(s.required>0&&s.o.promotion_discount){s.required-=pF(s.o.promotion_discount)}s.unpaid=s.required};s.calculatePromotion=function(){if(s.o.promotion_id){s.o.promotion_points=pF(rs.promotions[s.o.promotion_id].points);s.o.promotion_discount=s.o.promotion_points/pF(rs.promotions_settings.points_per_dollar)}else{s.o.promotion_points=0;s.o.promotion_discount=0}rs.client.reward_points=rs.client.reward_points||0;if(pF(rs.client.reward_points)<pF(s.o.promotion_points)){rs.alertMsg("You don't have enogh points for this reward program");s.o.promotion_id=0;s.o.promotion_points=0;s.o.promotion_discount=0}s.did_client_promotions=0;s.calculateTotal()};s.calculateCoupon=function(){var ri=s.ri_selected;ri.coupon_total=0;if(rs.access.checkCouponsPos()){if(s.coupon_discount<0||s.coupon_discount>100){rs.alertMsg("Please enter a value between 0 and 100")}else{ri.coupon_modifier=s.coupon_modifier;ri.coupon_discount=s.coupon_discount}if(pF(s.coupon_modifier)==2&&s.coupon_discount){ri.coupon_total=s.coupon_discount}else if(pF(s.coupon_modifier)==1&&s.coupon_discount){var product_total=pF(ri.price)*pF(s.add_qty);ri.coupon_total=product_total*pF(s.coupon_discount)/100}}};s.restockInventory=function(){if(s.o.id&&s.is_refund){a.forEach(s.oo,function(rio,k){rs.retail_inventory[rio.id].quantity+=rio.add_qty;rio.add_qty=0})}};rs.processPosPayment=function(payment_status_id,scopeId){var s=$(scopeId).scope();if(s.oo.length==0){rs.alertMsg("Please select items from inventory")}else{if(payment_status_id==1&&!s.o.use_deposit&&(!s.o.payment_type_id||!s.paid)){rs.alertMsg("Please select payment type and amount")}else{var information={o:s.o,oo:s.oo};s.o.date_created=s.o.date_created||rs.getCDT();if(!s.is_refund){if(s.o.paid){s.paid+=pF(s.o.paid)}if(pF(s.paid)>pF(s.required)){s.change=pF(s.paid)-pF(s.required);s.unpaid=0}else if(pF(s.paid)<pF(s.required)){s.change=0;s.unpaid=pF(s.required)-pF(s.paid);payment_status_id=2}else if(pF(s.paid)==pF(s.required)){s.change=0;s.unpaid=0}}else{s.paid=0;s.change=0;s.unpaid=0}rs.hs(".submit",".al");rs.hs(".btn_pp",".al_pp");s.o.required=s.required;s.o.paid=s.paid;s.o.change=s.change;s.o.unpaid=s.unpaid;s.o.payment_status_id=payment_status_id;var id=s.o.id||"",data={client_id:!s.is_walk_in_sale?rs.client.id:0,use_deposit:s.o.use_deposit||0,payment_status_id:payment_status_id,payment_type_id:s.o.payment_type_id,required:pF(s.required).toFixed(2),paid:pF(s.paid).toFixed(2),change:pF(s.change).toFixed(2),unpaid:pF(s.unpaid).toFixed(2),information:JSON.stringify(information),created_user_id:rs.identity.id,date_created:s.o.date_created||null,date_modified:s.o.date_modified||null,modified_user_id:s.o.modified_user_id||null};api.post("pos_payments",id,data).then(function(r){s.o.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.pos_payments,r.data);cp.buildClientsPosBills();a.forEach(s.oo,function(rio){var ri_data={quantity:rs.retail_inventory[rio.id].quantity};api.post("retail_inventory",rio.id,ri_data)});if(rs.access.checkRewards()&&rs.access.checkRewardsIsActive&&!s.is_walk_in_sale&&!s.did_client_promotions){var client=rs.clients[rs.client.id];client.reward_points=client.reward_points||0;if(s.o.promotion_id){client.reward_points=pF(client.reward_points)-pF(s.o.promotion_points)}if(!s.is_refund){var acumulated_points=pF(s.required)/pF(rs.promotions_settings.points_per_dollar);rs.alertMsg("Congratulations! You have acumulated "+pF(acumulated_points).toFixed(2)+" reward points !");client.reward_points+=acumulated_points;client.reward_points=pF(client.reward_points).toFixed(2);var data={client_id:client.id,points:client.reward_points};var extra_json={filter:{id_n:"client_id",id_v:rs.client.id}};api.post("clients_rewards","",data,"",extra_json).then(function(r){s.did_client_promotions=1})}}if(s.o.use_deposit){s.d_mod=s.d_mod||{};s.d_mod.date_created=s.d_mod.date_created||rs.getCDT();s.d_mod=a.extend(s.d_mod,{client_id:rs.client.id,plus_minus:"minus",payment_type_id:0,payment_amount:pF(s.paid).toFixed(2),is_a_tip:0,tip_user_id:0,language:s.o.language,print_type:s.o.print_type,created_user_id:rs.identity.id});api.post("deposits",s.d_mod.id,s.d_mod).then(function(r){s.d_mod.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.deposits,s.d_mod);cp.buildClientsDeposits()})}rs.sh(".submit",".al");rs.sh(".btn_pp",".al_pp")})}}};rs.printPosBill=function(scopeId){var s=$(scopeId).scope();if(!s.o.language||!s.o.print_type){rs.alertMsg("Please select language and print type")}else if(s.oo.length==0){rs.alertMsg("Please add inventory items")}else{rs.hs(".submit",".al");rs.hs(".btn_print",".al_print");rs.posReport(s.o.language,s.o.print_type,s.is_walk_in_sale,s.required,s.paid,s.change,s.unpaid,s.o,s.oo);rs.sh(".submit",".al");rs.sh(".btn_print",".al_print")}}};var pendingCtrl=function($scope,api,cp){var s=$scope;s.pp_selected={};s.bp_selected={};s.dp_selected={};s.gp_selected={};s.tp_selected={};s.d_dates={target_date:"date_created",ngChange:function(){s.setPp({});s.setBp({});s.setDp({});s.setGp({});s.setTp({})}};s.setAllEmpty=function(){s.pp_selected={};s.bp_selected={};s.dp_selected={};s.tp_selected={};s.gp_selected={}};s.seto=function(){s.o=a.extend(s.o,{print_type:s.o.print_type||"screen",language:rs.user_interface_settings.language,payment_type_id:rs.user_interface_settings.payment_type_id,paid:0})};s.setPp=function(pp){s.setAllEmpty();
s.pp_selected=pp;if(!rs.isEmpty(pp)){var information=JSON.parse(s.pp_selected.information);s.required=s.pp_selected.required;s.paid=s.pp_selected.paid;s.change=s.pp_selected.change;s.unpaid=s.pp_selected.unpaid;s.o=information.o;s.oo=information.oo||{};s.o.id=s.pp_selected.id;s.o.date_modified=rs.getCDT();s.o.modified_user_id=rs.identity.id}s.seto()};s.setBp=function(bp){s.setAllEmpty();s.bp_selected=bp;if(!rs.isEmpty(bp)){s.required=s.bp_selected.required;s.paid=s.bp_selected.paid;s.change=s.bp_selected.change;s.unpaid=s.bp_selected.unpaid;s.o=s.o||{};s.o.id=s.bp_selected.id;s.o.date_modified=rs.getCDT();s.o.modified_user_id=rs.identity.id}s.seto()};s.setDp=function(dp){s.setAllEmpty();s.dp_selected=dp;if(!rs.isEmpty(dp)){s.required=s.dp_selected.required;s.paid=s.dp_selected.paid;s.change=s.dp_selected.change;s.unpaid=s.dp_selected.unpaid;s.o=s.o||{};s.o.id=s.dp_selected.id;s.o.date_modified=rs.getCDT();s.o.modified_user_id=rs.identity.id}s.seto()};s.setGp=function(gp){s.setAllEmpty();s.gp_selected=gp;if(!rs.isEmpty(gp)){s.required=s.gp_selected.required;s.paid=s.gp_selected.paid;s.change=s.gp_selected.change;s.unpaid=s.gp_selected.unpaid;s.o=s.o||{};s.o.id=s.gp_selected.id;s.o.date_modified=rs.getCDT();s.o.modified_user_id=rs.identity.id}s.seto()};s.setTp=function(tp){s.setAllEmpty();s.tp_selected=tp;if(!rs.isEmpty(tp)){s.required=s.tp_selected.required;s.paid=s.tp_selected.paid;s.change=s.tp_selected.change;s.unpaid=s.tp_selected.unpaid;s.o=s.o||{};s.o.id=s.tp_selected.id;s.o.date_modified=rs.getCDT();s.o.modified_user_id=rs.identity.id}s.seto()};rs.initPending=function(not_first){s.total_amount=0;s.most_recent=null;s.oldest_debt=null;a.forEach(["pp","bp","dp","gp","tp"],function(tbl){a.forEach(rs.client[tbl].pending,function(pending){s.total_amount+=pF(pending.unpaid);if(!s.most_recent||new Date(s.most_recent).getTime()>new Date(pending.date_created).getTime()){s.most_recent=pending.date_created}if(!s.oldest_debt||new Date(s.oldest_debt).getTime()<new Date(pending.date_created).getTime()){s.oldest_debt=pending.date_created}})});if(!not_first){if(rs.client.pp.pending.length==1){s.setPp(rs.client.pp.pending[0])}else if(rs.client.bp.pending.length==1){s.setBp(rs.client.bp.pending[0])}else if(rs.client.dp.pending.length==1){s.setDp(rs.client.dp.pending[0])}else if(rs.client.gp.pending.length==1){s.setGp(rs.client.gp.pending[0])}else if(rs.client.tp.pending.length==1){s.setTp(rs.client.tp.pending[0])}}};s.printBoardingBill=function(){var id=s.bp_selected.r_boarding_id;if(!s.o.language||!s.o.print_type){rs.alertMsg("Please select language and print type")}else{if(rs.r_boarding[id]){rs.hs(".submit",".al");rs.rsvReport(s.o,rs.r_boarding[id],id,"r_boarding");rs.sh(".submit",".al")}}};s.printDaycareBill=function(){var id=s.dp_selected.r_daycare_id;if(!s.o.language||!s.o.print_type){rs.alertMsg("Please select language and print type")}else{if(rs.r_daycare[id]){rs.hs(".submit",".al");rs.rsvReport(s.o,rs.r_daycare[id],id,"r_daycare");rs.sh(".submit",".al")}}};s.printGroomsBill=function(){var id=s.gp_selected.r_grooms_id;if(!s.o.language||!s.o.print_type){rs.alertMsg("Please select language and print type")}else{if(rs.r_grooms[id]){rs.hs(".submit",".al");rs.rsvReport(s.o,rs.r_grooms[id],id,"r_grooms");rs.sh(".submit",".al")}}};s.printTrainingBill=function(){var id=s.tp_selected.r_training_id;if(!s.o.language||!s.o.print_type){rs.alertMsg("Please select language and print type")}else{if(rs.r_training[id]){rs.hs(".submit",".al");rs.rsvReport(s.o,rs.r_training[id],id,"r_training");rs.sh(".submit",".al")}}};s.processBoardingPayment=function(){if(!s.o.payment_type_id||!s.paid){rs.alertMsg("Please select payment type and payment amount")}else{rs.hs(".submit",".al");var required=s.required,paid=s.paid,change=0,unpaid=0;if(required-paid>0){unpaid=required-paid}else{change=paid-required}var payment_status_id=required-paid>0?2:1;s.o=a.extend(s.o,{payment_type_id:s.o.payment_type_id,payment_status_id:payment_status_id,paid:paid,change:change,unpaid:unpaid,date_modified:rs.getCDT(),modified_user_id:rs.identity.id});s.change=change;s.unpaid=unpaid;api.post("boarding_payments",s.o.id,s.o).then(function(r){rs.sh(".submit",".al");if(payment_status_id==1){rs.client.bp.pending_total-=required;a.forEach(rs.client.bp.pending,function(pending,index){if(pending.id==s.o.id){rs.client.bp.pending.splice(index,1)}});delete rs.boarding_payments[s.o.id]}rs.r_boarding[s.bp_selected.r_boarding_id].o=r.data;cp.buildClientsBoardingBills();if(s.o.use_deposit){s.d_mod=s.d_mod||{};s.d_mod.date_created=s.d_mod.date_created||rs.getCDT();s.d_mod=a.extend(s.d_mod,{client_id:rs.client.id,plus_minus:"minus",payment_type_id:0,payment_amount:pF(paid).toFixed(2),is_a_tip:0,tip_user_id:0,language:s.o.language,print_type:s.o.print_type,created_user_id:rs.identity.id});api.post("deposits",s.d_mod.id,s.d_mod).then(function(r){s.d_mod.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.deposits,s.d_mod);cp.buildClientsDeposits()})}rs.initPending(1)})}};s.processDaycarePayment=function(){if(!s.o.payment_type_id||!s.paid){rs.alertMsg("Please select payment type and payment amount")}else{rs.hs(".submit",".al");var required=s.required,paid=s.paid,change=0,unpaid=0;if(required-paid>0){unpaid=required-paid}else{change=paid-required}var payment_status_id=required-paid>0?2:1;s.o=a.extend(s.o,{payment_type_id:s.o.payment_type_id,payment_status_id:payment_status_id,paid:paid,change:change,unpaid:unpaid,date_modified:rs.getCDT(),modified_user_id:rs.identity.id});s.change=change;s.unpaid=unpaid;api.post("daycare_payments",s.o.id,s.o).then(function(r){rs.sh(".submit",".al");if(payment_status_id==1){rs.client.dp.pending_total-=required;a.forEach(rs.client.dp.pending,function(pending,index){if(pending.id==s.o.id){rs.client.dp.pending.splice(index,1)}});delete rs.daycare_payments[s.o.id]}rs.r_daycare[s.dp_selected.r_daycare_id].o=r.data;cp.buildClientsDaycareBills();if(s.o.use_deposit){s.d_mod=s.d_mod||{};s.d_mod.date_created=s.d_mod.date_created||rs.getCDT();s.d_mod=a.extend(s.d_mod,{client_id:rs.client.id,plus_minus:"minus",payment_type_id:0,payment_amount:pF(paid).toFixed(2),is_a_tip:0,tip_user_id:0,language:s.o.language,print_type:s.o.print_type,created_user_id:rs.identity.id});api.post("deposits",s.d_mod.id,s.d_mod).then(function(r){s.d_mod.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.deposits,s.d_mod);cp.buildClientsDeposits()})}rs.initPending(1)})}};s.processGroomsPayment=function(){if(!s.o.payment_type_id||!s.paid){rs.alertMsg("Please select payment type and payment amount")}else{rs.hs(".submit",".al");var required=s.required,paid=s.paid,change=0,unpaid=0;if(required-paid>0){unpaid=required-paid}else{change=paid-required}var payment_status_id=required-paid>0?2:1;s.o=a.extend(s.o,{payment_type_id:s.o.payment_type_id,payment_status_id:payment_status_id,paid:paid,change:change,unpaid:unpaid,date_modified:rs.getCDT(),modified_user_id:rs.identity.id});s.change=change;s.unpaid=unpaid;api.post("grooms_payments",s.o.id,s.o).then(function(r){rs.sh(".submit",".al");if(payment_status_id==1){rs.client.gp.pending_total-=required;a.forEach(rs.client.gp.pending,function(pending,index){if(pending.id==s.o.id){rs.client.gp.pending.splice(index,1)}});delete rs.grooms_payments[s.o.id]}rs.r_grooms[s.gp_selected.r_grooms_id].o=r.data;cp.buildClientsGroomsBills();if(s.o.use_deposit){s.d_mod=s.d_mod||{};s.d_mod.date_created=s.d_mod.date_created||rs.getCDT();s.d_mod=a.extend(s.d_mod,{client_id:rs.client.id,plus_minus:"minus",payment_type_id:0,payment_amount:pF(paid).toFixed(2),is_a_tip:0,tip_user_id:0,language:s.o.language,print_type:s.o.print_type,created_user_id:rs.identity.id});api.post("deposits",s.d_mod.id,s.d_mod).then(function(r){s.d_mod.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.deposits,s.d_mod);cp.buildClientsDeposits()})}rs.initPending(1)})}};s.processTrainingPayment=function(){if(!s.o.payment_type_id||!s.paid){rs.alertMsg("Please select payment type and payment amount")}else{rs.hs(".submit",".al");var required=s.required,paid=s.paid,change=0,unpaid=0;if(required-paid>0){unpaid=required-paid}else{change=paid-required}var payment_status_id=required-paid>0?2:1;s.o=a.extend(s.o,{payment_type_id:s.o.payment_type_id,payment_status_id:payment_status_id,paid:paid,change:change,unpaid:unpaid,date_modified:rs.getCDT(),modified_user_id:rs.identity.id});s.change=change;s.unpaid=unpaid;api.post("training_payments",s.o.id,s.o).then(function(r){rs.sh(".submit",".al");if(payment_status_id==1){rs.client.tp.pending_total-=required;a.forEach(rs.client.tp.pending,function(pending,index){if(pending.id==s.o.id){rs.client.tp.pending.splice(index,1)}});delete rs.training_payments[s.o.id]}rs.r_training[s.tp_selected.r_training_id].o=r.data;cp.buildClientsTrainingBills();if(s.o.use_deposit){s.d_mod=s.d_mod||{};s.d_mod.date_created=s.d_mod.date_created||rs.getCDT();s.d_mod=a.extend(s.d_mod,{client_id:rs.client.id,plus_minus:"minus",payment_type_id:0,payment_amount:pF(paid).toFixed(2),is_a_tip:0,tip_user_id:0,language:s.o.language,print_type:s.o.print_type,created_user_id:rs.identity.id});api.post("deposits",s.d_mod.id,s.d_mod).then(function(r){s.d_mod.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.deposits,s.d_mod);cp.buildClientsDeposits()})}rs.initPending(1)})}}};var depositsCtrl=function($scope,crud,cp,api){var s=$scope;s.d_mod={};s.d_dates={target_date:"date_created",ngChange:function(){s.setDMod({},0)}};s.setDMod=function(d_mod,not_editable){s.d_mod=d_mod;s.not_editable=not_editable};s.deleteDeposit=function(id){rs.confirmMsg("Are you sure you want to delete this deposit ?",function(){crud.deleteItem(crud.tbl_arr.deposits,"deposits",id,"permanent");cp.buildClientsDeposits()})};rs.initDeposits=function(){s.d_mod.print_type=s.d_mod.print_type||"screen";s.d_mod.language=rs.user_interface_settings.language;s.d_mod.payment_type_id=rs.user_interface_settings.payment_type_id};rs.processDeposit=function(scopeId){var s=$(scopeId).scope();if(!s.d_mod.payment_type_id||!s.d_mod.payment_amount){rs.alertMsg("Please select payment type and amount")}else{var messages="You have successfully deposited: "+pF(s.d_mod.payment_amount).toFixed(2)+" $ for "+rs.client.last_name+", "+rs.client.first_name;rs.confirmMsg(messages,function(){rs.hs(".btn_d",".al_d");s.d_mod.date_created=s.d_mod.date_created||rs.getCDT();var id=s.d_mod.id||"",data=a.extend(s.d_mod,{client_id:rs.client.id,plus_minus:"plus",date_created:s.d_mod.date_created||null,created_user_id:rs.identity.id});api.post("deposits",id,data).then(function(r){s.d_mod.id=r.data.id;data.id=r.data.id;crud.setTableAfterSubmit(crud.tbl_arr.deposits,data);cp.buildClientsDeposits();rs.sh(".btn_d",".al_d")})})}};rs.printDepositBill=function(scopeId){var s=$(scopeId).scope();if(!s.d_mod.language||!s.d_mod.print_type){rs.alertMsg("Please select language and print type")}else{rs.hs(".btn_print_d",".al_print_d");rs.depositReport(s.d_mod);rs.sh(".btn_print_d",".al_print_d")}}};var reportsCtrl=function($scope){var s=$scope;rs.initReports=function(){}};var messagesCtrl=function(api,$scope){var s=$scope;s.d_dates={target_date:"date_created",ngChange:function(){s.checkUncheckAll(0)}};rs.initMessages=function(){s.message={};s.selected_msg=[];s.current_msg="inbox";s.current_msg_list=rs.identity.messages.inbox;var query="";a.forEach(rs.identity.messages.inbox,function(item){if(!item.is_read){item.is_read=1;query+="update `messages` set `is_read` = '"+item.is_read+"' where `id` = '"+item.id+"';"}});api.query("messages",query,"multi_query").then(function(r){rs.identity.messages.unread=0})};s.setCurrentMsgList=function(type){s.current_msg=type;s.current_msg_list=rs.identity.messages[type];s.checkUncheckAll(0,"inbox");s.checkUncheckAll(0,"sent");s.checkUncheckAll(0,"deleted")};s.setSelectedMsg=function(m){if(s.current_msg!="deleted"){var arr=rs.identity.messages[s.current_msg];a.forEach(arr,function(item){if(item.id==m.id){item.check=item.check?0:1}})}};s.checkUncheckAll=function(v,current_msg){var current_msg=current_msg||s.current_msg,arr=rs.identity.messages[current_msg];a.forEach(arr,function(item){item.check=v})};s.setColorHex=function(bg){s.message.color_hex=bg};s.deleteMsg=function(m){rs.confirmMsg("Are you sure you want to delete this message ?",function(){m.is_deleted=1;api.post("messages",m.id,m).then(function(r){a.forEach(s.current_msg_list,function(item,i){if(item.id==m.id){s.current_msg_list.splice(i,1);return false}});rs.identity.messages.deleted.push(m);s.checkUncheckAll(0,"deleted")})})};s.deleteCheckedMsg=function(){rs.confirmMsg("Are you sure you want to delete this message(s) ?",function(){var query="",arr=[];a.forEach(s.current_msg_list,function(item,i){if(item.check){arr.push(i);item.is_deleted=1;rs.identity.messages.deleted.push(item);query+="update `messages` set `is_deleted` = '"+item.is_deleted+"' where `id` = '"+item.id+"';"}});a.forEach(arr.reverse(),function(i){s.current_msg_list.splice(i,1)});api.query("messages",query,"multi_query").then(function(){s.checkUncheckAll(0,"deleted")})})};s.sendMsg=function(){if(s.message.inbox_user_id==rs.identity.id){rs.alertMsg("Cannot send message to self")}else if(!s.message.message){rs.alertMsg("Please enter a message to send")}else{rs.sh(".al_msg",".btn_msg");if(s.message.inbox_user_id){s.message.sent_user_id=rs.identity.id;api.post("messages",null,s.message).then(function(r){rs.identity.messages.sent.push(r.data);s.message={}})}else{var query="";a.forEach(rs.users,function(item,id){if(id!=rs.identity.id){query+="insert into `messages` set `sent_user_id` = '"+rs.identity.id+"', `inbox_user_id` = '"+id+"', `color_hex` = '"+(s.message.color_hex||"")+"', `message` = '"+s.message.message+"'; "}});api.query("messages",query,"multi_query").then(function(r){var filter={filter:{message:s.message.message}};api.get("messages","","",filter).then(function(r){a.forEach(r.data,function(item){rs.identity.messages.sent.push(item)});s.message={}})})}rs.alertMsg("Message(s) successfully sent to employee(s)");s.current_msg="sent";s.current_msg_list=rs.identity.messages.sent;rs.hs(".al_msg",".btn_msg")}}};var vaccanciesCtrl=function($scope){var s=$scope;rs.initVaccancies=function(){}};var layoutCtrl=function($scope,api,$timeout,crud,calc,cFunc,webStorage,dt){var s=$scope;s.days_nr_pets={};s.lr_selected={};s.l_fi={date:rs.getCurrentDate(),section_id:null,charge_type:null,charge_type_id:null,run_number:null,nr_dates:7};rs.initLayout=function(){};s.setLr=function(lr){s.lr_selected=lr};s.getDaysNrPets=function(){return dt.getLastDatesBeforeNrDays(s.l_fi.date,s.l_fi.nr_dates)};s.$watch("l_fi.date",function(new_value,old_value){s.days_nr_pets=s.getDaysNrPets()});s.$watch("l_fi.nr_dates",function(new_value,old_value){s.days_nr_pets=s.getDaysNrPets()})};var managerCtrl=function($scope){var s=$scope;rs.initManager=function(){}};var inputFormDirectives=inputFormDirectives||{};inputFormDirectives.Bootstrap={};var renderAttsTitle=function(atts,id){return!atts.noLabel?'<label for="'+id+'">'+(atts.title||"&nbsp;")+"</label>":""};var renderAttsInputs=function(atts,id,without_ngModel){var ngModel=atts.ngModel?atts.ngModel:atts.t+"."+atts.n,placeholder=atts.placeholder!==undefined?atts.placeholder:"Enter "+(atts.title?atts.title.replace("<br />"," ").toLowerCase():"");return' id="'+(atts.id||id)+'" '+(!without_ngModel&&!atts.noModel?'" ng-model="'+ngModel+'" '+'name="'+ngModel+'" ':"")+(atts.ngChange?' ng-change="'+atts.ngChange+'" ':"")+(atts.ngKeyup?' ng-keyup="'+atts.ngKeyup+'" ':"")+(atts.ngInit?' ng-init="'+atts.ngInit+'" ':"")+(atts.ngClick?' ng-click="'+atts.ngClick+'" ':"")+(atts.ngHide?' ng-hide="'+atts.ngHide+'" ':"")+(atts.ngShow?' ng-show="'+atts.ngShow+'" ':"")+(atts.ngClass?' ng-class="'+atts.ngClass+'" ':"")+(atts.class?' class="'+atts.class+'" ':"")+(atts.tabindex?' tabindex="'+atts.tabindex+'" ':"")+(atts.maxlength?' maxlength="'+atts.maxlength+'" ':"")+(atts.autofocus?" autofocus ":"")+(atts.pattern?' pattern="'+atts.pattern+'" ':"")+(atts.ngRequired?' ng-required="'+atts.ngRequired+'" ':"")+(atts.required?' required="'+atts.required+'" ':"")+(atts.ngDisabled?' ng-disabled="'+atts.ngDisabled+'" ':"")+(atts.disabled?' disabled="'+atts.disabled+'" ':"")+(atts.ngStyle?' ng-style="'+atts.ngStyle+'" ':"")+(atts.style?' style="'+atts.style+'" ':"")+(atts.value?' value="'+atts.value+'" ':"")+(atts.ngValue?' ng-value="'+atts.ngValue+'" ':"")+(atts.equalto?' data-equalto="'+atts.equalto+'" ':"")+' placeholder="'+placeholder+'" '};var renderAttsError=function(atts){return!atts.noError?'<small class="error">'+(atts.errorText?atts.errorText:"This field is required")+"</small>":""};var renderAttsTop=function(atts){return!atts.extraHtml?"<div"+(atts.uClass?' class="'+atts.uClass+'"':"")+">":""};var renderAttsBottom=function(atts){return!atts.extraHtml?"</div>":""};inputFormDirectives.Bootstrap.InputText=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var id=rs.uid(),temp=renderAttsTop(atts)+renderAttsTitle(atts,id)+'<input type="'+(atts.type||"text")+'" '+renderAttsInputs(atts,id,0)+" />"+renderAttsError(atts)+renderAttsBottom(atts);el.replaceWith($compile(temp)(s))}}}};inputFormDirectives.Bootstrap.InputTextarea=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var id=rs.uid(),temp=renderAttsTop(atts)+renderAttsTitle(atts,id)+"<textarea "+renderAttsInputs(atts,id,0)+"></textarea>"+renderAttsError(atts)+renderAttsBottom(atts);el.replaceWith($compile(temp)(s))}}}};inputFormDirectives.Bootstrap.InputSelect=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var id=rs.uid(),guid=rs.guid(),ngOptions="",ngId=atts.ngId||"id",ngV=atts.ngV||"v",ngSelected=0;if(atts.ngOptions){ngOptions=atts.ngOptions}else{ngOptions=guid+"."+ngId+" as "+guid+"."+ngV+" for "+guid+" in "+atts.s+" | array "+(atts.filterSelect?" | "+atts.filterSelect:"")}rs.$watch("done",function(){if(rs.done){var sl=atts.s?atts.s.replace("$root.",""):"";if(rs[sl]&&rs.ma(rs[sl])[0]&&rs.ma(rs[sl])[0].status_id){ngOptions+=" | filter:{status_id:1} "}var temp=renderAttsTop(atts)+renderAttsTitle(atts,id)+'<select ng-options="'+ngOptions+'" '+' ng-selected="'+ngSelected+'" '+renderAttsInputs(atts,id,0)+">"+'<option value="">'+(atts.lineValue||"-")+"</option>"+"</select>"+renderAttsError(atts)+renderAttsBottom(atts);el.replaceWith($compile(temp)(s))}})}}}};inputFormDirectives.Bootstrap.InputRadio=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var id=rs.uid(),temp=renderAttsTop(atts)+"<label> "+'<input type="radio" value="'+atts.v+'" '+renderAttsInputs(atts,id,0)+" /> "+(atts.title||"$nbsp;")+"</label>"+renderAttsBottom(atts);el.replaceWith($compile(temp)(s))}}}};inputFormDirectives.Bootstrap.InputCheckbox=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var id=rs.uid(),ngModel=atts.ngModel?atts.ngModel:atts.t+"."+atts.n,temp=renderAttsTop(atts)+"<label> "+'<input type="checkbox" '+' ng-model="'+ngModel+'" '+' name="'+ngModel+'" '+' ng-checked="('+ngModel+" === true) || ("+ngModel+" === 'true') "+" || ("+ngModel+" === 1) || ("+ngModel+" === '1')\" "+renderAttsInputs(atts,id,1)+" /> "+(atts.title||"&nbsp;")+"</label>"+renderAttsBottom(atts);el.replaceWith($compile(temp)(s))}}}};inputFormDirectives.Bootstrap.FormSubmit=function(api,$compile,$filter,crud){return{restrict:"AEC",compile:function(el,atts){return function(s,el,atts){s[atts.t]=s[atts.t]||{};var id=atts.id||rs.uid();el.attr("id",id);var jEl=$("#"+id);if(atts.submitBtn){var submitBtn='<div class="right">'+'<button type="submit" class="submit button radius" style="font-weight: bold;">'+'<i class="fa fa-check-square"> '+(atts.submitBtnText?atts.submitBtnText:"")+"</i>"+"</button>"+'<img class="al" src="'+$filter("baseUrl")("img/ajax.gif")+'" style="display: none;" />'+"</div>",fieldset=jEl.find("fieldset:last").last();if(fieldset.length>0){fieldset.append(submitBtn)}else{jEl.append(submitBtn)}}if(atts.hideShowAlContent){var al_form_html='<div class="al_form small-12" style="display: none;">'+'<img src="'+$filter("baseUrl")("img/ajax-big.gif")+'" alt="" />'+"</div>";jEl.before(al_form_html)}var submitFunc=function(){var post={};if(rs.post[atts.tPost]){post=rs.post[atts.tPost]}else if(rs.post[atts.t]){post=rs.post[atts.t]}else if(rs.post[atts.table]){post=rs.post[atts.table]}else if(rs.post){post=rs.post}if(post.beforeSubmit){post.beforeSubmit()}if(!post.break_submit){if(atts.hideShowAlSubmit){jEl.find(".al").show();jEl.find(".submit").hide()}else if(atts.hideShowAlContent){jEl.parent().find(".al_form").show();jEl.hide()}var data=!rs.isEmpty(s[atts.t])?s[atts.t]:rs[atts.t],table=atts.table||atts.t,id=data.id||null,method=post.method||"";api.post(table,id,data,method).then(function(r){s[atts.t].id=r.data.id;if(post.afterSubmit){post.afterSubmit()}if(atts.setTableAfterSubmit){crud.setTableAfterSubmit(crud.tbl_arr[table],data)}if(atts.hideShowAlSubmit){jEl.find(".al").hide();jEl.find(".submit").show()}else if(atts.hideShowAlContent){jEl.parent().find(".al_form").hide();jEl.show()}})}};if(atts.abide){$(document).foundation("abide");jEl.on("submit",function(){return false});jEl.on("valid",submitFunc)}else{jEl.on("submit",submitFunc)}}}}};var imageDirectives=imageDirectives||{};imageDirectives.Bootstrap={};imageDirectives.Bootstrap.ImageNoImage=function($compile,$filter,cFunc,config,crud){return{restrict:"E",compile:function(el,atts){return function(scope,el,atts){var t=atts.t,n=atts.n,s=atts.s,st=atts.st,stt=atts.stt,rendered=false;scope.checkImage=function(t,n,s,st,stt){if(scope[t]){if(scope[t][n]){if(scope[s]){if(scope[s][scope[t][n]]){if(scope[s][scope[t][n]][st]){return true}}}}}return false};scope.noImage=function(t,n,s){crud.deleteItem(crud.tbl_arr[s],s,scope[t][n])};var id=rs.uid(),template="<a ng-show=\"checkImage('"+t+"', '"+n+"', '"+s+"', '"+st+"', '"+stt+"')\" "+' ng-href="{{'+s+"["+t+"."+n+"]."+st+' | l}}" '+' class="'+(atts.fancybox?"fancybox-"+t+"_"+n:"")+'"> '+'<img ng-src="{{'+s+"["+t+"."+n+"]."+stt+' | l}}" alt="" />'+"</a>"+"<a ng-hide=\"checkImage('"+t+"', '"+n+"', '"+s+"', '"+st+"', '"+stt+"')\" "+' class="no-img" '+' href="javascript:void(0);"> '+"<img ng-src=\"{{'img/"+(atts.image||"no_image.png")+'\' | baseUrl}}" alt="" />'+"</a>"+"<img ng-src=\"{{'img/ajax-big.gif' | baseUrl}}\" "+' style="display: none;" class="loading-img" />'+(atts.ajax?'<div class="clearfix">&nbsp;</div>'+'<input type="file" capture="camera" accept="image/*" '+' id="'+id+'" class="button alert radius tiny" />'+'<a class="right" style="margin-top: 10px; font-size: 11px;" '+" ng-show=\"checkImage('"+t+"', '"+n+"', '"+s+"', '"+st+"', '"+stt+"')\" "+" ng-click=\"noImage('"+t+"', '"+n+"', '"+s+"')\">"+'<i class="fa fa-check"></i> no image'+"</a>":"");el.replaceWith($compile(template)(scope));$("#"+id).off("change").on("change",function(evt){var w=atts.w||"200",h=atts.h||"150",files=evt.target.files;if(files[0].type.match("image.*")){var reader=new FileReader;reader.onload=function(theFile){return function(e){var el=$("#"+id);$.ajax({url:config.api+"/save-image",method:"post",dataType:"json",crossDomain:true,data:{token:config.token,env:config.env,table:"files",image_src:e.target.result,image_type:theFile.type,w:w,h:h},beforeSend:function(){el.parent().find("img").hide();el.parent().find(".loading-img").show();rs.sh(".al",".submit")},complete:function(r){el.parent().find("img").show();el.parent().find(".loading-img").hide();rs.hs(".al",".submit")},error:function(r){},success:function(r){crud.setTableAfterSubmit(crud.tbl_arr[s],r.r.data);scope[t][n]=r.r.data.id;scope.$apply()}})}}(files[0]);reader.readAsDataURL(files[0])}});if(atts.fancybox){$(".fancybox-"+t+"_"+n).fancybox({helpers:{overlay:{locked:false}}})}}}}};var commonDirectives=commonDirectives||{};commonDirectives.Bootstrap={};var renderDatepicker=function(el,type,$compile,cFunc){if(!el.attr("id")){el.attr("id",rs.uid())}var iconTemplate="<a ng-click=\"focusOnId('"+el.attr("id")+"')\">"+' <img src="img/calendar.png" class="calendar" /> '+"</a>"+'<div class="clearfix">&nbsp;</div>';el.after($compile(iconTemplate)(rs));if(type=="us"){el.fdatepicker()}else{el.fdatepicker({format:"yyyy-mm-dd"})}};commonDirectives.Bootstrap.Datepicker=function($compile,cFunc){return{restrict:"AEC",link:function(s,el,atts){if(el[0].tagName.toLowerCase()=="input"){renderDatepicker(el,"",$compile,cFunc)}}}};commonDirectives.Bootstrap.DatepickerUs=function($compile,cFunc){return{restrict:"AEC",link:function(s,el,atts){if(el[0].tagName.toLowerCase()=="input"){renderDatepicker(el,"us",$compile,cFunc)}}}};var renderTimepicker=function(el,$compile,cFunc){if(!el.attr("id")){el.attr("id",rs.uid())}var iconTemplate="<a ng-click=\"focusOnId('"+el.attr("id")+"')\">"+' <img src="img/clock.png" class="clock" />'+"</a>"+'<div class="clearfix">&nbsp;</div>';el.after($compile(iconTemplate)(rs));el.timepicker({showCloseButton:true})};commonDirectives.Bootstrap.Timepicker=function($compile,cFunc){return{restrict:"AEC",link:function(s,el,atts){if(el[0].tagName.toLowerCase()=="input"){renderTimepicker(el,$compile,cFunc,rs)}}}};commonDirectives.Bootstrap.Colorpicker=function($timeout){return{restrict:"AEC",link:function(s,el,atts){$timeout(function(){el.spectrum({showInitial:true,showInput:true,preferredFormat:3})},1)}}};commonDirectives.Bootstrap.Fancybox=function($timeout){return{restrict:"AEC",link:function(s,el,atts){$timeout(function(){el.fancybox({helpers:{overlay:{locked:false}}})},1)}}};commonDirectives.Bootstrap.Clearable=function(){function tog(v){return v?"addClass":"removeClass"}$(document).on("input",".clearable",function(){var self=$(this);self[tog(this.value)]("onX")}).on("change",".clearable",function(){var self=$(this);if(self.val()==""){self.removeClass("onX")}else{self.addClass("onX")}});return{restrict:"AEC",link:function(s,el,atts){$("#MainCtrl").on("click",".onX",function(){$(this).removeClass("x onX").val("");var model=$(this).attr("ng-model"),arr=model.split(".");if(arr.length>1){model=arr[1]}s[model]="";s.$digest();s.$apply();s.$broadcast(model);if(rs[model]){rs[model]="";rs.$digest();rs.$apply();rs.$broadcast(model)}})}}};commonDirectives.Bootstrap.ScrollLoad=function(){return{restrict:"AEC",link:function(s,el,atts){if(!($("html, body").get(0).scrollHeight>$("html, body").height())){var offsetHeight=document.documentElement.offsetHeight,height=parseFloat(offsetHeight)+100+"px";$("html, body").css({height:height})}$(document).scroll(function(e){if($(window).scrollTop()>=($(document).height()-$(window).height())*.9){if(el.is(":visible")||s.show){if(!s[atts.processing]&&s[atts.newContent]&&!s[atts.backup].done){if(atts.params){s[atts.action](JSON.parse(atts.params))}else{s[atts.action]()}}}}})}}};commonDirectives.Bootstrap.ScrollLimit=function(){return{restrict:"AEC",link:function(s,el,atts){s.limitTo=atts.limitTo?parseInt(atts.limitTo):10;s.makeScrollable=function(){var offsetHeight=document.documentElement.offsetHeight,height=parseFloat(offsetHeight)+100+"px";$("html, body").css({height:height})};if(!($("html, body").get(0).scrollHeight>$("html, body").height())){s.makeScrollable()}$(document).scroll(function(e){if($(window).scrollTop()>=($(document).height()-$(window).height())*.9){s.limitTo+=atts.limit?parseInt(atts.limit):10;s.$apply();s.makeScrollable()}})}}};commonDirectives.Bootstrap.Prefix=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var template='<div class="small-'+(atts.pl?atts.pl:"2")+' left">'+(!atts.wl?"<label>&nbsp;</label>":"")+'<span class="prefix left column">'+(atts.t?atts.t:'<i class="'+atts.i+'"></i>')+"</span>"+"</div>"+'<div class="small-'+(atts.dl?atts.dl:"10")+' left">'+el.html()+"</div>";el.replaceWith($compile(template)(s))}}}};commonDirectives.Bootstrap.Postfix=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var template='<div class="small-'+(atts.dl?atts.dl:"10")+' left">'+el.html()+"</div>"+'<div class="small-'+(atts.pl?atts.pl:"2")+' left">'+(!atts.wl?"<label>&nbsp;</label>":"")+'<span class="postfix left column">'+(atts.t?atts.t:'<i class="'+atts.i+'"></i>')+"</span>"+"</div>";el.replaceWith($compile(template)(s))}}}};commonDirectives.Bootstrap.SaveButton=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var template="<"+(atts.isButton?'button type="submit"':"a")+" "+' class="button radius right btn_'+atts.name+(atts.class?" "+atts.class:"")+'" '+' ng-click="'+atts.function+'()"> '+'<i class="'+atts.iconClass+'"></i> '+atts.title+"</"+(atts.isButton?"button":"a")+">"+"<img ng-src=\"{{'img/ajax.gif' | baseUrl}}\" "+' class="al_'+atts.name+' right" style="display: none;" />';el.replaceWith($compile(template)(s))}}}};commonDirectives.Bootstrap.ThOrder=function($compile){return{restrict:"A",compile:function(el,atts){return function(s,el,atts){var template="<th ng-click=\"pr = '"+atts.t+'\'; rv=!rv" style="cursor: pointer;"'+(atts.ngShow?' ng-show="'+atts.ngShow+'"':"")+">"+'<img ng-src="{{\'img/mss_ic1.png\' | baseUrl}}" alt="" /> '+(atts.title||"&nbsp;")+"</th>";el.replaceWith($compile(template)(s))}}}};commonDirectives.Bootstrap.PrintButtons=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var template='<a data-dropdown="print_drop" class="button success radius" '+' aria-controls="print_drop" aria-expanded="false"> '+' <i class="fa fa-print"></i> Print '+"</a> "+'<ul id="print_drop" class="f-dropdown" data-dropdown-content aria-hidden="true" tabindex="-1"> '+'<li><a ng-click="makePdf(\'screen\')" class="button tiny secondary m10"><i class="fa fa-windows"></i> On screen</a></li> '+'<li><a ng-click="makePdf(\'print\')" class="button tiny secondary m10"><i class="fa fa-file-o"></i> Print</a></li> '+'<li><a ng-click="makePdf(\'download\')" class="button tiny secondary m10"><i class="fa fa-arrow-down"></i> Download</a></li> '+"</ul>";el.replaceWith($compile(template)(s));$(document).foundation("dropdown")}}}};commonDirectives.Bootstrap.MenuLink=function($compile,$location){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){rs.isCurrentLink=function(link){return $location.absUrl().indexOf(link)!=-1};rs.doLoading=function(state,link){rs.closeCurrentModal();rs.hideElement(".alertMsg");rs.hideElement(".confirmMsg");if(state=="main"){$("#mainPage").show();$("#uiView").hide()}else if($location.path().indexOf(link)==-1){$("#ajaxLoaderHuge").show();$("#uiView").hide();$("#mainPage").hide()}};var template="<li ng-class=\"{'active': isCurrentLink('"+atts.link+"')}\" "+(atts.show?' ng-show="'+atts.show+'"':"")+(atts.extra||"")+(atts.uiSref?' ui-sref="'+atts.uiSref+'" ng-click="doLoading(\''+atts.uiSref+"', '"+atts.link+"')\"":"")+">"+'<a href="'+atts.link+'">'+(atts.iconClass?'<i class="'+atts.iconClass+'"></i>':"")+" "+atts.title+"</a>"+"</li>";el.replaceWith($compile(template)(s))}}}};commonDirectives.Bootstrap.ContentLink=function($compile,$location){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var template="<a "+(atts.show?' ng-show="'+atts.show+'"':"")+(atts.extra||"")+(atts.uiSref?' ui-sref="'+atts.uiSref+'" ng-click="doLoading(\''+atts.uiSref+"', '"+atts.link+"')\"":"")+">"+(atts.iconClass?'<i class="'+atts.iconClass+'"></i>':"")+" "+atts.title+"</a>";el.replaceWith($compile(template)(s))}}}};commonDirectives.Bootstrap.AlertConfirmMessages=function($compile){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var template='<div data-alert class="alert-box alert alertMsg" style="display: none;">'+"<a class=\"right closeMsg\" ng-click=\"fadeOutElement('.alertMsg', 'medium')\">&times;</a> "+" {{$root.alert_message}} "+"</div>"+'<div data-alert class="alert-box success confirmMsg" style="display: none;">'+"{{$root.confirm_message}} "+'<a class="button tiny radius" ng-click="$root.confirmFunc(); hideElement(\'.confirmMsg\')">Yes</a> '+'<a class="button tiny radius" ng-click="hideElement(\'.confirmMsg\')">No</a>'+"</div>";el.replaceWith($compile(template)(s))
}}}};var tableDirectives=tableDirectives||{};tableDirectives.Bootstrap={};tableDirectives.Bootstrap.EditableTable=function(api,$compile,$filter,$timeout,cFunc,crud){return{restrict:"E",compile:function(el,atts){return function(s,el,atts){var template="",r_el=rs.guid(),ts=s[atts.ts]||rs[atts.ts],t=ts.t||"";s.addTbl=function(table,target,ts){tss=s[atts.ts];s[tss.predicate]="id";s[tss.reverse]=true;api.get(table,"","last_id").then(function(r){var data=r.data.el;data.id=(++r.data.max).toString();if(data.status_id!==undefined){data.status_id="1"}var wdf=s[ts].with_default_filter;if(wdf){data[wdf.n]=s[wdf.m]?s[wdf.m]:wdf.v}a.forEach(s[ts].array,function(ar){if(ar.d){data[ar.c]=ar.d}data[ar.c]=data[ar.c]||""});if(rs.isObject(s[target])){s[target][data.id]=data}else if(rs.isArray(s[target])){s[target].unshift(data)}$timeout(function(){s.setExtra(data.id,ts);s[ts].show[data.id]=false},10)})};s.deleteTbl=function(table,target,el,ts){rs.confirmMsg("Are you sure you want to delete this ?",function(){var id=el.id;api.delete(table,id,{},atts.deletePermanent?"permanent":null).then(function(r){a.forEach(s[target],function(item,k){if(item.id==id){if(rs.isObject(s[target])){delete s[target][id]}else if(rs.isArray(s[target])){s[target].splice(k,1)}return false}});if(s[ts].tables_arr){crud.deleteItem(s[ts].tables_arr,"",id,true)}})})};s.updateTbl=function(table,el,ts){var id=el.id;if(atts.trExtraId){el[atts.trExtraId]=s[atts.trExtraId]}api.post(table,id,el).then(function(r){el.id=r.data.id;if(s[ts].tables_arr){crud.setTableAfterSubmit(s[ts].tables_arr,el)}})};s.updateCheckboxTbl=function(table,el,column,ts){el[column]=el[column]==0?1:0;var id=el.id;if(id){api.post(table,id,el)}};s.setExtra=function(id,ts){a.forEach(s[ts].array,function(item){var el=$("#"+item.c+id);if(item.is_date&&!el.hasClass("is_set")){renderDatepicker(el,"",$compile,cFunc);el.addClass("is_set")}else if(item.is_time&&!el.hasClass("is_set")){renderTimepicker(el,$compile,cFunc);el.addClass("is_set")}})};s.showHideEl=function(id,ts){s.setExtra(id,ts);s[ts].show[id]=!s[ts].show[id]};if(atts.withAdd&&atts.withAdd=="true"){template+='<div class="right" style="margin-top: -50px;">'+'<a class="button radius" ng-click="addTbl(\''+ts.tbl+"', '"+ts.t+"', '"+atts.ts+"')\">"+'<i class="fi-plus"></i> '+(atts.addBtnText||"Add")+"</a>"+"</div>"}template+='<h5 ng-hide="$root.ma('+t+').length > 0" class="panel">'+(atts.emptyMessage||"")+"</h5>"+'<table ng-init="'+ts.predicate+" = 'id'; "+ts.reverse+' = true"'+' ng-show="$root.ma('+t+').length > 0" class="'+atts.class+' editable-tbl">';if(ts){template+="<thead>";a.forEach(ts.array,function(item){var th_span_html="<span"+(item.tt?" data-tooltip "+' aria-haspopup="true" class="has-tip" '+' title="'+item.tt+'"':"")+">"+item.t+"</span>";if(item.is_p||ts.all_have_predicate){template+='<th ng-click="'+ts.predicate+" = '"+item.c+"'; "+ts.reverse+" =!"+ts.reverse+'"'+' style="cursor: pointer;">'+'<img src="img/mss_ic1.png" /> '+th_span_html+"</th>"}else{template+="<th>"+th_span_html+"</th>"}});template+=(atts.withDelete&&atts.withDelete=="true"?"<th>Delete</th>":"")+"<th></th>"+"</thead>"}template+="<tbody>"+"<tr "+(atts.trSelect?' style="cursor: pointer;" '+" ng-class=\"{'g-active': "+atts.trExtraId+" == "+r_el+'.id}" '+' ng-click="'+atts.trSelect+"("+r_el+')" ':"")+' ng-init="'+atts.ts+".show["+r_el+'.id] = true;" '+' ng-repeat="'+r_el+" in "+(atts.filteredItems?" ("+atts.filteredItems+" = (":"")+t+" | array "+(atts.filter||"")+(ts?" | orderBy:"+ts.predicate+":"+ts.reverse:"")+(atts.filteredItems?"))":"")+'">';a.forEach(ts.array,function(item,key){if(item.is_c){template+="<td>"+"<label> "+'<input type="checkbox" '+"ng-click=\"updateCheckboxTbl('"+ts.tbl+"', "+r_el+", '"+item.c+"', '"+atts.ts+"')\" "+'ng-model="'+r_el+"."+item.c+'" '+'ng-checked="'+r_el+"."+item.c+' == 1" />'+"</label>"+"</td>"}else if(item.is_s){var c_el=rs.guid(),ngOptions=!item.w_e?c_el+".id as "+c_el+"."+item.v+" for "+c_el+" in "+item.o+" | array "+(!item.we?" | filter:{status_id:'1'} ":""):c_el+"_id as "+c_el+"."+item.v+" for ("+c_el+"_id,"+c_el+") in "+item.o,value_s="{{("+item.o+"["+r_el+"."+item.c+"]."+item.v+" "+(item.f||"")+") || '-'}}";template+="<td>"+'<div style="cursor: pointer; width: 100%; height: 100%;" '+' ng-show="'+atts.ts+".show["+r_el+'.id]" '+' ng-click="showHideEl('+r_el+".id, '"+atts.ts+"')\">"+value_s+"</div>"+'<div ng-show="!'+atts.ts+".show["+r_el+'.id]">'+'<select ng-model="'+r_el+"."+item.c+'" '+' ng-options="'+ngOptions+'"> '+"</select>"+"</div>"+"</td>"}else if(item.is_t){var value_s="{{("+item.o+"["+r_el+"."+item.c+"]."+item.v+" "+(item.f||"")+") || '-'}}";template+="<td>"+'<div style="width: 100%; height: 100%;">'+(item.p?item.p+" ":"")+value_s+(item.pp?" "+item.pp:"")+"</div>"+"</td>"}else{var value_el="{{("+r_el+"."+item.c+(item.f||"")+") || '-'}}";template+="<td>"+'<div style="cursor: pointer; width: 100%; height: 100%;" '+' ng-show="'+atts.ts+".show["+r_el+'.id]" '+' ng-click="showHideEl('+r_el+".id, '"+atts.ts+"')\">"+(item.p?item.p+" ":"")+value_el+(item.pp?" "+item.pp:"")+"</div>"+'<div ng-show="!'+atts.ts+".show["+r_el+'.id]">'+(item.is_date||item.is_time?'<input type="text" '+' ng-model="'+r_el+"."+item.c+'" '+' id="'+item.c+"{{"+r_el+'.id}}" '+' class="'+(item.i_class||"")+'" />':'<textarea ng-model="'+r_el+"."+item.c+'" '+' style="text-align: center;"'+' class="'+(item.i_class||"")+'"></textarea>')+"</div>"+"</td>"}});template+=(atts.withDelete&&atts.withDelete=="true"?"<td>"+'<i class="fa fa-2x fa-trash" style="cursor: pointer" '+"ng-click=\"deleteTbl('"+ts.tbl+"', '"+ts.t+"', "+r_el+", '"+atts.ts+"')\"></i>"+"</td>":"")+"<td>"+'<sup style="cursor: pointer;" '+' ng-show="!'+atts.ts+".show["+r_el+'.id]" '+' ng-click="'+atts.ts+".show["+r_el+".id] =! "+atts.ts+".show["+r_el+'.id]"> '+'<i class="fa fa-close"></i> '+"</sup>"+'<a class="button tiny radius mr10" '+'ng-show="!'+atts.ts+".show["+r_el+'.id]" '+'ng-click="'+atts.ts+".show["+r_el+".id] =! "+atts.ts+".show["+r_el+".id]; "+"updateTbl('"+ts.tbl+"', "+r_el+", '"+atts.ts+"')\">"+'<i class="fi-check"></i>'+"</a>"+"</td>"+"</tr>"+"</tbody>"+"</table>";el.replaceWith($compile(template)(s))}}}};var transformRequestAsFormPost=function(){function transformRequest(data,getHeaders){var headers=getHeaders();headers["Content-type"]="application/x-www-form-urlencoded; charset=utf-8";return serializeData(data)}function serializeData(data){if(!a.isObject(data)){return data==null?"":data.toString()}var buffer=[];for(var name in data){if(!data.hasOwnProperty(name)){continue}var value=data[name];if(typeof value=="object"){value=JSON.stringify(value)}buffer.push(encodeURIComponent(name)+"="+encodeURIComponent(value==null?"":value))}var source=buffer.join("&").replace(/%20/g,"+");return source}return transformRequest};var httpInterceptor=function($q,$log){var loadingCount=0;return{request:function(config){if(++loadingCount===1)rs.$broadcast("loading:progress");return config||$q.when(config)},response:function(response){if(--loadingCount===0)rs.$broadcast("loading:finished");return response||$q.when(response)},responseError:function(response){if(--loadingCount===0)rs.$broadcast("loading:error");return $q.reject(response)}}};var qEach=function(q){function qEach(collection,promiseFactory){var deferred=q.defer();var promises=_.map(collection,function(value){var val=promiseFactory(value);if(typeof val==="undefined")val=value;return q.when(val)});q.all(promises).then(function(values){deferred.resolve(values)},function(reason){deferred.reject(reason)});return deferred.promise}return qEach};var apiService=function($http,$q,config,transformRequestAsFormPost){var api=config.api,api_r=config.api_r,token=config.token,env=config.env;this.get=function(table,id,method,extra_json,url_method){var url=url_method?api+url_method:api,deffered=$q.defer(),result={};data={token:token,env:env};if(table){data=a.extend(data,{table:table})}if(id){data=a.extend(data,{id:id})}if(method){data=a.extend(data,{method:method})}if(extra_json){data=a.extend(data,extra_json)}data=a.extend(data,{cache:true});var request=$http.get(url,{params:data});request.success(function(r){if(r.r){r.r.is_error=false;deffered.resolve(r.r)}else{deffered.resolve(r)}});request.error(function(r){r_r=r;r={r:r_r,is_error:true};deffered.resolve(r)});return deffered.promise};this.post=function(table,id,postData,method,extra_data){var deffered=$q.defer(),result={},f_data={};a.forEach(postData,function(item,k){if(typeof item!="object"||item==null){f_data[k]=item}});var data={token:token,env:env,table:table,data:f_data};if(id!==undefined&&id!==null&&id!==""){data=a.extend(data,{id:id})}if(method!==undefined){data=a.extend(data,{method:method})}if(extra_data){data=a.extend(data,extra_data)}var request=$http({method:"post",url:api+"/post",transformRequest:transformRequestAsFormPost,data:data});request.success(function(r){r.r.is_error=false;deffered.resolve(r.r)});request.error(function(r){r_r=r;r={r:r_r,is_error:true};deffered.resolve(r)});return deffered.promise};this.query=function(table,query,method){var deffered=$q.defer(),data={token:token,env:env,table:table,query:query};if(method){data=a.extend(data,{method:method})}var request=$http({method:"get",url:api+"/query",transformRequest:transformRequestAsFormPost,params:data});request.success(function(r){r.is_error=false;deffered.resolve(r.r)});request.error(function(r){r_r=r;r={r:r_r,is_error:true};deffered.resolve(r)});return deffered.promise};this.delete=function(table,id,extra_json,method){var deffered=$q.defer(),result={};var data={token:token,env:env,table:table,id:id};if(extra_json!==undefined){data=a.extend(data,extra_json)}if(method!==undefined){data=a.extend(data,{method:method})}var request=$http({method:"get",url:api+"/delete",params:data});request.success(function(r){r.r.is_error=false;deffered.resolve(r.r)});request.error(function(r){r_r=r;r={r:r_r,is_error:true};deffered.resolve(r)});return deffered.promise};this.geoLocation=function(search,from_length,to_length,country){country=country||"USA";deffered=$q.defer();if(rs.isNumberic(pF(search))&&(search.length>=from_length&&search.length<=to_length)){var geocoder=new google.maps.Geocoder;geocoder.geocode({address:search+", "+country},function(results,status){if(status==google.maps.GeocoderStatus.OK){var street="",city="",state="",zip="",country="";a.forEach(results[0].address_components,function(item){if(item.types[0]=="route"){street=item.long_name}else if(item.types[0]=="locality"){city=item.long_name}else if(item.types[0]=="administrative_area_level_1"){state=item.short_name}else if(item.types[0]=="postal_code"){zip=item.long_name}else if(item.types[0]=="country"){country=item.short_name}});var data={street:street,city:city,state:state,zip:zip,country:country};deffered.resolve(data)}})}return deffered.promise}};var modelsService=function(api,$q){this.getModels=function(tables_arr,id,method,extra_json){var self=this,deffered=$q.defer();rs.is_models=true;var tables="";for(var i in tables_arr){var table=tables_arr[i];tables+=table+","}tables=tables.substring(0,tables.length-1);if(tables){api.get(tables,id,method,extra_json).then(function(r){for(var i in tables_arr){var table=tables_arr[i],data=r.multiple?r.multiple[table].data:r.data;data=self.makeIntegerFloatValue(table,data);rs[table]=data}deffered.resolve(r.multiple)})}return deffered.promise};this.makeIntegerFloatValue=function(table,data){var checkValues=function(value){if(value=="true"){return true}else if(value=="false"){return false}else if(value!==false&&value!==true&&rs.isInteger(value,1)){return parseInt(value)}else if(value!==false&&value!==true&&rs.isFloat(value,1)){return parseFloat(value)}else{return value}};if(table.indexOf("settings")!="-1"){a.forEach(data,function(v,n){data[n]=checkValues(v)})}else{a.forEach(data,function(item,id){if(item.id){item.id=parseInt(item.id)}a.forEach(item,function(column,key){item[key]=checkValues(column)})})}return data}};var cFuncService=function(api){this.isNEU=function(in_var){return in_var===null||in_var===""||in_var===undefined};this.guid=function(){return"a"+Math.floor((1+Math.random())*65536).toString(16).substring(1)};this.guid_long=function(){return"l"+Math.random()+Math.random()+Math.random()+Math.random()};this.uid=function(){function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()};this.isEmpty=function(obj){if(obj==null)return true;if(obj.length>0)return false;if(obj.length===0)return true;for(var key in obj){if(hasOwnProperty.call(obj,key))return false}return true};this.fe=function(obj){if(obj){return obj[Object.keys(obj)[0]]}else{return null}};this.generateNumber=function(nr){nr=nr||10;var x=1;for(i=1;i<=nr;i++){x=x*10}return Math.floor(Math.random()*x)}};var languageService=function(api,$q){var self=this;this.language="en";this.setLanguage=function(language){self.language=language};this.l=function(n){if(rs.l_keys&&rs.l_keys[n]&&rs.l_keys[n][self.language]){return rs.l_keys[n][self.language]}return n};this.l_text=function(n){var text=n;a.forEach(rs.lang_keys,function(item){if(item.lang==n){text=item.text}});return text}};var crudService=function(webStorage,api,cFunc,access,models,$q){var self=this;this.tbl_arr={};this.returnModelsStandard=function(tbl){return[{tbl:tbl,t:"rs",with_id:1}]};this.models_tbl_arr=general_tables_arr;a.forEach(this.models_tbl_arr,function(table){self.tbl_arr[table]=self.returnModelsStandard(table)});this.setTableAfterSubmit=function(tables_arr,mod,json_extra,with_req,table){var deffered=$q.defer();if(with_req){api.get(table,mod.id,"").then(function(r){deffered.resolve(r);mod=self.doSetModTableAfterSubmit(mod,r.data[0],json_extra);self.doSetTableAfterSubmit(tables_arr,mod)})}else{mod=self.doSetModTableAfterSubmit(mod,mod,json_extra);self.doSetTableAfterSubmit(tables_arr,mod)}return deffered.promise};this.doSetModTableAfterSubmit=function(mod,new_mod,json_extra){if(json_extra&&!cFunc.isEmpty(json_extra)){mod=a.extend(new_mod,json_extra)}else{mod=new_mod}return mod};this.doSetTableAfterSubmit=function(tables_arr,mod){a.forEach(tables_arr,function(scope_tbl){var scope_table=null;switch(scope_tbl.t){case"rs":scope_table=rs[scope_tbl.tbl];break;case"ws":scope_table=webStorage.local.get(scope_tbl.tbl);break;default:var o_scope=$(scope_tbl.t).scope();scope_table=o_scope?o_scope[scope_tbl.tbl]:null}if(scope_table){mod=models.makeIntegerFloatValue(scope_tbl.t,[mod])[0];if(scope_tbl.with_id){scope_table=rs.isArray(scope_table)?{}:scope_table;var elem={};elem[mod.id]=mod;a.extend(scope_table,elem)}else{var modified=false;a.forEach(scope_table,function(item,item_id){if(item.id==mod.id){scope_table[item_id]=mod;modified=true;return false}});if(!modified){scope_table.unshift(mod)}}if(scope_tbl.t=="ws"){webStorage.local.remove(scope_tbl.tbl);webStorage.local.add(scope_tbl.tbl,scope_table)}else if(scope_tbl.t=="rs"){rs[scope_tbl.tbl]=scope_table}}})};this.deleteItem=function(tables_arr,table,id,without_req,method){var deffered=$q.defer();if(without_req){self.doDeleteItem(tables_arr,id)}else{api.delete(table,id,{},method).then(function(r){deffered.resolve(r);self.doDeleteItem(tables_arr,id)})}return deffered.promise};this.doDeleteItem=function(tables_arr,id){a.forEach(tables_arr,function(scope_tbl){var scope_table=null;switch(scope_tbl.t){case"rs":scope_table=rs[scope_tbl.tbl];break;case"ws":scope_table=webStorage.local.get(scope_tbl.tbl);break;default:var o_scope=$(scope_tbl.t).scope();scope_table=o_scope[scope_tbl.tbl];break}if(scope_table){a.forEach(scope_table,function(item,k){if(item.id==id){if(scope_tbl.with_id){delete scope_table[id]}else{scope_table.splice(k,1)}return false}});if(scope_tbl.t=="ws"){webStorage.local.remove(scope_tbl.tbl);webStorage.local.add(scope_tbl.tbl,scope_table)}}})}};var calcService=function(api,cFunc){this.tax=7;this.calculateTax=function(item){return item/100*this.tax}};var cpService=function(models,access){var self=this;this.rsv_tables=["r_boarding","r_daycare","r_training","r_grooms"];this.clients_b=null;this.doAll=function(){self.initCp();self.buildCp();self.buildPets();self.buildClients();self.buildClientOptions("clients_membership","client_membership");self.buildClientOptions("clients_survey","client_survey");self.buildClientOptions("clients_private","client_private");self.setClientSearchBy();self.buildClientsPosBills();self.buildClientsBoardingBills();self.buildClientsDaycareBills();self.buildClientsGroomsBills();self.buildClientsTrainingBills();self.buildClientsDeposits();self.clients_b=rs.unbind(rs.clients)};this.initCp=function(){if(!access.checkBoarding())self.rsv_tables.splice(self.rsv_tables.indexOf("r_boarding"),1);if(!access.checkDaycare())self.rsv_tables.splice(self.rsv_tables.indexOf("r_daycare"),1);if(!access.checkTraining())self.rsv_tables.splice(self.rsv_tables.indexOf("r_training"),1);if(!access.checkGrooming())self.rsv_tables.splice(self.rsv_tables.indexOf("r_grooms"),1)};this.buildCp=function(){var cp_cp={},cp={};a.forEach(rs.cp,function(item){var client_id=item.client_id,pet_id=item.pet_id;if(rs.clients[client_id]&&rs.pets[pet_id]){if(cp[client_id]){cp[client_id].push(pet_id)}else{cp[client_id]=[pet_id]}cp_cp[pet_id]=[client_id]}});rs.cp=cp;rs.cp_cp=cp_cp};this.buildPetsRsv=function(){a.forEach(self.rsv_tables,function(tbl){a.forEach(rs[tbl],function(item){if(item.pet_id&&rs.pets[item.pet_id]){if(!rs.pets[item.pet_id][tbl]){rs.pets[item.pet_id][tbl]={}}rs.pets[item.pet_id][tbl][item.id]=item}var payment_tbl=tbl.replace("r_","")+"_payments";a.forEach(rs[payment_tbl],function(item_payment){if(item_payment[tbl+"_id"]==item.id){rs[tbl][item.id].o=item_payment;rs.pets[item.pet_id][tbl][item.id].o=item_payment}})})})};this.buildPetsRsvExtra=function(){a.forEach(rs.r_ss,function(item){if(rs.pets[item.pet_id]&&rs.pets[item.pet_id][item.r_type]){a.forEach(rs.pets[item.pet_id][item.r_type],function(r_b){if(r_b.id==item.r_id){if(!rs.pets[item.pet_id][item.r_type][item.r_id].r_ss){rs.pets[item.pet_id][item.r_type][item.r_id].r_ss={}}rs.pets[item.pet_id][item.r_type][item.r_id].r_ss[item.id]=item;return false}})}});a.forEach(rs.r_meds,function(item){if(rs.pets[item.pet_id]&&rs.pets[item.pet_id][item.r_type]){a.forEach(rs.pets[item.pet_id][item.r_type],function(r_b){if(r_b.id==item.r_id){if(!rs.pets[item.pet_id][item.r_type][item.r_id].r_meds){rs.pets[item.pet_id][item.r_type][item.r_id].r_meds={}}rs.pets[item.pet_id][item.r_type][item.r_id].r_meds[item.id]=item;return false}})}});a.forEach(rs.r_diets,function(item){if(rs.pets[item.pet_id]&&rs.pets[item.pet_id][item.r_type]){a.forEach(rs.pets[item.pet_id][item.r_type],function(r_b){if(r_b.id==item.r_id){if(!rs.pets[item.pet_id][item.r_type][item.r_id].r_diets){rs.pets[item.pet_id][item.r_type][item.r_id].r_diets={}}rs.pets[item.pet_id][item.r_type][item.r_id].r_diets[item.id]=item;return false}})}})};this.buildPetsRecords=function(){a.forEach(rs.records_boarding,function(item){if(rs.pets[item.pet_id]){rs.pets[item.pet_id].records_boarding=item;return false}});a.forEach(rs.records_daycare,function(item){if(rs.pets[item.pet_id]){rs.pets[item.pet_id].records_daycare=item;return false}});a.forEach(rs.records_training,function(item){if(rs.pets[item.pet_id]){rs.pets[item.pet_id].records_training=item;return false}});a.forEach(rs.records_grooming,function(item){if(rs.pets[item.pet_id]){rs.pets[item.pet_id].records_grooming=item;rs.pets[item.pet_id].records_grooming.gs_ids=rs.pets[item.pet_id].records_grooming.gs_ids?JSON.parse(rs.pets[item.pet_id].records_grooming.gs_ids):[];return false}});a.forEach(rs.records_services,function(item){if(rs.pets[item.pet_id]){rs.pets[item.pet_id].records_services=rs.pets[item.pet_id].records_services||{};rs.pets[item.pet_id].records_services[item.id]=item}});a.forEach(rs.records_meds_diets,function(item){if(rs.pets[item.pet_id]){if(item.type==1){rs.pets[item.pet_id].records_meds=rs.pets[item.pet_id].records_meds||{};rs.pets[item.pet_id].records_meds[item.id]=item}else if(item.type==2){rs.pets[item.pet_id].records_diets=rs.pets[item.pet_id].records_diets||{};rs.pets[item.pet_id].records_diets[item.id]=item}}})};this.buildPets=function(type){self.buildPetsRsv();self.buildPetsRsvExtra();self.buildPetsRecords();self.calculatePetNoVisits();a.forEach(rs.pet_vet,function(pet_vet){if(rs.pets[pet_vet.pet_id]){rs.pets[pet_vet.pet_id].pet_vet=pet_vet}});a.forEach(rs.sticky,function(item){if(rs.cp_cp[item.pet_id]&&!item.client_id){rs.pets[item.pet_id].sticky=item}})};this.calculatePetNoVisits=function(pet){var calculateVisits=function(pet){pet.no_visits=0;a.forEach(self.rsv_tables,function(r_tbl){pet.no_visits+=pet[r_tbl]?rs.ma(pet[r_tbl]).length:0})};if(pet){calculateVisits(pet)}else{a.forEach(rs.pets,function(pet){calculateVisits(pet)})}};this.setClientPrefferedPhone=function(client){client.preffered_phone=client.contact_phone||"";switch(client.preffered_phone_id){case 1:client.preffered_phone=client.contact_phone?client.contact_phone:"";break;case 2:client.preffered_phone=client.contact_cell?client.contact_cell:"";break;case 3:client.preffered_phone=client.contact_work_phone?client.contact_work_phone:"";break;case 4:client.preffered_phone=client.emergency_phone?client.emergency_phone:"";break}return client};this.buildClients=function(type){a.forEach(rs.clients,function(client,client_id){var pet_id=rs.cp[client_id]?rs.cp[client_id].slice(-1)[0]:"";rs.clients[client_id].pet=pet_id?rs.pets[pet_id]:{};client=self.setClientPrefferedPhone(client)});a.forEach(rs.sticky,function(item){if(rs.cp[item.client_id]&&!item.pet_id){rs.clients[item.client_id].sticky=item}});a.forEach(rs.clients_rewards,function(item){if(rs.clients[item.client_id]){rs.clients[item.client_id].reward_points=rs.cp[item.client_id]?pF(item.points):0}});a.forEach(rs.clients_survey,function(item){if(item.client_survey_findout_id==5){rs.clients[item.reffered_id].refferals=rs.clients[item.reffered_id].refferals||0;rs.clients[item.reffered_id].refferals+=1}})};this.buildClientOptions=function(table,target){a.forEach(rs[table],function(item){if(rs.clients[item.client_id]){rs.clients[item.client_id][target]=item}})};this.setClientSearchBy=function(){rs.client_search_by="name";var default_search_id=rs.general_features[23].v;if(default_search_id==5){rs.client_search_by="breed"}else if(default_search_id==4){rs.client_search_by="pet_id"}else if(default_search_id==3){rs.client_search_by="pet"}else if(default_search_id==2){rs.client_search_by="phone"}else if(default_search_id==1&&rs.access.checkMembership()){rs.client_search_by="membership"}};this.buildClientsPosBills=function(){a.forEach(rs.clients,function(client){client.pp={processed:[],pending:[],refunded:[],pending_total:0,processed_total:0,refunded_total:0}});a.forEach(rs.pos_payments,function(pp){if(pp.client_id){if(rs.clients[pp.client_id]){if(pp.payment_status_id==1){rs.clients[pp.client_id].pp.processed.push(pp);rs.clients[pp.client_id].pp.processed_total+=pp.required}else if(pp.payment_status_id==2){rs.clients[pp.client_id].pp.pending.push(pp);rs.clients[pp.client_id].pp.pending_total+=pp.unpaid}else if(pp.payment_status_id==3){rs.clients[pp.client_id].pp.refunded.push(pp);rs.clients[pp.client_id].pp.refunded_total+=pp.required}}}})};this.buildClientsBoardingBills=function(){a.forEach(rs.clients,function(client){client.bp={processed:[],pending:[],pending_total:0,processed_total:0}});a.forEach(rs.boarding_payments,function(bp){if(bp.client_id){if(rs.clients[bp.client_id]){if(bp.payment_status_id==1){rs.clients[bp.client_id].bp.processed.push(bp);rs.clients[bp.client_id].bp.processed_total+=bp.required}else if(bp.payment_status_id==2){rs.clients[bp.client_id].bp.pending.push(bp);rs.clients[bp.client_id].bp.pending_total+=bp.unpaid}}}})};this.buildClientsDaycareBills=function(){a.forEach(rs.clients,function(client){client.dp={processed:[],pending:[],pending_total:0,processed_total:0}});a.forEach(rs.daycare_payments,function(dp){if(dp.client_id){if(rs.clients[dp.client_id]){if(dp.payment_status_id==1){rs.clients[dp.client_id].dp.processed.push(dp);rs.clients[dp.client_id].dp.processed_total+=dp.required}else if(dp.payment_status_id==2){rs.clients[dp.client_id].dp.pending.push(dp);rs.clients[dp.client_id].dp.pending_total+=dp.unpaid}}}})};this.buildClientsGroomsBills=function(){a.forEach(rs.clients,function(client){client.gp={processed:[],pending:[],pending_total:0,processed_total:0}});a.forEach(rs.grooms_payments,function(gp){if(gp.client_id){if(rs.clients[gp.client_id]){if(gp.payment_status_id==1){rs.clients[gp.client_id].gp.processed.push(gp);rs.clients[gp.client_id].gp.processed_total+=gp.required}else if(gp.payment_status_id==2){rs.clients[gp.client_id].gp.pending.push(gp);rs.clients[gp.client_id].gp.pending_total+=gp.unpaid}}}})};this.buildClientsTrainingBills=function(){a.forEach(rs.clients,function(client){client.tp={processed:[],pending:[],pending_total:0,processed_total:0}});a.forEach(rs.training_payments,function(tp){if(tp.client_id){if(rs.clients[tp.client_id]){if(tp.payment_status_id==1){rs.clients[tp.client_id].tp.processed.push(tp);rs.clients[tp.client_id].tp.processed_total+=tp.required}else if(tp.payment_status_id==2){rs.clients[tp.client_id].tp.pending.push(tp);rs.clients[tp.client_id].tp.pending_total+=tp.unpaid}}}})};this.buildClientsDeposits=function(){a.forEach(rs.clients,function(client){client.deposits={total:0,data:[]}});a.forEach(rs.deposits,function(d){if(rs.clients[d.client_id]){if(d.plus_minus=="plus"){rs.clients[d.client_id].deposits.total+=pF(d.payment_amount)}else if(d.plus_minus=="minus"){rs.clients[d.client_id].deposits.total-=pF(d.payment_amount)}rs.clients[d.client_id].deposits.data.push(d)}})}};var rsvService=function(crud,cp){var self=this;this.doAll=function(){self.buildRGrooms()};this.buildRGrooms=function(){a.forEach(rs.r_grooms,function(item){rs.r_grooms[item.id].gs_array=JSON.parse(rs.r_grooms[item.id].gs_array)})};this.afterSubmit=function(s,tbl,t){var not_found=1;if(!rs.pet[tbl]){rs.pet[tbl]={}}a.forEach(rs.pet[tbl],function(item){if(item.id==s[t].id){not_found=0;return false}});if(not_found){rs.pet[tbl][s[t].id]=s[t]}cp.calculatePetNoVisits(rs.pet);crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet);crud.setTableAfterSubmit(crud.tbl_arr[tbl],s[t])};this.afterDelete=function(id,tbl,t){a.forEach(rs.pet[tbl],function(item,k){if(item.id==id){delete rs.pet[tbl][id];return false}});cp.calculatePetNoVisits(rs.pet);crud.setTableAfterSubmit(crud.tbl_arr.pets,rs.pet);crud.deleteItem(crud.tbl_arr[tbl],tbl,id)}};var dateTimeService=function(cFunc){var self=this;this.getLastDatesBeforeNrDays=function(date,nr_days){if(date){date_obj=new Date(date)}else{date_obj=new Date}var result_arr=[],a_day_back=date_obj;for(i=0;i<=nr_days;i++){var day_obj={text:a_day_back.toString().substring(0,3)+" "+(a_day_back.getMonth()+1)+"/"+a_day_back.getDate(),date:rs.getCurrentDate(a_day_back),time:a_day_back.getTime(),date_obj:a_day_back};a_day_back.setDate(a_day_back.getDate()-1);result_arr.push(day_obj)}result_arr.sort();return result_arr}};var pdfService=function($filter,$q){var self=this;this.noneImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2P8DwQACgAD/il4QJ8AAAAASUVORK5CYII=";this.hr_image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAmEAAAAcCAIAAACmtP8qAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAVlJREFUeNrs3D2OgzAQBlB72RRJkTNwAe5/gRwnTdIi4S3QIuSfyQHyXmkMjM1YXxEpuZSSAIDGjy0AABkJADISAGQkAMhIAJCRACAjAUBGAoCMBAAZCQAyEgBkJACQUkrpd3Th/X4/Ho/n83m5XM7jOeeU0v5P6DnnUso+Ug1253dHPk44Rqq7jlcHg1Ux1bRjzj6/ndxeOiqpKjw/ubufwbacn3l++MdbRmvs3vhxk+PHjt7e3dh4i0aVnN/YrTn4iO3aqzKC2tpOaAsImiRus9H5GrVu+/aqPaq1xF9kdEjj/ux+iPaMd09QVXbwdYLuDfqhPSbxcoJe7a6o2xvbts3zvCzL/X6XGd9meIy3bXu9Xuu6jroT4BuUUqZpul6vt9vNbshIACAlv0cCgIwEABkJADISAGQkAMhIAJCRACAjAUBGAoCMBAAZCQAyEgD49wcAAP//AwChPCA+I8mF3wAAAABJRU5ErkJggg==";this.report_image="";this.client_image="";this.pet_image="";this.styles={header:{fontSize:18,bold:true,margin:[0,2,0,2]},subheader:{fontSize:11,bold:true,margin:[0,2,0,2],color:"gray"},reportImage:{width:400,height:70,margin:[0,0,0,20]},tableExample:{fontSize:11,margin:[0,5,0,15]},tableHeader:{fontSize:12,bold:true,color:"black"},topTitle:{fontSize:26,bold:true,margin:[0,10,0,10],color:"red"},topTitle2:{fontSize:18,bold:true,margin:[0,10,0,10],color:"red"},topTitle3:{fontSize:14,bold:true,margin:[0,10,0,10],color:"black"},subTitle:{fontSize:11,bold:true,margin:[0,2,0,2],color:"gray"},subTitle2:{fontSize:14,bold:true,margin:[0,2,0,15],color:"gray"},subTitle3:{fontSize:12,bold:true,color:"black"},subTitle4:{fontSize:11,italics:true,color:"gray"}};
this.initImages=function(){self.makeImage(rs,"settings","report_image_id","report_image","path_thumb")};this.convertImgToBase64=function(url,callback,outputFormat){var canvas=document.createElement("CANVAS"),ctx=canvas.getContext("2d"),img=new Image;img.crossOrigin="Anonymous";img.src=url;img.onload=function(){var dataURL;canvas.height=img.height;canvas.width=img.width;ctx.drawImage(img,0,0);dataURL=canvas.toDataURL(outputFormat);callback.call(this,dataURL);canvas=null}};this.makeImage=function(scope,t,n,tt,path){var deffered=$q.defer();var img_image="";if(scope[t][n]){if(rs.files[scope[t][n]]){self.convertImgToBase64($filter("l")(rs.files[scope[t][n]][path]),function(base64img){self[tt]=base64img;deffered.resolve(base64img)})}else{self[tt]=self.noneImg;deffered.resolve(self.noneImg)}}else{self[tt]=self.noneImg;deffered.resolve(self.noneImg)}return deffered.promise};this.options=function(type,docDefinition,report_name){switch(type){case"screen":pdfMake.createPdf(docDefinition).open();break;case"print":pdfMake.createPdf(docDefinition).print();break;case"download":pdfMake.createPdf(docDefinition).download(report_name);break}};this.contactInfoHeader=function(){return[{image:self.report_image,style:"reportImage"},{columns:[{stack:[{text:rs.settings.business_name||"",style:"header"},{text:rs.settings.business_address?rs.l.l("address")+": "+rs.settings.business_address:""}]},{stack:[{text:rs.settings.business_main_phone?rs.l.l("phone")+": "+rs.settings.business_main_phone:"",style:"subheader"},{text:rs.settings.business_extra_phone?rs.l.l("contact")+": "+rs.settings.business_extra_phone:"",style:"subheader"},{text:rs.settings.business_email?rs.l.l("email")+": "+rs.settings.business_email:"",style:"subheader"}]}]},{text:"\n\n"}]}};var accessService=function($cookies){var self=this;this.checkGf=function(){return rs.general_features!==undefined};this.checkUis=function(){return rs.user_interface_settings!==undefined};this.checkBoarding=function(){if(self.checkGf()){return rs.general_features[1].v==1}return false};this.checkGrooming=function(){if(self.checkGf()){return rs.general_features[4].v==1}return false};this.checkTraining=function(){if(self.checkGf()){return rs.general_features[5].v==1}return false};this.checkDaycare=function(){if(self.checkGf()){return rs.general_features[2].v==1}return false};this.checkRsv=function(){if(self.checkGf()){var result=false;a.forEach([1,2,4,5],function(id){if(rs.general_features[id].v!=0){result=true;return false}});return result}return false};this.checkServices=function(){if(self.checkGf()){return rs.general_features[6].v==1}return false};this.checkMeds=function(){if(self.checkGf()){return rs.general_features[14].v==1}return false};this.checkDiets=function(){if(self.checkGf()){return rs.general_features[15].v==1}return false};this.checkRewards=function(){if(self.checkGf()){return rs.general_features[3].v==1}return false};this.checkRewardsIsActive=function(){if(rs.promotions_settings&&!rs.isEmpty(rs.promotions)){return rs.promotions_settings.rewards_program_is_active==1}return false};this.checkSticky=function(){if(self.checkGf()){return rs.general_features[18].v==1}return false};this.checkPetRecords=function(){if(self.checkGf()){return rs.general_features[17].v==1}return false};this.checkNotepads=function(){if(self.checkGf()){return rs.general_features[19].v==1}return false};this.checkVaccinations=function(){if(self.checkGf()){return rs.general_features[16].v==1}return false};this.checkSurvey=function(){if(self.checkUis()){return rs.user_interface_settings.show_survey_when_creating_client==1}return false};this.checkSurveyIncome=function(){if(self.checkUis()){return rs.user_interface_settings.show_income_survey_when_creating_client==1}return false};this.checkMembership=function(){if(self.checkUis()){return rs.user_interface_settings.enable_membership==1}return false};this.checkSearchMembership=function(){if(self.checkGf()){return rs.general_features[20].v==1}return false};this.checkSearchPetId=function(){if(self.checkGf()){return rs.general_features[21].v==1}return false};this.checkSearchPetBreed=function(){if(self.checkGf()){return rs.general_features[22].v==1}return false};this.isKennel=function(){return $cookies.kennel};this.isLoggedIn=function(){return!rs.isEmpty(rs.identity)};this.checkPointOfSale=function(){if(self.checkGf()){return rs.general_features[24].v==1}return false};this.checkManager=function(){if(self.checkGf()){return rs.general_features[25].v==1}return false};this.checkReports=function(){if(self.checkGf()){return rs.general_features[26].v==1}return false};this.checkVacancies=function(){if(self.checkGf()){return rs.general_features[27].v==1}return false};this.checkDeposits=function(){if(self.checkGf()){return rs.general_features[28].v==1}return false};this.checkLayout=function(){if(self.checkGf()){return rs.general_features[29].v==1}return false};this.checkSideMenu=function(){if(self.checkGf()){var result=false;a.forEach([24,25,26,27,28,29],function(id){if(rs.general_features[id].v!=0){result=true;return false}});return result}return false};this.enableEmail=function(){if(self.checkUis()){return rs.user_interface_settings.enable_email==1}return false};this.requireAddressClient=function(){if(self.checkUis()){return rs.user_interface_settings.require_address_when_creating_client==1}return false};this.requireEmailClient=function(){if(self.checkUis()&&self.enableEmail()){return rs.user_interface_settings.require_email_when_creating_client==1}return false};this.alarmPetAge=function(){if(self.checkUis()){return rs.user_interface_settings.alarm_pet_age_when_older_than==1}return false};this.alarmPetAgeValue=function(){if(self.alarmPetAge()){return rs.user_interface_settings.alarm_pet_age_when_older_than_value||null}return null};this.checkCouponsPos=function(){if(self.checkGf()){return rs.general_features[8].v==1}return false};this.checkRefundsPos=function(){if(self.checkGf()){return rs.general_features[7].v==1}return false}};var settingsService=function(api,cFunc,access,$filter){var self=this;this.doAll=function(){self.buildSettings();self.buildSiteLogo();self.buildUsersRoles();self.buildIdentityMessages();self.buildSecurityLevels();self.buildExtra();self.buildPromotions();self.buildLanguages();self.buildDso();self.buildFoundationPatterns()};this.buildSettings=function(){rs.status={1:{id:1,v:"active"},2:{id:2,v:"inactive"}};rs.countries={1:{id:1,v:"United states"},2:{id:2,v:"Australia"}};rs.modifiers={1:{id:1,v:"- %"},2:{id:2,v:"- $"}};rs.hours_rounding_nr={1:{id:1,v:"Round UP to the nearest hour"},2:{id:2,v:"Round DOWN to the nearest hour"},3:{id:3,v:"Don't round. Use fractions"},4:{id:4,v:"Don't round. Use fractions"},5:{id:5,v:"Round UP to the nearest half hour"},6:{id:6,v:"Round DOWN to the nearest half hour"}};rs.check_groups_limit_nr={1:{id:1,v:"Don't check (fastest)"},2:{id:2,v:"Check and ask to confirm if overbooking"},3:{id:3,v:"Check and never allow overbooking"}};rs.seasons={1:{id:1,v:"Low season"},2:{id:2,v:"High season"},3:{id:3,v:"Christmas season"}};rs.default_search_options={1:{id:1,v:"Membership"},2:{id:2,v:"Phone"},3:{id:3,v:"Pet name"},4:{id:4,v:"Pet ID"},5:{id:5,v:"Pet Breed"},6:{id:6,v:"Client name"}};rs.yes_no={0:{id:0,v:"No"},1:{id:1,v:"Yes"},"true":{v:"Yes"},"false":{v:"No"}};rs.payment_status={1:{id:1,v:"Processed"},2:{id:2,v:"Pending"},3:{id:3,v:"Refunded"}};rs.days=["mon","tue","wed","thu","fri","sat","sun"];rs.classes_discounts=["sale","damage","whole","comp","employee"];rs.preffered_phone={1:{id:1,v:"Home"},2:{id:2,v:"Cell"},3:{id:3,v:"Emergency"},4:{id:4,v:"Work"}};rs.tel_formats={1:{id:1,v:"(123) 456-7890",error_text:'Please enter this format "(123) 456-7890"',r:new RegExp("\\([0-9]{3}\\)\\s[0-9]{3}\\-[0-9]{4}")},2:{id:2,v:"0740 815174",error_text:'Please enter this format "0740 815174"',r:new RegExp("0+7+[0-9]{2}\\s[0-9]{6}")}};rs.md_select={1:{id:1,v:"Medications"},2:{id:2,v:"Diets"}};rs.rs_schedule=[{n:"Schedule always",v:"schedule_always"},{n:"Only boarding",v:"only_boarding"},{n:"Only daycare",v:"only_daycare"}];rs.taxable_array={0:{id:0,n:"Non-Taxable"},1:{id:1,n:"Taxable"}};rs.default_retail_level={1:{id:1,v:"Sale"},2:{id:2,v:"Damage"},3:{id:3,v:"Whole"},4:{id:4,v:"Comp"}};rs.cc_types={1:{id:1,v:"Visa"},2:{id:2,v:"Master Card"},3:{id:3,v:"Discover Card"},4:{id:4,v:"American Express"}};rs.cc_exp_month={1:{id:1,v:"01 Jan"},2:{id:2,v:"02 Feb"},3:{id:3,v:"03 Mar"},4:{id:4,v:"04 Apr"},5:{id:5,v:"05 May"},6:{id:6,v:"06 Jun"},7:{id:7,v:"07 Jul"},8:{id:8,v:"08 Aug"},9:{id:9,v:"09 Sep"},10:{id:10,v:"10 Oct"},11:{id:11,v:"11 Nov"},12:{id:12,v:"12 Dec"}};rs.cc_exp_year=[];var c_year=rs.getYear();f_year=pF(c_year)-7;t_year=pF(c_year)+10;for(i=f_year;i<=t_year;i++){rs.cc_exp_year.push(i)}rs.boarding_charges=[{n:"Charge by runtype",v:"charge_by_runtype"},{n:"Charge by petsizes",v:"charge_by_petsizes"}]};this.buildSiteLogo=function(){rs.site_logo=rs.files[rs.settings.image_logo_id]?$filter("l")(rs.files[rs.settings.image_logo_id].path_thumb):$filter("baseUrl")("img/paw.png")};this.buildDso=function(){if(rs.general_features[20].v){rs.default_search_options[1]={id:1,v:"Membership"}}else{delete rs.default_search_options[1]}if(rs.general_features[21].v){rs.default_search_options[4]={id:4,v:"Pet ID"}}else{delete rs.default_search_options[4]}if(rs.general_features[22].v){rs.default_search_options[5]={id:5,v:"Pet Breed"}}else{delete rs.default_search_options[5]}};this.buildLanguages=function(without_lang_keys){rs.l_keys={};var l_array=rs.unbind(rs.languages);a.forEach(l_array,function(i){rs.l_keys[i.k]=i});if(!without_lang_keys){rs.lang_keys=JSON.parse(rs.settings.languages)}};this.buildUsersRoles=function(){var role_ids=[];a.forEach(rs.role,function(item,id){rs[item.n+"s"]={};role_ids.push(id)});a.forEach(rs.users,function(item,id){item.v=item.first_name+" "+item.last_name;if(role_ids.indexOf(item.role_id.toString())!==-1){var role_item=rs.role[item.role_id];rs[role_item.n+"s"][id]=item}})};this.buildIdentityMessages=function(){rs.identity.messages={inbox:[],sent:[],deleted:[],unread:0};a.forEach(rs.messages,function(item,id){if(item.sent_user_id==rs.identity.id&&!item.is_deleted){rs.identity.messages.sent.push(item)}else if(item.sent_user_id==rs.identity.id&&item.is_deleted){rs.identity.messages.deleted.push(item)}if(item.inbox_user_id==rs.identity.id&&!item.is_deleted){rs.identity.messages.inbox.push(item)}else if(item.inbox_user_id==rs.identity.id&&item.is_deleted){rs.identity.messages.deleted.push(item)}if(item.inbox_user_id==rs.identity.id&&!item.is_read&&!item.is_deleted){rs.identity.messages.unread+=1}})};this.buildSecurityLevels=function(){var security_levels={};a.forEach(rs.sl_cp,function(sl_cp,sl_cp_id){if(!security_levels[sl_cp.role_id]){security_levels[sl_cp.role_id]={}}var sl_type=rs.security_levels[sl_cp.sl_id].t;if(!security_levels[sl_cp.role_id][sl_type]){security_levels[sl_cp.role_id][sl_type]={}}var sl_n=rs.security_levels[sl_cp.sl_id].n,sl_data={id:sl_cp_id,n:sl_n,v:sl_cp.v,title:rs.security_levels[sl_cp.sl_id].title};security_levels[sl_cp.role_id][sl_type][sl_n]={};security_levels[sl_cp.role_id][sl_type][sl_n]=sl_data});rs.security_levels_cp=security_levels};this.buildExtra=function(){rs.base_type_filter=[{n:rs.grooming_options[5].v,v:1},{n:rs.grooming_options[6].v,v:2}];rs.base_type_array={1:{n:rs.grooming_options[5].v,v:1},2:{n:rs.grooming_options[6].v,v:2}}};this.buildPromotions=function(){var cdt_time=(new Date).getTime();a.forEach(rs.promotions,function(item,k){var p_time=new Date(item.expiration_date).getTime();if(p_time<=cdt_time){delete rs.promotions[k]}else{if(item.promotion_name.indexOf("pts")==-1){item.promotion_name+=" ["+item.points+" pts.]"}}})};this.buildFoundationPatterns=function(){var patterns={us_date:/[0-9]{2}\/[0-9]{2}\/[0-9]{4}/},pfid=rs.user_interface_settings.phone_format_id,cfid=rs.user_interface_settings.cell_format_id,ffid=rs.user_interface_settings.fax_format_id;if(pfid&&rs.tel_formats[pfid]){patterns=a.extend(patterns,{phone_number:rs.tel_formats[pfid].r})}if(pfid&&rs.tel_formats[cfid]){patterns=a.extend(patterns,{cell_number:rs.tel_formats[cfid].r})}if(ffid&&rs.tel_formats[ffid]){patterns=a.extend(patterns,{fax_number:rs.tel_formats[ffid].r})}$(document).foundation({abide:{patterns:patterns}})}};var commonFilters=commonFilters||{};commonFilters.Bootstrap={};commonFilters.Bootstrap.Array=function(){return function(items){var filtered=[];a.forEach(items,function(item,item_id){filtered.push(item)});return filtered}};commonFilters.Bootstrap.MongoLink=function(){return function(item,arg){var currentLocation=location.href;if(currentLocation[currentLocation.length-1]!=="/")currentLocation+="/";return currentLocation+item[arg]}};commonFilters.Bootstrap.L=function(config){return function(input){if(input===undefined||input===null||input===""){return""}return config.api_r+(input.charAt(0)=="/"?input:"/"+input)}};commonFilters.Bootstrap.BaseUrl=function(config){return function(input){if(input===undefined||input===null||input===""){return""}return config.api_l+(input.charAt(0)=="/"?input:"/"+input)}};commonFilters.Bootstrap.DobString=function(){return function(date,extra_str){if(date!==undefined){var str="";if(date.match(/[0-9]{1,2}\/[0-9]{1,2}\/[0-9]{4}/)){var today=new Date,newDate=new Date(date),d_timestamp=newDate.getTime(),t_timestamp=today.getTime(),timestamp=t_timestamp-d_timestamp,days=pI(timestamp/864e5),months=pI(timestamp/2592e6),years=0;if(months>12){years=pI(months/12)}months=pI(months-12*years);if(years==0){str=""}else{if(years!=0){if(years==1){str=years+" yr, "}else{str=years+" yrs, "}}}if(years==0&&months==0){str+=days+" days old"}else if(months==0){str+="old"}else{if(months==1){str+=" "+months+" mon. old"}else{str+=" "+months+" mon. old"}}}if(extra_str!==undefined&&str!=""){str=extra_str+" "+str}return str}return""}};commonFilters.Bootstrap.DobStringYear=function(access){return function(date,extra_str){if(date&&date.match(/[0-9]{1,2}\/[0-9]{1,2}\/[0-9]{4}/)){var today=new Date,newDate=new Date(date),d_timestamp=newDate.getTime(),t_timestamp=today.getTime(),timestamp=t_timestamp-d_timestamp,days=pI(timestamp/864e5),months=pI(timestamp/2592e6),years=0;if(months>12){years=pI(months/12)}if(pI(years)>0&&years>=pI(access.alarmPetAgeValue())){return true}}return false}};commonFilters.Bootstrap.GetDate=function(){return function(input){var d=new Date;return d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()}};commonFilters.Bootstrap.GetTime=function(){return function(input){var d=new Date;return d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()}};commonFilters.Bootstrap.GetDateTime=function(){return function(input){return commonFilters.Bootstrap.getDate()+" "+commonFilters.Bootstrap.getTime()}};commonFilters.Bootstrap.FilterExcludeObjIds=function(){return function(inputArray,excludedObjectIds){var filteredArray=[];a.forEach(excludedObjectIds,function(ids,input_id){a.forEach(inputArray,function(item){if(ids.indexOf(item[input_id])!=-1){if(filteredArray.indexOf(item)==-1){filteredArray.push(item)}}})});return filteredArray.length>0?filteredArray:inputArray}};commonFilters.Bootstrap.FilterRelationship=function(){return function(inputArray,st){var filteredArray=[];if(inputArray.length>0){a.forEach(rs[st.table],function(item,id){if(item[st.cn_id]==rs[st.ev_id]){filteredArray.push(rs[st.at][item[st.an_id]])}})}return filteredArray.length>0?filteredArray:inputArray}};commonFilters.Bootstrap.Slice=function(){return function(arr,start,end){return(arr||[]).slice(start,end)}};commonFilters.Bootstrap.IsEmpty=function(){var bar;return function(obj){for(bar in obj){if(obj.hasOwnProperty(bar)){return false}}return true}};commonFilters.Bootstrap.LastEl=function($filter){return function(array){if(array.length!=0){return array[array.length-1]}else{return null}}};commonFilters.Bootstrap.Capitalize=function(){return function(input,all){return!!input?input.replace(/([^\W_]+[^\s-]*) */g,function(txt){if(txt&&txt.charAt(0)){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()}return""}):""}};commonFilters.Bootstrap.HtmlEscape=function(){return function(input){if(!input){return""}input=input.toString();return input.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")}};commonFilters.Bootstrap.TextToHtml=function($sce,htmlEscapeFilter){return function(input){if(!input){return""}input=input.toString();input=htmlEscapeFilter(input);var output="";$.each(input.split("\n\n"),function(key,paragraph){output+="<p>"+paragraph+"</p>"});return $sce.trustAsHtml(output)}};var dateFilters=dateFilters||{};dateFilters.Bootstrap={};dateFilters.Bootstrap.FilterDates=function(){return function(array,data){var new_array={},item={},date="",date_in=data&&data.date_in?new Date(data.date_in).getTime()/1e3:"",date_out=data&&data.date_out?new Date(data.date_out).getTime()/1e3:"";var hasId=function(new_array,item){if(item.id){new_array[item.id]=item}else{if(a.isObject(new_array)){new_array=[]}new_array.push(item)}};var checkDates=function(date,date_in,date_out,item){if(date&&!isNaN(date)){if(date_in&&date_out){if(date_in==date&&date==date_out){hasId(new_array,item)}else if(date_in<=date&&date<=date_out){hasId(new_array,item)}}else if(date_in){if(date_in<=date){hasId(new_array,item)}}else if(date_out){if(date<=date_out){hasId(new_array,item)}}}};if(date_in||date_out){a.forEach(array,function(item){if(rs.isArray(data.target_date)){a.forEach(data.target_date,function(t_date){if(item[t_date]){var date=new Date(item[t_date].substring(0,10)).getTime()/1e3;checkDates(date,date_in,date_out,item)}})}else{if(item[data.target_date]){var date=new Date(item[data.target_date].substring(0,10)).getTime()/1e3;checkDates(date,date_in,date_out,item)}}});return new_array}return array}};var configConstant={api:"",api_r:"",api_l:"",token:"",env:"",kennel:""};var settings_tables_arr=["settings","daycare_settings","boarding_settings","promotions_settings","tax_settings","user_interface_settings"];var general_tables_arr=["role","users","security_levels","general_features","sl_cp","clients","pets","cp","pet_type","pet_breed","pet_sex","pet_size","pet_color","pet_status","pet_vet","client_status","stay_reasons","grooming_options","grooming_priority","grooming_rates","grooming_services","grooming_commissions","boarding_petsizes","boarding_runtypes","schedule_services","meds","meds_type","md_dosage","md_dose_type","diets","diets_type","payment_types","vets","client_survey_income","client_survey_findout","retail_inventory","retail_classes","retail_vendors","retail_vi","r_boarding","r_daycare","r_grooms","r_training","r_ss","r_meds","r_diets","clients_survey","training_groups","training_options","training_schedule","daycare_groups","records_daycare","records_boarding","records_services","records_grooming","records_training","records_meds_diets","notepads","sticky","files","promotions","layout_sections","layout_runs","discounts_boarding_long_term","discounts_boarding_multiple_pet","discounts_boarding_new_client","discounts_boarding_priority_club","holiday","season","languages","tokens","clients_membership","pos_payments","payments","deposits","clients_rewards","clients_private","messages","boarding_payments","daycare_payments","grooms_payments","training_payments"];var crudCtrlSettings=function(settings){mainApp.controller("CrudCtrl",CrudCtrl);mainApp.run(foundationRun);settings.buildFoundationPatterns()};var routerConstant=function($stateProvider,$urlRouterProvider){mainApp.stateProvider=$stateProvider;$urlRouterProvider.otherwise("/");$stateProvider.state("main",{url:"/",controller:function($rootScope){$("#mainPage").show();document.getElementById("mainContent").scrollTop=0}}).state("general-settings",{url:"/tbl/settings/general-settings",templateUrl:"partials?t=tbl/settings/general-settings",controller:generalSettingsCtrl}).state("basic-information",{url:"/tbl/settings/basic-information",templateUrl:"partials?t=tbl/settings/basic-information",controller:"BasicInformationCtrl"}).state("tax-settings",{url:"/tbl/extra/tax-settings",templateUrl:"partials?t=tbl/extra/tax-settings",controller:taxSettingsCtrl}).state("reservations_daycare_groups",{url:"/tbl/reservations/daycare/groups-and-day",templateUrl:"partials?t=tbl/reservations/daycare/groups-and-day",controller:daycareGroupsCtrl}).state("commissions",{url:"/tbl/settings/commissions",templateUrl:"partials?t=tbl/settings/commissions",controller:commissionsCtrl}).state("holiday_and_season",{url:"/tbl/settings/holiday-and-season",templateUrl:"partials?t=tbl/settings/holiday-and-season",controller:holidayAndSeasonCtrl}).state("my_account",{url:"/tbl/settings/my-account",templateUrl:"partials?t=tbl/settings/my-account",controller:"myAccountCtrl"}).state("rewards_program",{url:"/tbl/settings/rewards-program",templateUrl:"partials?t=tbl/settings/rewards-program",controller:rewardsProgramCtrl}).state("user_interface",{url:"/tbl/settings/user-interface",templateUrl:"partials?t=tbl/settings/user-interface",controller:userInterfaceCtrl}).state("layout",{url:"/tbl/settings/layout",templateUrl:"partials?t=tbl/settings/layout",controller:layoutSettingsCtrl}).state("discounts_boarding",{url:"/tbl/settings/discounts/boarding",templateUrl:"partials?t=tbl/settings/discounts/boarding",controller:discountsBoardingCtrl}).state("password_management",{url:"/tbl/settings/security/password-management",templateUrl:"partials?t=tbl/settings/security/password-management",controller:passwordManagementCtrl}).state("security_center",{url:"/tbl/settings/security/security-center",templateUrl:"partials?t=tbl/settings/security/security-center",controller:securityCenterCtrl}).state("security_levels",{url:"/tbl/settings/security/security-levels",templateUrl:"partials?t=tbl/settings/security/security-levels",controller:securityLevelsCtrl}).state("general_features",{url:"/tbl/settings/general-features",templateUrl:"partials?t=tbl/settings/general-features",controller:generalFeaturesCtrl}).state("retail",{url:"/tbl/settings/retail",templateUrl:"partials?t=tbl/settings/retail",controller:"RetailCtrl"}).state("languages",{url:"/tbl/settings/languages",templateUrl:"partials?t=tbl/settings/languages",controller:"LanguageCtrl"}).state("users",{url:"/crud/users",templateUrl:"crud?t=users",controller:crudCtrlSettings}).state("groomers",{url:"/crud/groomers",templateUrl:"crud?t=groomers",controller:crudCtrlSettings}).state("trainers",{url:"/crud/trainers",templateUrl:"crud?t=trainers",controller:crudCtrlSettings}).state("stay_reasons",{url:"/crud/stay_reasons",templateUrl:"crud?t=stay_reasons",controller:crudCtrlSettings}).state("reservations_boarding_settings",{url:"/tbl/reservations/boarding/boarding-settings",templateUrl:"partials?t=tbl/reservations/boarding/boarding-settings",controller:boardingSettings}).state("reservations_grooming_general",{url:"/tbl/reservations/grooming/grooming-general",templateUrl:"partials?t=tbl/reservations/grooming/grooming-general",controller:groomingGeneralCtrl}).state("reservations_grooming_rates",{url:"/tbl/reservations/grooming/grooming-rates",templateUrl:"partials?t=tbl/reservations/grooming/grooming-rates",controller:groomingRatesCtrl}).state("reservations_grooming_services",{url:"/tbl/reservations/grooming/grooming-services",templateUrl:"partials?t=tbl/reservations/grooming/grooming-services",controller:groomingServicesCtrl}).state("reservation_training_groups",{url:"/tbl/reservations/training/training-groups",templateUrl:"partials?t=tbl/reservations/training/training-groups",controller:trainingGroupsCtrl}).state("reservation_training_schedule",{url:"/tbl/reservations/training/training-schedule",templateUrl:"partials?t=tbl/reservations/training/training-schedule",controller:trainingScheduleCtrl}).state("schedule_services",{url:"/crud/schedule_services",templateUrl:"crud?t=schedule_services",controller:crudCtrlSettings}).state("meds",{url:"/crud/meds",templateUrl:"crud?t=meds",controller:crudCtrlSettings}).state("meds_type",{url:"/crud/meds_type",templateUrl:"crud?t=meds_type",controller:crudCtrlSettings}).state("diets",{url:"/crud/diets",templateUrl:"crud?t=diets",controller:crudCtrlSettings}).state("diets_type",{url:"/crud/diets_type",templateUrl:"crud?t=diets_type",controller:crudCtrlSettings}).state("md_dosage",{url:"/crud/md_dosage",templateUrl:"crud?t=md_dosage",controller:crudCtrlSettings}).state("md_dose_type",{url:"/crud/md_dose_type",templateUrl:"crud?t=md_dose_type",controller:crudCtrlSettings}).state("pet_color",{url:"/crud/pet_color",templateUrl:"crud?t=pet_color",controller:crudCtrlSettings}).state("pet_type",{url:"/crud/pet_type",templateUrl:"crud?t=pet_type",controller:crudCtrlSettings}).state("pet_breed",{url:"/crud/pet_breed",templateUrl:"crud?t=pet_breed",controller:crudCtrlSettings}).state("pet_status",{url:"/crud/pet_status",templateUrl:"crud?t=pet_status",controller:crudCtrlSettings}).state("time_clock",{url:"/tbl/tools/time-clock",templateUrl:"partials?t=tbl/tools/time-clock",controller:timeClockCtrl}).state("client_status",{url:"/crud/client_status",templateUrl:"crud?t=client_status",controller:crudCtrlSettings}).state("payment_types",{url:"/crud/payment_types",templateUrl:"crud?t=payment_types",controller:crudCtrlSettings}).state("client_survey_findout",{url:"/crud/client_survey_findout",templateUrl:"crud?t=client_survey_findout",controller:crudCtrlSettings}).state("client_survey_income",{url:"/crud/client_survey_income",templateUrl:"crud?t=client_survey_income",controller:crudCtrlSettings}).state("vets",{url:"/crud/vets",templateUrl:"crud?t=vets",controller:crudCtrlSettings}).state("help",{url:"/help/",templateUrl:"partials?t=help",controller:"HelpCtrl"}).state("select-kennel",{url:"/select-kennel/",templateUrl:"partials?t=select-kennel",controller:function(){}}).state("pet_ownership",{url:"/tbl/tools/pet-ownership/",templateUrl:"partials?t=tbl/tools/pet-ownership",controller:petOwnershipCtrl})};var mainApp=angular.module("mainApp",["ui.router","ngCookies","ngAnimate","webStorageModule","ui-rangeSlider"]);mainApp.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.useXDomain=true;delete $httpProvider.defaults.headers.common["X-Requested-With"]}]);mainApp.config(["$provide",function($provide){$provide.decorator("$controller",["$delegate",function($delegate){return function(constructor,locals){if(typeof constructor=="string"){locals.$scope.controllerName=constructor}return $delegate(constructor,locals)}}])}]);mainApp.factory("transformRequestAsFormPost",transformRequestAsFormPost);mainApp.factory("httpInterceptor",httpInterceptor).config(function($httpProvider){$httpProvider.interceptors.push("httpInterceptor")});mainApp.run(function($http,$rootScope){$http.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";rs=$rootScope;a=angular;pF=parseFloat;pI=parseInt;c=console;c.l=c.log});mainApp.filter("array",commonFilters.Bootstrap.Array);mainApp.filter("l",commonFilters.Bootstrap.L);mainApp.filter("baseUrl",commonFilters.Bootstrap.BaseUrl);mainApp.filter("dobString",commonFilters.Bootstrap.DobString);mainApp.filter("dobStringYear",commonFilters.Bootstrap.DobStringYear);mainApp.filter("getDate",commonFilters.Bootstrap.GetDate);mainApp.filter("getTime",commonFilters.Bootstrap.GetTime);mainApp.filter("getDateTime",commonFilters.Bootstrap.GetDateTime);mainApp.filter("filterExcludeObjIds",commonFilters.Bootstrap.FilterExcludeObjIds);mainApp.filter("filterRelationship",commonFilters.Bootstrap.FilterRelationship);mainApp.filter("slice",commonFilters.Bootstrap.Slice);mainApp.filter("isEmpty",commonFilters.Bootstrap.IsEmpty);mainApp.filter("lastEl",commonFilters.Bootstrap.LastEl);mainApp.filter("capitalize",commonFilters.Bootstrap.Capitalize);mainApp.filter("htmlEscape",commonFilters.Bootstrap.HtmlEscape);mainApp.filter("textToHtml",commonFilters.Bootstrap.TextToHtml);mainApp.filter("filterDates",dateFilters.Bootstrap.FilterDates);mainApp.service("api",apiService);mainApp.service("models",modelsService);mainApp.service("cFunc",cFuncService);mainApp.service("language",languageService);mainApp.service("crud",crudService);mainApp.service("calc",calcService);mainApp.service("cp",cpService);mainApp.service("rsv",rsvService);mainApp.service("dt",dateTimeService);mainApp.service("pdf",pdfService);mainApp.service("access",accessService);mainApp.service("settings",settingsService);mainApp.factory("qEach",qEach);mainApp.directive("inputText",inputFormDirectives.Bootstrap.InputText);mainApp.directive("inputTextarea",inputFormDirectives.Bootstrap.InputTextarea);mainApp.directive("inputSelect",inputFormDirectives.Bootstrap.InputSelect);mainApp.directive("inputRadio",inputFormDirectives.Bootstrap.InputRadio);mainApp.directive("inputCheckbox",inputFormDirectives.Bootstrap.InputCheckbox);mainApp.directive("formSubmit",inputFormDirectives.Bootstrap.FormSubmit);mainApp.directive("editableTable",tableDirectives.Bootstrap.EditableTable);mainApp.directive("imageNoImage",imageDirectives.Bootstrap.ImageNoImage);mainApp.directive("datepicker",commonDirectives.Bootstrap.Datepicker);mainApp.directive("datepickerUs",commonDirectives.Bootstrap.DatepickerUs);mainApp.directive("timepicker",commonDirectives.Bootstrap.Timepicker);mainApp.directive("colorpicker",commonDirectives.Bootstrap.Colorpicker);mainApp.directive("fancybox",commonDirectives.Bootstrap.Fancybox);mainApp.directive("clearable",commonDirectives.Bootstrap.Clearable);mainApp.directive("scrollLoad",commonDirectives.Bootstrap.ScrollLoad);mainApp.directive("scrollLimit",commonDirectives.Bootstrap.ScrollLimit);mainApp.directive("prefix",commonDirectives.Bootstrap.Prefix);mainApp.directive("postfix",commonDirectives.Bootstrap.Postfix);mainApp.directive("saveButton",commonDirectives.Bootstrap.SaveButton);mainApp.directive("thOrder",commonDirectives.Bootstrap.ThOrder);mainApp.directive("printButtons",commonDirectives.Bootstrap.PrintButtons);mainApp.directive("menuLink",commonDirectives.Bootstrap.MenuLink);mainApp.directive("contentLink",commonDirectives.Bootstrap.ContentLink);mainApp.directive("alertConfirmMessages",commonDirectives.Bootstrap.AlertConfirmMessages);mainApp.constant("config",configConstant);mainApp.config(routerConstant);mainApp.run(viewsRun);mainApp.run(searchRun);mainApp.run(convertsRun);mainApp.run(reportsRun);mainApp.run(scrollUpRun);mainApp.run(loadingMaskRun);mainApp.run(foundationRun);mainApp.run(validatorsRun);mainApp.controller("MainCtrl",mainCtrl);mainApp.controller("CpCtrl",cpCtrl);mainApp.controller("rBoardingCtrl",rBoardingCtrl);mainApp.controller("rTrainingCtrl",rTrainingCtrl);mainApp.controller("rDaycareCtrl",rDaycareCtrl);mainApp.controller("rGroomsCtrl",rGroomsCtrl);mainApp.controller("rServicesCtrl",rServicesCtrl);mainApp.controller("rMedsCtrl",rMedsCtrl);mainApp.controller("rDietsCtrl",rDietsCtrl);mainApp.controller("rRecordsCtrl",rRecordsCtrl);mainApp.filter("filterDaycare",filterDaycare);mainApp.filter("filterDaycareColor",filterDaycareColor);mainApp.filter("filterDaycareNr",filterDaycareNr);mainApp.directive("weekdaysDaycare",weekdaysDaycare);mainApp.filter("filterTraining",filterTraining);mainApp.directive("servicesTable",servicesTableDirective);mainApp.directive("medsTable",medsTableDirective);mainApp.directive("dietsTable",dietsTableDirective);mainApp.directive("addRecordsServicesBtn",addRecordsServicesBtnDirective);mainApp.directive("addRecordsMedsBtn",addRecordsMedsBtnDirective);mainApp.directive("addRecordsDietsBtn",addRecordsDietsBtnDirective);mainApp.filter("asterixRg",asterixRgFilter);mainApp.directive("cuFieldset",cuFieldsetDirective);mainApp.directive("importRetail",importRetailDirective);mainApp.controller("RetailCtrl",retailCtrl);mainApp.controller("MyAccountCtrl",myAccountCtrl);mainApp.controller("BasicInformationCtrl",basicInformationCtrl);mainApp.controller("LanguageCtrl",languagesCtrl);mainApp.directive("usersExtraCrud",usersExtraCrudDirective);mainApp.controller("HelpCtrl",helpCtrl);mainApp.controller("PosCtrl",posCtrl);mainApp.controller("PendingCtrl",pendingCtrl);mainApp.controller("DepositsCtrl",depositsCtrl);mainApp.controller("ReportsCtrl",reportsCtrl);
mainApp.controller("MessagesCtrl",messagesCtrl);mainApp.controller("VaccanciesCtrl",vaccanciesCtrl);mainApp.controller("LayoutCtrl",layoutCtrl);mainApp.controller("ManagerCtrl",managerCtrl);mainApp.controller("clientPhone",function(){});mainApp.controller("clientCell",function(){});mainApp.controller("clientWork",function(){});mainApp.controller("clientEmerg",function(){});mainApp.controller("crudPhone",function(){});mainApp.controller("crudCell",function(){});mainApp.controller("basicInformationPhone",function(){});mainApp.controller("basicInformationCell",function(){});mainApp.controller("basicInformationFax",function(){});mainApp.controller("myAccountPhone",function(){});mainApp.controller("myAccountCell",function(){});mainApp.controller("rBoardingServices",function(){});mainApp.controller("rBoardingMeds",function(){});mainApp.controller("rBoardingDiets",function(){});mainApp.controller("rDaycareServices",function(){});mainApp.controller("rDaycareMeds",function(){});mainApp.controller("rDaycareDiets",function(){});mainApp.controller("rTrainingServices",function(){});mainApp.controller("rTrainingMeds",function(){});mainApp.controller("rTrainingDiets",function(){});mainApp.controller("rGroomsServices",function(){});mainApp.controller("rGroomsMeds",function(){});mainApp.controller("rGroomsDiets",function(){});mainApp.controller("rBoardingTop",function(){});mainApp.controller("rDaycareTop",function(){});mainApp.controller("rTrainingTop",function(){});mainApp.controller("rGroomsTop",function(){});mainApp.controller("rBoardingPanel",function(){});mainApp.controller("rDaycarePanel",function(){});mainApp.controller("rTrainingPanel",function(){});mainApp.controller("rGroomsPanel",function(){});var initModels=function($http,models,cFunc,crud,cp,settings,access,$cookies,$location,$state,$urlRouter,pdf,rsv,$timeout,language){rs.access=access;rs.cookies=$cookies;rs.location=$location;rs.cFunc=cFunc;rs.crud=crud;rs.pdf=pdf;rs.l=language;rs.post={};rs.$on("$stateChangeStart",function(e,to,toParams,fromState,fromParams){if(!rs.settings){e.preventDefault();var extra_json={filter:{order:"id desc"},get_with:"id"};rs.init_done=false;models.getModels(settings_tables_arr,null,"multiple_login",extra_json).then(function(r_s){models.getModels(general_tables_arr,null,"",extra_json).then(function(r_g){settings.doAll();cp.doAll();rsv.doAll();pdf.initImages();rs.parseStyle("settings","#fromStyle","#toStyle");rs.init_done=true;cps=$("#CpCtrl").scope();$state.go(to.name,toParams);$urlRouter.sync()})})}else{rs.done=1}});rs.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){if(toState.name=="main"){$("#mainPage").show();$("#uiView").hide()}else{$("#ajaxLoaderHuge").hide();$("#mainPage").hide();$("#uiView").show()}})};